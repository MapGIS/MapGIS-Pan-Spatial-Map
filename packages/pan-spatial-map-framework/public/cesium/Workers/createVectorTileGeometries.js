define(["./Transforms-07a9fab5","./BoxGeometry-1dfb3023","./Cartesian2-38b35910","./Color-0fad516f","./CylinderGeometry-25805efb","./when-ae2e0b60","./EllipsoidGeometry-44bbad86","./IndexDatatype-516320ea","./createTaskProcessorWorker","./Check-f996273c","./Math-5bbcea10","./combine-276652d0","./RuntimeError-ac2797b4","./GeometryOffsetAttribute-b02d5bb9","./ComponentDatatype-e44126e4","./WebGLConstants-35626ea2","./GeometryAttribute-586bf52c","./GeometryAttributes-5ce4955a","./VertexFormat-90d15264","./CylinderGeometryLibrary-88cb80d2"],function(S,k,T,V,A,F,O,L,e,t,n,r,o,s,d,c,f,l,u,h){"use strict";function R(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var a=new T.Cartesian3,b=S.Matrix4.packedLength+T.Cartesian3.packedLength,p=S.Matrix4.packedLength+2,y=S.Matrix4.packedLength+T.Cartesian3.packedLength,x=T.Cartesian3.packedLength+1,i={modelMatrix:new S.Matrix4,boundingVolume:new S.BoundingSphere};function E(e,t){var t=t*b,n=T.Cartesian3.unpack(e,t,a),e=(t+=T.Cartesian3.packedLength,S.Matrix4.unpack(e,t,i.modelMatrix)),t=(S.Matrix4.multiplyByScale(e,n,e),i.boundingVolume);return T.Cartesian3.clone(T.Cartesian3.ZERO,t.center),t.radius=Math.sqrt(3),i}function U(e,t){var t=t*p,n=e[t++],r=e[t++],n=T.Cartesian3.fromElements(n,n,r,a),r=S.Matrix4.unpack(e,t,i.modelMatrix),e=(S.Matrix4.multiplyByScale(r,n,r),i.boundingVolume);return T.Cartesian3.clone(T.Cartesian3.ZERO,e.center),e.radius=Math.sqrt(2),i}function G(e,t){var t=t*y,n=T.Cartesian3.unpack(e,t,a),e=(t+=T.Cartesian3.packedLength,S.Matrix4.unpack(e,t,i.modelMatrix)),t=(S.Matrix4.multiplyByScale(e,n,e),i.boundingVolume);return T.Cartesian3.clone(T.Cartesian3.ZERO,t.center),t.radius=1,i}function Z(e,t){var t=t*x,n=e[t++],e=T.Cartesian3.unpack(e,t,a),t=S.Matrix4.fromTranslation(e,i.modelMatrix),e=(S.Matrix4.multiplyByUniformScale(t,n,t),i.boundingVolume);return T.Cartesian3.clone(T.Cartesian3.ZERO,e.center),e.radius=1,i}var D=new T.Cartesian3;function M(e,f,l,u,h){if(F.defined(f)){for(var b=l.length,p=u.attributes.position.values,y=u.indices,x=e.positions,g=e.vertexBatchIds,C=e.indices,m=e.batchIds,v=e.batchTableColors,I=e.batchedIndices,k=e.indexOffsets,M=e.indexCounts,B=e.boundingVolumes,w=e.modelMatrix,A=e.center,t=e.positionOffset,O=e.batchIdIndex,n=e.indexOffset,L=e.batchedIndicesOffset,r=0;r<b;++r){for(var E=h(f,r),a=E.modelMatrix,i=(S.Matrix4.multiply(w,a,a),l[r]),U=p.length,o=0;o<U;o+=3){var s=T.Cartesian3.unpack(p,o,D);S.Matrix4.multiplyByPoint(a,s,s),T.Cartesian3.subtract(s,A,s),T.Cartesian3.pack(s,x,3*t+o),g[O++]=i}for(var d=y.length,G=0;G<d;++G)C[n+G]=y[G]+t;var c=r+L;I[c]=new R({offset:n,count:d,color:V.Color.fromRgba(v[i]),batchIds:[i]}),m[c]=i,k[c]=n,M[c]=d,B[c]=S.BoundingSphere.transform(E.boundingVolume,a),t+=U/3,n+=d}e.positionOffset=t,e.batchIdIndex=O,e.indexOffset=n,e.batchedIndicesOffset+=b}}var B=new T.Cartesian3,w=new S.Matrix4;function P(f,e,t){var n=t.length,l=2+n*S.BoundingSphere.packedLength+1+function(e){for(var t=e.length,n=0,r=0;r<t;++r)n+=V.Color.packedLength+3+e[r].batchIds.length;return n}(e),r=new Float64Array(l),a=0;r[a++]=f,r[a++]=n;for(var i=0;i<n;++i)S.BoundingSphere.pack(t[i],r,a),a+=S.BoundingSphere.packedLength;var o=e.length;r[a++]=o;for(var s=0;s<o;++s){var d=e[s],u=(V.Color.pack(d.color,r,a),a+=V.Color.packedLength,r[a++]=d.offset,r[a++]=d.count,d.batchIds),h=u.length;r[a++]=h;for(var c=0;c<h;++c)r[a++]=u[c]}return r}return e(function(e,f){var l=F.defined(e.boxes)?new Float32Array(e.boxes):void 0,u=F.defined(e.boxBatchIds)?new Uint16Array(e.boxBatchIds):void 0,h=F.defined(e.cylinders)?new Float32Array(e.cylinders):void 0,b=F.defined(e.cylinderBatchIds)?new Uint16Array(e.cylinderBatchIds):void 0,p=F.defined(e.ellipsoids)?new Float32Array(e.ellipsoids):void 0,y=F.defined(e.ellipsoidBatchIds)?new Uint16Array(e.ellipsoidBatchIds):void 0,x=F.defined(e.spheres)?new Float32Array(e.spheres):void 0,g=F.defined(e.sphereBatchIds)?new Uint16Array(e.sphereBatchIds):void 0,t=F.defined(l)?u.length:0,n=F.defined(h)?b.length:0,r=F.defined(p)?y.length:0,a=F.defined(x)?g.length:0,C=k.BoxGeometry.getUnitBox(),m=A.CylinderGeometry.getUnitCylinder(),v=O.EllipsoidGeometry.getUnitEllipsoid(),i=C.attributes.position.values,o=m.attributes.position.values,s=v.attributes.position.values,i=i.length*t,o=(i=(i+=o.length*n)+s.length*(r+a),C.indices),s=m.indices,I=v.indices,o=o.length*t,s=(o=(o+=s.length*n)+I.length*(r+a),new Float32Array(i)),I=new Uint16Array(i/3),i=L.IndexDatatype.createTypedArray(i/3,o),o=t+n+r+a,t=new Uint16Array(o),n=new Array(o),r=new Uint32Array(o),a=new Uint32Array(o),o=new Array(o);d=e.packedBuffer,d=new Float64Array(d),c=0,T.Cartesian3.unpack(d,0,B),c+=T.Cartesian3.packedLength,S.Matrix4.unpack(d,c,w);M(d={batchTableColors:new Uint32Array(e.batchTableColors),positions:s,vertexBatchIds:I,indices:i,batchIds:t,batchedIndices:n,indexOffsets:r,indexCounts:a,boundingVolumes:o,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:w,center:B},l,u,C,E),M(d,h,b,m,U),M(d,p,y,v,G),M(d,x,g,v,Z);var d,c=P(i.BYTES_PER_ELEMENT,n,o);return f.push(s.buffer,I.buffer,i.buffer),f.push(t.buffer,r.buffer,a.buffer),f.push(c.buffer),{positions:s.buffer,vertexBatchIds:I.buffer,indices:i.buffer,indexOffsets:r.buffer,indexCounts:a.buffer,batchIds:t.buffer,packedBuffer:c.buffer}})});
