define(["exports","./Cartesian2-8dbd81c1","./when-695b7bde","./Check-c47ad5ed","./EllipsoidGeodesic-deb09425","./EllipsoidRhumbLine-1125a8c3","./IntersectionTests-67410e5f","./Math-09ca1a10","./Transforms-afef28e3","./Plane-a169093f"],function(a,m,d,e,r,E,R,p,w,v){"use strict";var P={numberOfPoints:function(a,e,r){a=m.Cartesian3.distance(a,e);return Math.ceil(a/r)},numberOfPointsRhumbLine:function(a,e,r){a=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(a/(r*r))))}},o=new m.Cartographic,M=(P.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),n=0;n<r;n++){var i=a[n];t[n]=e.cartesianToCartographic(i,o).height}return t},new w.Matrix4),S=new m.Cartesian3,D=new m.Cartesian3,x=new v.Plane(m.Cartesian3.UNIT_X,0),N=new m.Cartesian3,G=new v.Plane(m.Cartesian3.UNIT_X,0),I=new m.Cartesian3,k=new m.Cartesian3,V=[];function L(a,e,r){var t=V;if(t.length=a,e===r){for(i=0;i<a;i++)t[i]=e;return t}for(var n=(r-e)/a,i=0;i<a;i++)t[i]=e+i*n;return t}var T=new m.Cartographic,y=new m.Cartographic,A=new m.Cartesian3,_=new m.Cartesian3,O=new m.Cartesian3,B=new r.EllipsoidGeodesic,b=new E.EllipsoidRhumbLine;P.wrapLongitude=function(a,e){var r=[],t=[];if(d.defined(a)&&0<a.length){e=d.defaultValue(e,w.Matrix4.IDENTITY);for(var e=w.Matrix4.inverseTransformation(e,M),u=w.Matrix4.multiplyByPoint(e,m.Cartesian3.ZERO,S),h=m.Cartesian3.normalize(w.Matrix4.multiplyByPointAsVector(e,m.Cartesian3.UNIT_Y,D),D),f=v.Plane.fromPointNormal(u,h,x),e=m.Cartesian3.normalize(w.Matrix4.multiplyByPointAsVector(e,m.Cartesian3.UNIT_X,N),N),g=v.Plane.fromPointNormal(u,e,G),n=1,i=(r.push(m.Cartesian3.clone(a[0])),r[0]),C=a.length,o=1;o<C;++o){var s,c,l=a[o];(v.Plane.getPointDistance(g,i)<0||v.Plane.getPointDistance(g,l)<0)&&(s=R.IntersectionTests.lineSegmentPlane(i,l,f,I),d.defined(s)&&(c=m.Cartesian3.multiplyByScalar(h,5e-9,k),v.Plane.getPointDistance(f,i)<0&&m.Cartesian3.negate(c,c),r.push(m.Cartesian3.add(s,c,new m.Cartesian3)),t.push(n+1),m.Cartesian3.negate(c,c),r.push(m.Cartesian3.add(s,c,new m.Cartesian3)),n=1)),r.push(m.Cartesian3.clone(a[o])),n++,i=l}t.push(n)}return{positions:r,lengths:t}},P.generateArc=function(a){var e=(a=d.defined(a)?a:{}).positions,r=e.length,t=d.defaultValue(a.ellipsoid,m.Ellipsoid.WGS84),n=d.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r)return c=t.scaleToGeodeticSurface(e[0],_),0!==(n=i?n[0]:n)&&(l=t.geodeticSurfaceNormal(c,A),m.Cartesian3.multiplyByScalar(l,n,l),m.Cartesian3.add(c,l,c)),[c.x,c.y,c.z];for(var o=a.minDistance,u=(d.defined(o)||(l=d.defaultValue(a.granularity,p.CesiumMath.RADIANS_PER_DEGREE),o=p.CesiumMath.chordLength(l,t.maximumRadius)),0),s=0;s<r-1;s++)u+=P.numberOfPoints(e[s],e[s+1],o);var c=3*(u+1),h=new Array(c),f=0;for(s=0;s<r-1;s++)f=function(a,e,u,r,t,h,n,f){var g=r.scaleToGeodeticSurface(a,_),C=r.scaleToGeodeticSurface(e,O),i=P.numberOfPoints(a,e,u),a=r.cartesianToCartographic(g,T),e=r.cartesianToCartographic(C,y),d=L(i,t,h),p=(B.setEndPoints(a,e),B.surfaceDistance/i),o=f,s=(a.height=t,r.cartographicToCartesian(a,A));m.Cartesian3.pack(s,n,o),o+=3;for(var c=1;c<i;c++){var l=B.interpolateUsingSurfaceDistance(c*p,y);l.height=d[c],s=r.cartographicToCartesian(l,A),m.Cartesian3.pack(s,n,o),o+=3}return o}(e[s],e[s+1],o,t,i?n[s]:n,i?n[s+1]:n,h,f);V.length=0;var a=e[r-1],l=t.cartesianToCartographic(a,T),a=(l.height=i?n[r-1]:n,t.cartographicToCartesian(l,A));return m.Cartesian3.pack(a,h,c-3),h};var U=new m.Cartographic,z=new m.Cartographic;P.generateRhumbArc=function(a){var e=(a=d.defined(a)?a:{}).positions,r=e.length,t=d.defaultValue(a.ellipsoid,m.Ellipsoid.WGS84),n=d.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r)return l=t.scaleToGeodeticSurface(e[0],_),0!==(n=i?n[0]:n)&&(c=t.geodeticSurfaceNormal(l,A),m.Cartesian3.multiplyByScalar(c,n,c),m.Cartesian3.add(l,c,l)),[l.x,l.y,l.z];for(var o,u=d.defaultValue(a.granularity,p.CesiumMath.RADIANS_PER_DEGREE),h=0,f=t.cartesianToCartographic(e[0],U),s=0;s<r-1;s++)o=t.cartesianToCartographic(e[s+1],z),h+=P.numberOfPointsRhumbLine(f,o,u),f=m.Cartographic.clone(o,U);var c=3*(h+1),g=new Array(c),C=0;for(s=0;s<r-1;s++)C=function(a,e,u,r,t,h,n,f){var a=r.cartesianToCartographic(a,T),e=r.cartesianToCartographic(e,y),i=P.numberOfPointsRhumbLine(a,e,u),g=(a.height=0,e.height=0,L(i,t,h)),C=((b=b.ellipsoid.equals(r)?b:new E.EllipsoidRhumbLine(void 0,void 0,r)).setEndPoints(a,e),b.surfaceDistance/i),o=f,s=(a.height=t,r.cartographicToCartesian(a,A));m.Cartesian3.pack(s,n,o),o+=3;for(var c=1;c<i;c++){var l=b.interpolateUsingSurfaceDistance(c*C,y);l.height=g[c],s=r.cartographicToCartesian(l,A),m.Cartesian3.pack(s,n,o),o+=3}return o}(e[s],e[s+1],u,t,i?n[s]:n,i?n[s+1]:n,g,C);V.length=0;var l=e[r-1],a=t.cartesianToCartographic(l,T),l=(a.height=i?n[r-1]:n,t.cartographicToCartesian(a,A));return m.Cartesian3.pack(l,g,c-3),g},P.generateCartesianArc=function(a){for(var e=P.generateArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=m.Cartesian3.unpack(e,3*n);return t},P.generateCartesianRhumbArc=function(a){for(var e=P.generateRhumbArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=m.Cartesian3.unpack(e,3*n);return t},a.PolylinePipeline=P});
