define(["./arrayRemoveDuplicates-bdf50aa0","./BoundingRectangle-74602a7c","./Transforms-07a9fab5","./Cartesian2-38b35910","./Check-f996273c","./ComponentDatatype-e44126e4","./CoplanarPolygonGeometryLibrary-aaacfb3f","./when-ae2e0b60","./GeometryAttribute-586bf52c","./GeometryAttributes-5ce4955a","./GeometryInstance-eab27e6b","./GeometryPipeline-88f05837","./IndexDatatype-516320ea","./Math-5bbcea10","./PolygonGeometryLibrary-86705dae","./PolygonPipeline-06aa4301","./VertexFormat-90d15264","./combine-276652d0","./RuntimeError-ac2797b4","./WebGLConstants-35626ea2","./OrientedBoundingBox-771a38ca","./EllipsoidTangentPlane-19622103","./AxisAlignedBoundingBox-d272def4","./IntersectionTests-f49c7cd3","./Plane-45ad3143","./AttributeCompression-25f42564","./EncodedCartesian3-d40e98d6","./ArcType-1275a14e","./EllipsoidRhumbLine-af7b5ebe"],function(f,e,G,L,t,E,b,l,T,D,x,P,_,k,h,V,s,n,a,o,r,i,y,c,m,u,d,g,v){"use strict";var R=new L.Cartesian3,A=new e.BoundingRectangle,I=new L.Cartesian2,M=new L.Cartesian2,w=new L.Cartesian3,F=new L.Cartesian3,B=new L.Cartesian3,C=new L.Cartesian3,H=new L.Cartesian3,O=new L.Cartesian3,z=new G.Quaternion,S=new G.Matrix3,N=new G.Matrix3,Q=new L.Cartesian3;function p(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,n=l.defaultValue(e.vertexFormat,s.VertexFormat.DEFAULT);this._vertexFormat=s.VertexFormat.clone(n),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=L.Ellipsoid.clone(l.defaultValue(e.ellipsoid,L.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=h.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+s.VertexFormat.packedLength+L.Ellipsoid.packedLength+2}p.fromPositions=function(e){return new p({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},p.pack=function(e,t,n){return n=l.defaultValue(n,0),n=h.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,n),L.Ellipsoid.pack(e._ellipsoid,t,n),n+=L.Ellipsoid.packedLength,s.VertexFormat.pack(e._vertexFormat,t,n),n+=s.VertexFormat.packedLength,t[n++]=e._stRotation,t[n]=e.packedLength,t};var j=L.Ellipsoid.clone(L.Ellipsoid.UNIT_SPHERE),U=new s.VertexFormat,Y={polygonHierarchy:{}};return p.unpack=function(e,t,n){t=l.defaultValue(t,0);var a=h.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t),o=(t=a.startingIndex,delete a.startingIndex,L.Ellipsoid.unpack(e,t,j)),r=(t+=L.Ellipsoid.packedLength,s.VertexFormat.unpack(e,t,U)),i=(t+=s.VertexFormat.packedLength,e[t++]),e=e[t];return(n=l.defined(n)?n:new p(Y))._polygonHierarchy=a,n._ellipsoid=L.Ellipsoid.clone(o,n._ellipsoid),n._vertexFormat=s.VertexFormat.clone(r,n._vertexFormat),n._stRotation=i,n.packedLength=e,n},p.createGeometry=function(e){var t=e._vertexFormat,n=e._polygonHierarchy,y=e._stRotation,a=n.positions;if(!((a=f.arrayRemoveDuplicates(a,L.Cartesian3.equalsEpsilon,!0)).length<3)){var o=w,r=F,i=B,l=H,s=O;if(b.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(a,C,l,s)){var o=L.Cartesian3.cross(l,s,o),e=(o=L.Cartesian3.normalize(o,o),L.Cartesian3.equalsEpsilon(C,L.Cartesian3.ZERO,k.CesiumMath.EPSILON6)||(e=e._ellipsoid.geodeticSurfaceNormal(C,Q),L.Cartesian3.dot(o,e)<0&&(o=L.Cartesian3.negate(o,o),l=L.Cartesian3.negate(l,l))),b.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(C,l,s)),c=b.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(C,l,s),l=(t.tangent&&(r=L.Cartesian3.clone(l,r)),t.bitangent&&(i=L.Cartesian3.clone(s,i)),h.PolygonGeometryLibrary.polygonsFromHierarchy(n,e,!1)),s=l.hierarchy,m=l.polygons;if(0!==s.length){for(var a=s[0].outerRing,n=G.BoundingSphere.fromPoints(a),u=h.PolygonGeometryLibrary.computeBoundingRectangle(o,c,a,y,A),d=[],p=0;p<m.length;p++){var g=new x.GeometryInstance({geometry:function(e,t,n,a,y,o,r,i){for(var c=e.positions,m=((e=V.PolygonPipeline.triangulate(e.positions2D,e.holes)).length<3&&(e=[0,1,2]),_.IndexDatatype.createTypedArray(c.length,e.length)),l=(m.set(e),S),u=(0!==a?(e=G.Quaternion.fromAxisAngle(o,a,z),l=G.Matrix3.fromQuaternion(e,l),(t.tangent||t.bitangent)&&(e=G.Quaternion.fromAxisAngle(o,-a,z),a=G.Matrix3.fromQuaternion(e,N),r=L.Cartesian3.normalize(G.Matrix3.multiplyByVector(a,r,r),r),t.bitangent&&(i=L.Cartesian3.normalize(L.Cartesian3.cross(o,r,i),i)))):l=G.Matrix3.clone(G.Matrix3.IDENTITY,l),M),d=(t.st&&(u.x=n.x,u.y=n.y),c.length),e=3*d,s=new Float64Array(e),g=t.normal?new Float32Array(e):void 0,b=t.tangent?new Float32Array(e):void 0,h=t.bitangent?new Float32Array(e):void 0,C=t.st?new Float32Array(2*d):void 0,f=0,x=0,P=0,v=0,A=0,w=0;w<d;w++){var F,p=c[w];s[f++]=p.x,s[f++]=p.y,s[f++]=p.z,t.st&&(p=y(G.Matrix3.multiplyByVector(l,p,R),I),L.Cartesian2.subtract(p,u,p),F=k.CesiumMath.clamp(p.x/n.width,0,1),p=k.CesiumMath.clamp(p.y/n.height,0,1),C[A++]=F,C[A++]=p),t.normal&&(g[x++]=o.x,g[x++]=o.y,g[x++]=o.z),t.tangent&&(b[v++]=r.x,b[v++]=r.y,b[v++]=r.z),t.bitangent&&(h[P++]=i.x,h[P++]=i.y,h[P++]=i.z)}return a=new D.GeometryAttributes,t.position&&(a.position=new T.GeometryAttribute({componentDatatype:E.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s})),t.normal&&(a.normal=new T.GeometryAttribute({componentDatatype:E.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:g})),t.tangent&&(a.tangent=new T.GeometryAttribute({componentDatatype:E.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:b})),t.bitangent&&(a.bitangent=new T.GeometryAttribute({componentDatatype:E.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:h})),t.st&&(a.st=new T.GeometryAttribute({componentDatatype:E.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:C})),new T.Geometry({attributes:a,indices:m,primitiveType:T.PrimitiveType.TRIANGLES})}(m[p],t,u,y,c,o,r,i)});d.push(g)}e=P.GeometryPipeline.combineInstances(d)[0],l=(e.attributes.position.values=new Float64Array(e.attributes.position.values),e.indices=_.IndexDatatype.createTypedArray(e.attributes.position.values.length/3,e.indices),e.attributes);return t.position||delete l.position,new T.Geometry({attributes:l,indices:e.indices,primitiveType:e.primitiveType,boundingSphere:n})}}}},function(e,t){return l.defined(t)&&(e=p.unpack(e,t)),p.createGeometry(e)}});
