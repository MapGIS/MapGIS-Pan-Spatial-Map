define(["exports","./ArcType-1275a14e","./arrayRemoveDuplicates-bdf50aa0","./Cartesian2-38b35910","./ComponentDatatype-e44126e4","./when-ae2e0b60","./EllipsoidRhumbLine-af7b5ebe","./GeometryAttribute-586bf52c","./GeometryAttributes-5ce4955a","./GeometryPipeline-88f05837","./IndexDatatype-516320ea","./Math-5bbcea10","./Transforms-07a9fab5","./PolygonPipeline-06aa4301"],function(e,I,L,x,M,T,f,E,D,y,S,A,p,P){"use strict";function _(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(_.prototype,{length:{get:function(){return this._length}}}),_.prototype.enqueue=function(e){this._array.push(e),this._length++},_.prototype.dequeue=function(){var e,t,i;if(0!==this._length)return e=this._array,t=this._offset,i=e[t],e[t]=void 0,10<++t&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,i},_.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},_.prototype.contains=function(e){return-1!==this._array.indexOf(e)},_.prototype.clear=function(){this._array.length=this._offset=this._length=0},_.prototype.sort=function(e){0<this._offset&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var G={computeHierarchyPackedLength:function(e){for(var t=0,i=[e];0<i.length;){var r=i.pop();if(T.defined(r)){t+=2;var n=r.positions,a=r.holes;if(T.defined(n)&&(t+=n.length*x.Cartesian3.packedLength),T.defined(a))for(var o=a.length,s=0;s<o;++s)i.push(a[s])}}return t},packPolygonHierarchy:function(e,t,i){for(var r=[e];0<r.length;){var n=r.pop();if(T.defined(n)){var a=n.positions,o=n.holes;if(t[i++]=T.defined(a)?a.length:0,t[i++]=T.defined(o)?o.length:0,T.defined(a))for(var s=a.length,u=0;u<s;++u,i+=3)x.Cartesian3.pack(a[u],t,i);if(T.defined(o))for(var h=o.length,l=0;l<h;++l)r.push(o[l])}}return i},unpackPolygonHierarchy:function(e,t){for(var i=e[t++],r=e[t++],n=new Array(i),a=0<r?new Array(r):void 0,o=0;o<i;++o,t+=x.Cartesian3.packedLength)n[o]=x.Cartesian3.unpack(e,t);for(var s=0;s<r;++s)a[s]=G.unpackPolygonHierarchy(e,t),t=a[s].startingIndex,delete a[s].startingIndex;return{positions:n,holes:a,startingIndex:t}}},d=new x.Cartesian3;G.subdivideLineCount=function(e,t,i){e=x.Cartesian3.distance(e,t),t=Math.max(0,Math.ceil(A.CesiumMath.log2(e/i)));return Math.pow(2,t)};var g=new x.Cartographic,m=new x.Cartographic,v=new x.Cartographic,C=new x.Cartesian3,b=(G.subdivideRhumbLineCount=function(e,t,i,r){t=e.cartesianToCartographic(t,g),i=e.cartesianToCartographic(i,m),t=new f.EllipsoidRhumbLine(t,i,e).surfaceDistance/r,i=Math.max(0,Math.ceil(A.CesiumMath.log2(t)));return Math.pow(2,i)},G.subdivideLine=function(e,t,h,i){for(var r,n,a=G.subdivideLineCount(e,t,h),c=x.Cartesian3.distance(e,t),f=c/a,o=i=T.defined(i)?i:[],s=(o.length=3*a,0),u=0;u<a;u++){r=e,l=u*f,n=c,x.Cartesian3.subtract(t,r,d),x.Cartesian3.multiplyByScalar(d,l/n,d),x.Cartesian3.add(r,d,d);var l=[d.x,d.y,d.z];o[s++]=l[0],o[s++]=l[1],o[s++]=l[2]}return o},G.subdivideRhumbLine=function(e,t,i,h,r){for(var t=e.cartesianToCartographic(t,g),i=e.cartesianToCartographic(i,m),n=new f.EllipsoidRhumbLine(t,i,e),t=n.surfaceDistance/h,i=Math.max(0,Math.ceil(A.CesiumMath.log2(t))),a=Math.pow(2,i),c=n.surfaceDistance/a,o=r=T.defined(r)?r:[],s=(o.length=3*a,0),u=0;u<a;u++){var l=n.interpolateUsingSurfaceDistance(u*c,v),l=e.cartographicToCartesian(l,C);o[s++]=l.x,o[s++]=l.y,o[s++]=l.z}return o},new x.Cartesian3),w=new x.Cartesian3,R=new x.Cartesian3,N=new x.Cartesian3,O=(G.scaleToGeodeticHeightExtruded=function(e,t,h,i,c){i=T.defaultValue(i,x.Ellipsoid.WGS84);var r=b,n=w,a=R,o=N;if(T.defined(e)&&T.defined(e.attributes)&&T.defined(e.attributes.position))for(var s=e.attributes.position.values,u=s.length/2,l=0;l<u;l+=3)x.Cartesian3.fromArray(s,l,a),i.geodeticSurfaceNormal(a,r),o=i.scaleToGeodeticSurface(a,o),n=x.Cartesian3.multiplyByScalar(r,h,n),n=x.Cartesian3.add(o,n,n),s[l+u]=n.x,s[l+1+u]=n.y,s[l+2+u]=n.z,c&&(o=x.Cartesian3.clone(a,o)),n=x.Cartesian3.multiplyByScalar(r,t,n),n=x.Cartesian3.add(o,n,n),s[l]=n.x,s[l+1]=n.y,s[l+2]=n.z;return e},G.polygonOutlinesFromHierarchy=function(h,e,c){var t,i,r=[],n=new _;for(n.enqueue(h);0!==n.length;){var a=n.dequeue(),o=a.positions;if(e)for(i=o.length,s=0;s<i;s++)c.scaleToGeodeticSurface(o[s],o[s]);if(!((o=L.arrayRemoveDuplicates(o,x.Cartesian3.equalsEpsilon,!0)).length<3)){for(var f=a.holes?a.holes.length:0,s=0;s<f;s++){var u=a.holes[s],l=u.positions;if(e)for(i=l.length,t=0;t<i;++t)c.scaleToGeodeticSurface(l[t],l[t]);if(!((l=L.arrayRemoveDuplicates(l,x.Cartesian3.equalsEpsilon,!0)).length<3)){r.push(l);var p=0;for(T.defined(u.holes)&&(p=u.holes.length),t=0;t<p;t++)n.enqueue(u.holes[t])}}r.push(o)}}return r},G.polygonsFromHierarchy=function(h,c,f,p){var d=[],y=[],e=new _;for(e.enqueue(h);0!==e.length;){var t,g=e.dequeue(),i=g.positions,r=g.holes;if(f)for(t=i.length,o=0;o<t;o++)p.scaleToGeodeticSurface(i[o],i[o]);if(!((i=L.arrayRemoveDuplicates(i,x.Cartesian3.equalsEpsilon,!0)).length<3)){var n=c(i);if(T.defined(n)){for(var a,m=[],v=(P.PolygonPipeline.computeWindingOrder2D(n)===P.WindingOrder.CLOCKWISE&&(n.reverse(),i=i.slice().reverse()),i.slice()),C=T.defined(r)?r.length:0,b=[],o=0;o<C;o++){var s=r[o],u=s.positions;if(f)for(t=u.length,a=0;a<t;++a)p.scaleToGeodeticSurface(u[a],u[a]);if(!((u=L.arrayRemoveDuplicates(u,x.Cartesian3.equalsEpsilon,!0)).length<3)){var l=c(u);if(T.defined(l)){P.PolygonPipeline.computeWindingOrder2D(l)===P.WindingOrder.CLOCKWISE&&(l.reverse(),u=u.slice().reverse()),b.push(u),m.push(v.length);var v=v.concat(u),n=n.concat(l),w=0;for(T.defined(s.holes)&&(w=s.holes.length),a=0;a<w;a++)e.enqueue(s.holes[a])}}}d.push({outerRing:i,holes:b}),y.push({positions:v,positions2D:n,holes:m})}}}return{hierarchy:d,polygons:y}},new x.Cartesian2),q=new x.Cartesian3,B=new p.Quaternion,H=new p.Matrix3,k=(G.computeBoundingRectangle=function(e,t,i,h,r){for(var e=p.Quaternion.fromAxisAngle(e,h,B),c=p.Matrix3.fromQuaternion(e,H),n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,f=i.length,u=0;u<f;++u){var l=x.Cartesian3.clone(i[u],q),l=(p.Matrix3.multiplyByVector(c,l,l),t(l,O));T.defined(l)&&(n=Math.min(n,l.x),a=Math.max(a,l.x),o=Math.min(o,l.y),s=Math.max(s,l.y))}return r.x=n,r.y=o,r.width=a-n,r.height=s-o,r},G.createGeometryFromPositions=function(e,t,i,h,c,r){var n=P.PolygonPipeline.triangulate(t.positions2D,t.holes),a=(n.length<3&&(n=[0,1,2]),t.positions);if(h){for(var f=a.length,o=new Array(3*f),s=0,u=0;u<f;u++){var l=a[u];o[s++]=l.x,o[s++]=l.y,o[s++]=l.z}t=new E.Geometry({attributes:{position:new E.GeometryAttribute({componentDatatype:M.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:o})},indices:n,primitiveType:E.PrimitiveType.TRIANGLES});return c.normal?y.GeometryPipeline.computeNormal(t):t}return r===I.ArcType.GEODESIC?P.PolygonPipeline.computeSubdivision(e,a,n,i):r===I.ArcType.RHUMB?P.PolygonPipeline.computeRhumbLineSubdivision(e,a,n,i):void 0},[]),z=new x.Cartesian3,W=new x.Cartesian3;G.computeWallGeometry=function(e,h,c,f,p){var t,i,r,n=e.length,a=0;if(f)for(i=3*n*2,t=new Array(2*i),r=0;r<n;r++)o=e[r],s=e[(r+1)%n],t[a]=t[a+i]=o.x,t[++a]=t[a+i]=o.y,t[++a]=t[a+i]=o.z,t[++a]=t[a+i]=s.x,t[++a]=t[a+i]=s.y,t[++a]=t[a+i]=s.z,++a;else{var d=A.CesiumMath.chordLength(c,h.maximumRadius),y=0;if(p===I.ArcType.GEODESIC)for(r=0;r<n;r++)y+=G.subdivideLineCount(e[r],e[(r+1)%n],d);else if(p===I.ArcType.RHUMB)for(r=0;r<n;r++)y+=G.subdivideRhumbLineCount(h,e[r],e[(r+1)%n],d);for(i=3*(y+n),t=new Array(2*i),r=0;r<n;r++){var g,o=e[r],s=e[(r+1)%n];p===I.ArcType.GEODESIC?g=G.subdivideLine(o,s,d,k):p===I.ArcType.RHUMB&&(g=G.subdivideRhumbLine(h,o,s,d,k));for(var m=g.length,v=0;v<m;++v,++a)t[a]=g[v],t[a+i]=g[v];t[a]=s.x,t[a+i]=s.x,t[++a]=s.y,t[a+i]=s.y,t[++a]=s.z,t[a+i]=s.z,++a}}var n=t.length,u=S.IndexDatatype.createTypedArray(n/3,n-6*e.length),l=0;for(n/=6,r=0;r<n;r++){var C=r,b=C+1,w=C+n,T=w+1;o=x.Cartesian3.fromArray(t,3*C,z),s=x.Cartesian3.fromArray(t,3*b,W),x.Cartesian3.equalsEpsilon(o,s,A.CesiumMath.EPSILON10,A.CesiumMath.EPSILON10)||(u[l++]=C,u[l++]=w,u[l++]=b,u[l++]=b,u[l++]=w,u[l++]=T)}return new E.Geometry({attributes:new D.GeometryAttributes({position:new E.GeometryAttribute({componentDatatype:M.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:t})}),indices:u,primitiveType:E.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=G});
