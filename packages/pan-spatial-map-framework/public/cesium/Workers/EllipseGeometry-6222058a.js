define(["exports","./GeometryOffsetAttribute-b02d5bb9","./Transforms-07a9fab5","./Cartesian2-38b35910","./Check-f996273c","./ComponentDatatype-e44126e4","./when-ae2e0b60","./EllipseGeometryLibrary-8c4f5623","./GeometryAttribute-586bf52c","./GeometryAttributes-5ce4955a","./GeometryInstance-eab27e6b","./GeometryPipeline-88f05837","./IndexDatatype-516320ea","./Math-5bbcea10","./VertexFormat-90d15264"],function(e,S,L,R,t,j,k,Y,z,H,m,y,c,p,d){"use strict";var U=new R.Cartesian3,Q=new R.Cartesian3,W=new R.Cartesian3,J=new R.Cartesian3,B=new R.Cartesian2,q=new L.Matrix3,Z=new L.Matrix3,K=new L.Quaternion,X=new R.Cartesian3,$=new R.Cartesian3,ee=new R.Cartesian3,te=new R.Cartographic,re=new R.Cartesian3,ae=new R.Cartesian2,ie=new R.Cartesian2;function f(m,e,p){for(var t=e.vertexFormat,r=e.center,y=e.semiMajorAxis,c=e.semiMinorAxis,d=e.ellipsoid,A=e.stRotation,f=p?m.length/3*2:m.length/3,h=e.shadowVolume,a=t.st?new Float32Array(2*f):void 0,x=t.normal?new Float32Array(3*f):void 0,g=t.tangent?new Float32Array(3*f):void 0,b=t.bitangent?new Float32Array(3*f):void 0,_=h?new Float32Array(3*f):void 0,C=0,i=X,n=$,o=ee,v=new L.GeographicProjection(d),w=v.project(d.cartesianToCartographic(r,te),re),r=d.scaleToGeodeticSurface(r,U),M=(d.geodeticSurfaceNormal(r,r),q),E=Z,I=(E=0!==A?(u=L.Quaternion.fromAxisAngle(r,A,K),M=L.Matrix3.fromQuaternion(u,M),u=L.Quaternion.fromAxisAngle(r,-A,K),L.Matrix3.fromQuaternion(u,E)):(M=L.Matrix3.clone(L.Matrix3.IDENTITY,M),L.Matrix3.clone(L.Matrix3.IDENTITY,E)),R.Cartesian2.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,ae)),T=R.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,ie),G=m.length,s=p?G:0,N=s/3*2,l=0;l<G;l+=3){var P,F=l+1,V=l+2,D=R.Cartesian3.fromArray(m,l,U);t.st&&(P=L.Matrix3.multiplyByVector(M,D,Q),P=v.project(d.cartesianToCartographic(P,te),W),R.Cartesian3.subtract(P,w,P),B.x=(P.x+y)/(2*y),B.y=(P.y+c)/(2*c),I.x=Math.min(B.x,I.x),I.y=Math.min(B.y,I.y),T.x=Math.max(B.x,T.x),T.y=Math.max(B.y,T.y),p&&(a[C+N]=B.x,a[C+1+N]=B.y),a[C++]=B.x,a[C++]=B.y),(t.normal||t.tangent||t.bitangent||h)&&(i=d.geodeticSurfaceNormal(D,i),h&&(_[l+s]=-i.x,_[F+s]=-i.y,_[V+s]=-i.z),(t.normal||t.tangent||t.bitangent)&&((t.tangent||t.bitangent)&&(n=R.Cartesian3.normalize(R.Cartesian3.cross(R.Cartesian3.UNIT_Z,i,n),n),L.Matrix3.multiplyByVector(E,n,n)),t.normal&&(x[l]=i.x,x[F]=i.y,x[V]=i.z,p&&(x[l+s]=-i.x,x[F+s]=-i.y,x[V+s]=-i.z)),t.tangent&&(g[l]=n.x,g[F]=n.y,g[V]=n.z,p&&(g[l+s]=-n.x,g[F+s]=-n.y,g[V+s]=-n.z)),t.bitangent&&(o=R.Cartesian3.normalize(R.Cartesian3.cross(i,n,o),o),b[l]=o.x,b[F]=o.y,b[V]=o.z,p&&(b[l+s]=o.x,b[F+s]=o.y,b[V+s]=o.z))))}if(t.st)for(var G=a.length,O=0;O<G;O+=2)a[O]=(a[O]-I.x)/(T.x-I.x),a[O+1]=(a[O+1]-I.y)/(T.y-I.y);var u,r=new H.GeometryAttributes;return t.position&&(A=Y.EllipseGeometryLibrary.raisePositionsToHeight(m,e,p),r.position=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:A})),t.st&&(r.st=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:a})),t.normal&&(r.normal=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x})),t.tangent&&(r.tangent=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:g})),t.bitangent&&(r.bitangent=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:b})),h&&(r.extrudeDirection=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_})),p&&k.defined(e.offsetAttribute)&&(u=new Uint8Array(f),u=e.offsetAttribute===S.GeometryOffsetAttribute.TOP?S.arrayFill(u,1,0,f/2):(A=e.offsetAttribute===S.GeometryOffsetAttribute.NONE?0:1,S.arrayFill(u,A)),r.applyOffset=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:u})),r}function h(e){for(var t,r,a=new Array(e*(e+1)*12-6),i=0,n=0,o=1,s=0;s<3;s++)a[i++]=o++,a[i++]=n,a[i++]=o;for(s=2;s<e+1;++s){for(o=s*(s+1)-1,n=(s-1)*s-1,a[i++]=o++,a[i++]=n,a[i++]=o,t=2*s,r=0;r<t-1;++r)a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n,a[i++]=o;a[i++]=o++,a[i++]=n,a[i++]=o}for(t=2*e,++o,++n,s=0;s<t-1;++s)a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n,a[i++]=o;for(a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n++,a[i++]=n,++n,s=e-1;1<s;--s){for(a[i++]=n++,a[i++]=n,a[i++]=o,t=2*s,r=0;r<t-1;++r)a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n,a[i++]=o;a[i++]=n++,a[i++]=n++,a[i++]=o++}for(s=0;s<3;s++)a[i++]=n++,a[i++]=n,a[i++]=o;return a}var o=new R.Cartesian3;var x=new L.BoundingSphere,g=new L.BoundingSphere;function s(e){for(var t=e.center,r=e.ellipsoid,a=e.semiMajorAxis,i=R.Cartesian3.multiplyByScalar(r.geodeticSurfaceNormal(t,U),e.height,U),r=(x.center=R.Cartesian3.add(t,i,x.center),x.radius=a,i=R.Cartesian3.multiplyByScalar(r.geodeticSurfaceNormal(t,i),e.extrudedHeight,i),g.center=R.Cartesian3.add(t,i,g.center),g.radius=a,Y.EllipseGeometryLibrary.computeEllipsePositions(e,!0,!0)),t=r.positions,i=r.numPts,a=r.outerPositions,r=L.BoundingSphere.union(x,g),n=f(t,e,!0),o=(u=h(i)).length,s=(u.length=2*o,t.length/3),l=0;l<o;l+=3)u[l+o]=u[l+2]+s,u[l+1+o]=u[l+1]+s,u[l+2+o]=u[l]+s;var i=c.IndexDatatype.createTypedArray(2*s/3,u),t=new z.Geometry({attributes:n,indices:i,primitiveType:z.PrimitiveType.TRIANGLES}),n=function(m,e){for(var t=e.vertexFormat,r=e.center,p=e.semiMajorAxis,y=e.semiMinorAxis,c=e.ellipsoid,d=e.height,A=e.extrudedHeight,a=e.stRotation,i=m.length/3*2,f=new Float64Array(3*i),h=t.st?new Float32Array(2*i):void 0,x=t.normal?new Float32Array(3*i):void 0,g=t.tangent?new Float32Array(3*i):void 0,b=t.bitangent?new Float32Array(3*i):void 0,_=e.shadowVolume,C=_?new Float32Array(3*i):void 0,v=0,n=X,w=$,M=ee,E=new L.GeographicProjection(c),I=E.project(c.cartesianToCartographic(r,te),re),r=c.scaleToGeodeticSurface(r,U),r=(c.geodeticSurfaceNormal(r,r),L.Quaternion.fromAxisAngle(r,a,K)),T=L.Matrix3.fromQuaternion(r,q),G=R.Cartesian2.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,ae),N=R.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,ie),P=(u=m.length)/3*2,o=0;o<u;o+=3){var F=o+1,V=o+2,s=R.Cartesian3.fromArray(m,o,U),D=(t.st&&(l=L.Matrix3.multiplyByVector(T,s,Q),l=E.project(c.cartesianToCartographic(l,te),W),R.Cartesian3.subtract(l,I,l),B.x=(l.x+p)/(2*p),B.y=(l.y+y)/(2*y),G.x=Math.min(B.x,G.x),G.y=Math.min(B.y,G.y),N.x=Math.max(B.x,N.x),N.y=Math.max(B.y,N.y),h[v+P]=B.x,h[v+1+P]=B.y,h[v++]=B.x,h[v++]=B.y),s=c.scaleToGeodeticSurface(s,s),l=R.Cartesian3.clone(s,Q),n=c.geodeticSurfaceNormal(s,n),_&&(C[o+u]=-n.x,C[F+u]=-n.y,C[V+u]=-n.z),R.Cartesian3.multiplyByScalar(n,d,J)),s=R.Cartesian3.add(s,D,s),D=R.Cartesian3.multiplyByScalar(n,A,D),l=R.Cartesian3.add(l,D,l);t.position&&(f[o+u]=l.x,f[F+u]=l.y,f[V+u]=l.z,f[o]=s.x,f[F]=s.y,f[V]=s.z),(t.normal||t.tangent||t.bitangent)&&(M=R.Cartesian3.clone(n,M),D=R.Cartesian3.fromArray(m,(o+3)%u,J),R.Cartesian3.subtract(D,s,D),s=R.Cartesian3.subtract(l,s,W),n=R.Cartesian3.normalize(R.Cartesian3.cross(s,D,n),n),t.normal&&(x[o]=n.x,x[F]=n.y,x[V]=n.z,x[o+u]=n.x,x[F+u]=n.y,x[V+u]=n.z),t.tangent&&(w=R.Cartesian3.normalize(R.Cartesian3.cross(M,n,w),w),g[o]=w.x,g[F]=w.y,g[V]=w.z,g[o+u]=w.x,g[o+1+u]=w.y,g[o+2+u]=w.z),t.bitangent&&(b[o]=M.x,b[F]=M.y,b[V]=M.z,b[o+u]=M.x,b[F+u]=M.y,b[V+u]=M.z))}if(t.st)for(var u=h.length,O=0;O<u;O+=2)h[O]=(h[O]-G.x)/(N.x-G.x),h[O+1]=(h[O+1]-G.y)/(N.y-G.y);return a=new H.GeometryAttributes,t.position&&(a.position=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f})),t.st&&(a.st=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:h})),t.normal&&(a.normal=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x})),t.tangent&&(a.tangent=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:g})),t.bitangent&&(a.bitangent=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:b})),_&&(a.extrudeDirection=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:C})),k.defined(e.offsetAttribute)&&(r=new Uint8Array(i),r=e.offsetAttribute===S.GeometryOffsetAttribute.TOP?S.arrayFill(r,1,0,i/2):(i=e.offsetAttribute===S.GeometryOffsetAttribute.NONE?0:1,S.arrayFill(r,i)),a.applyOffset=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:r})),a}(a,e),u=function(e){for(var t=e.length/3,r=c.IndexDatatype.createTypedArray(t,6*t),a=0,i=0;i<t;i++){var n=i,o=i+t,s=(n+1)%t,l=s+t;r[a++]=n,r[a++]=o,r[a++]=s,r[a++]=s,r[a++]=o,r[a++]=l}return r}(a),i=c.IndexDatatype.createTypedArray(2*a.length/3,u),e=new z.Geometry({attributes:n,indices:i,primitiveType:z.PrimitiveType.TRIANGLES}),a=y.GeometryPipeline.combineInstances([new m.GeometryInstance({geometry:t}),new m.GeometryInstance({geometry:e})]);return{boundingSphere:r,attributes:a[0].attributes,indices:a[0].indices}}function l(e,t,r,a,i,n,m){for(var o=Y.EllipseGeometryLibrary.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:r,rotation:a,granularity:i},!1,!0).outerPositions,s=o.length/3,l=new Array(s),u=0;u<s;++u)l[u]=R.Cartesian3.fromArray(o,3*u);e=R.Rectangle.fromCartesianArray(l,n,m);return e.width>p.CesiumMath.PI&&(e.north=0<e.north?p.CesiumMath.PI_OVER_TWO-p.CesiumMath.EPSILON7:e.north,e.south=e.south<0?p.CesiumMath.EPSILON7-p.CesiumMath.PI_OVER_TWO:e.south,e.east=p.CesiumMath.PI,e.west=-p.CesiumMath.PI),e}function A(e){var t=(e=k.defaultValue(e,k.defaultValue.EMPTY_OBJECT)).center,r=k.defaultValue(e.ellipsoid,R.Ellipsoid.WGS84),a=e.semiMajorAxis,i=e.semiMinorAxis,n=k.defaultValue(e.granularity,p.CesiumMath.RADIANS_PER_DEGREE),o=k.defaultValue(e.vertexFormat,d.VertexFormat.DEFAULT),s=k.defaultValue(e.height,0),l=k.defaultValue(e.extrudedHeight,s);this._center=R.Cartesian3.clone(t),this._semiMajorAxis=a,this._semiMinorAxis=i,this._ellipsoid=R.Ellipsoid.clone(r),this._rotation=k.defaultValue(e.rotation,0),this._stRotation=k.defaultValue(e.stRotation,0),this._height=Math.max(l,s),this._granularity=n,this._vertexFormat=d.VertexFormat.clone(o),this._extrudedHeight=Math.min(l,s),this._shadowVolume=k.defaultValue(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}A.packedLength=R.Cartesian3.packedLength+R.Ellipsoid.packedLength+d.VertexFormat.packedLength+9,A.pack=function(e,t,r){return r=k.defaultValue(r,0),R.Cartesian3.pack(e._center,t,r),r+=R.Cartesian3.packedLength,R.Ellipsoid.pack(e._ellipsoid,t,r),r+=R.Ellipsoid.packedLength,d.VertexFormat.pack(e._vertexFormat,t,r),r+=d.VertexFormat.packedLength,t[r++]=e._semiMajorAxis,t[r++]=e._semiMinorAxis,t[r++]=e._rotation,t[r++]=e._stRotation,t[r++]=e._height,t[r++]=e._granularity,t[r++]=e._extrudedHeight,t[r++]=e._shadowVolume?1:0,t[r]=k.defaultValue(e._offsetAttribute,-1),t};var b=new R.Cartesian3,_=new R.Ellipsoid,C=new d.VertexFormat,v={center:b,ellipsoid:_,vertexFormat:C,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};A.unpack=function(e,t,r){t=k.defaultValue(t,0);var m=R.Cartesian3.unpack(e,t,b),p=(t+=R.Cartesian3.packedLength,R.Ellipsoid.unpack(e,t,_)),y=(t+=R.Ellipsoid.packedLength,d.VertexFormat.unpack(e,t,C)),a=(t+=d.VertexFormat.packedLength,e[t++]),i=e[t++],n=e[t++],o=e[t++],s=e[t++],l=e[t++],u=e[t++],c=1===e[t++],e=e[t];return k.defined(r)?(r._center=R.Cartesian3.clone(m,r._center),r._ellipsoid=R.Ellipsoid.clone(p,r._ellipsoid),r._vertexFormat=d.VertexFormat.clone(y,r._vertexFormat),r._semiMajorAxis=a,r._semiMinorAxis=i,r._rotation=n,r._stRotation=o,r._height=s,r._granularity=l,r._extrudedHeight=u,r._shadowVolume=c,r._offsetAttribute=-1===e?void 0:e,r):(v.height=s,v.extrudedHeight=u,v.granularity=l,v.stRotation=o,v.rotation=n,v.semiMajorAxis=a,v.semiMinorAxis=i,v.shadowVolume=c,v.offsetAttribute=-1===e?void 0:e,new A(v))},A.computeRectangle=function(e,t){var r=(e=k.defaultValue(e,k.defaultValue.EMPTY_OBJECT)).center,a=k.defaultValue(e.ellipsoid,R.Ellipsoid.WGS84),i=e.semiMajorAxis,n=e.semiMinorAxis,o=k.defaultValue(e.granularity,p.CesiumMath.RADIANS_PER_DEGREE);return l(r,i,n,k.defaultValue(e.rotation,0),o,a,t)},A.createGeometry=function(e){var t,r,a,i,n;if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0))return n=e._height,a=e._extrudedHeight,r=!p.CesiumMath.equalsEpsilon(n,a,0,p.CesiumMath.EPSILON2),e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center),n={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:n,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation},r?(n.extrudedHeight=a,n.shadowVolume=e._shadowVolume,n.offsetAttribute=e._offsetAttribute,t=s(n)):(a=(r=n).center,o=R.Cartesian3.multiplyByScalar(r.ellipsoid.geodeticSurfaceNormal(a,o),r.height,o),o=R.Cartesian3.add(a,o,o),a=new L.BoundingSphere(o,r.semiMajorAxis),i=(n=Y.EllipseGeometryLibrary.computeEllipsePositions(r,!0,!1)).positions,n=n.numPts,r=f(i,r,!1),n=h(n),t={boundingSphere:a,attributes:r,indices:c.IndexDatatype.createTypedArray(i.length/3,n)},k.defined(e._offsetAttribute)&&(a=t.attributes.position.values.length,r=new Uint8Array(a/3),i=e._offsetAttribute===S.GeometryOffsetAttribute.NONE?0:1,S.arrayFill(r,i),t.attributes.applyOffset=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:r}))),new z.Geometry({attributes:t.attributes,indices:t.indices,primitiveType:z.PrimitiveType.TRIANGLES,boundingSphere:t.boundingSphere,offsetAttribute:e._offsetAttribute})},A.createShadowVolume=function(e,t,r){var a=e._granularity,i=e._ellipsoid,t=t(a,i),r=r(a,i);return new A({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:i,rotation:e._rotation,stRotation:e._stRotation,granularity:a,extrudedHeight:t,height:r,vertexFormat:d.VertexFormat.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(A.prototype,{rectangle:{get:function(){return k.defined(this._rectangle)||(this._rectangle=l(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return k.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0==t)return[0,0,0,1,1,0];for(var r=Y.EllipseGeometryLibrary.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0).outerPositions,a=r.length/3,i=new Array(a),n=0;n<a;++n)i[n]=R.Cartesian3.fromArray(r,3*n);var o=e._ellipsoid,e=e.rectangle;return z.Geometry._textureCoordinateRotationPoints(i,t,o,e)}(this)),this._textureCoordinateRotationPoints}}}),e.EllipseGeometry=A});
