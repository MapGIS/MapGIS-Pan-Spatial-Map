define(["./AxisAlignedBoundingBox-d272def4","./Cartesian2-38b35910","./when-ae2e0b60","./TerrainEncoding-9adc5a79","./IndexDatatype-516320ea","./Math-5bbcea10","./Transforms-07a9fab5","./Check-f996273c","./WebMercatorProjection-cf614542","./createTaskProcessorWorker","./AttributeCompression-25f42564","./ComponentDatatype-e44126e4","./WebGLConstants-35626ea2","./combine-276652d0","./RuntimeError-ac2797b4"],function(he,te,re,ue,Ie,ne,ie,e,oe,t,r,n,i,o,a){"use strict";function ae(){e.DeveloperError.throwInstantiationError()}Object.defineProperties(ae.prototype,{errorEvent:{get:e.DeveloperError.throwInstantiationError},credit:{get:e.DeveloperError.throwInstantiationError},tilingScheme:{get:e.DeveloperError.throwInstantiationError},ready:{get:e.DeveloperError.throwInstantiationError},readyPromise:{get:e.DeveloperError.throwInstantiationError},hasWaterMask:{get:e.DeveloperError.throwInstantiationError},hasVertexNormals:{get:e.DeveloperError.throwInstantiationError},availability:{get:e.DeveloperError.throwInstantiationError}});var s=[],d=(ae.getRegularGridIndices=function(e,t){var r=s[e],n=(re.defined(r)||(s[e]=r=[]),r[t]);return re.defined(n)||g(e,t,n=e*t<ne.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n},[]),I=(ae.getRegularGridIndicesAndEdgeIndices=function(e,t){var r,n,i,o,a=d[e],s=(re.defined(a)||(d[e]=a=[]),a[t]);return re.defined(s)||(r=ae.getRegularGridIndices(e,t),n=(e=l(e,t)).westIndicesSouthToNorth,i=e.southIndicesEastToWest,o=e.eastIndicesNorthToSouth,e=e.northIndicesWestToEast,s=a[t]={indices:r,westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:e}),s},[]);function l(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function g(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,d=s+e,h=d+1,c=s+1;r[n++]=s,r[n++]=d,r[n++]=c,r[n++]=c,r[n++]=d,r[n++]=h,++i}++i}}function c(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}ae.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var h,r,u,n,i,o,a,s,d=I[e],c=(re.defined(d)||(I[e]=d=[]),d[t]);return re.defined(c)||(u=(h=e*t)+(n=2*e+2*t),n=(r=(e-1)*(t-1)*6)+6*Math.max(0,n-4),i=(s=l(e,t)).westIndicesSouthToNorth,o=s.southIndicesEastToWest,a=s.eastIndicesNorthToSouth,s=s.northIndicesWestToEast,g(e,t,e=Ie.IndexDatatype.createTypedArray(u,n),0),ae.addSkirtIndices(i,o,a,s,h,e,r),c=d[t]={indices:e,westIndicesSouthToNorth:i,southIndicesEastToWest:o,eastIndicesNorthToSouth:a,northIndicesWestToEast:s,indexCountWithoutSkirts:r}),c},ae.addSkirtIndices=function(e,t,r,n,i,o,a){a=c(e,i,o,a),a=c(t,i+=e.length,o,a),a=c(r,i+=t.length,o,a),c(n,i+=r.length,o,a)},ae.heightmapTerrainQuality=.25,ae.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*ae.heightmapTerrainQuality/(t*r)},ae.prototype.requestTileGeometry=e.DeveloperError.throwInstantiationError,ae.prototype.getLevelMaximumGeometricError=e.DeveloperError.throwInstantiationError,ae.prototype.getTileDataAvailable=e.DeveloperError.throwInstantiationError,ae.prototype.loadTileDataAvailability=e.DeveloperError.throwInstantiationError;var le=32767,se=new te.Cartesian3,ge=new te.Cartesian3,me=new te.Cartesian3,de=new te.Cartographic,ce=new te.Cartesian2;function Te(e,t,h,u,r,I,l,n,i){for(var o=Number.POSITIVE_INFINITY,g=r.north,m=r.south,a=r.east,s=r.west,T=(a<s&&(a+=ne.CesiumMath.TWO_PI),e.length),d=0;d<T;++d){var c=e[d],E=h[c],c=u[c],c=(de.longitude=ne.CesiumMath.lerp(s,a,c.x),de.latitude=ne.CesiumMath.lerp(m,g,c.y),de.height=E-t,I.cartographicToCartesian(de,se));ie.Matrix4.multiplyByPoint(l,c,c),te.Cartesian3.minimumByComponent(c,n,n),te.Cartesian3.maximumByComponent(c,i,i),o=Math.min(o,de.height)}return o}function Ee(h,e,t,r,u,I,n,l,i,g,m,T,E,p){for(var f=re.defined(n),y=i.north,N=i.south,o=i.east,w=i.west,v=(o<w&&(o+=ne.CesiumMath.TWO_PI),t.length),a=0;a<v;++a){var S,M,s=t[a],d=u[s],c=I[s],d=(de.longitude=ne.CesiumMath.lerp(w,o,c.x)+E,de.latitude=ne.CesiumMath.lerp(N,y,c.y)+p,de.height=d-g,l.cartographicToCartesian(de,se));f&&(ce.x=n[s=2*s],ce.y=n[1+s]),r.hasWebMercatorT&&(S=(oe.WebMercatorProjection.geodeticLatitudeToMercatorAngle(de.latitude)-m)*T),r.hasGeodeticSurfaceNormals&&(M=l.geodeticSurfaceNormal(d)),e=r.encode(h,e,d,c,de.height,ce,S,M)}}function pe(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),(r=re.defined(r)?r:Array.prototype.slice.call(e)).sort(t),r}return t(function(e,h){for(var u,I,t=(j=e.quantizedVertices).length/3,l=e.octEncodedNormals,g=e.westIndices.length+e.eastIndices.length+e.southIndices.length+e.northIndices.length,m=e.includeWebMercatorT,T=e.exaggeration,E=e.exaggerationRelativeHeight,p=1!==T,r=te.Rectangle.clone(e.rectangle),f=r.west,y=r.south,N=r.east,w=r.north,n=te.Ellipsoid.clone(e.ellipsoid),v=e.minimumHeight,S=e.maximumHeight,M=e.relativeToCenter,b=ie.Transforms.eastNorthUpToFixedFrame(M,n),x=ie.Matrix4.inverseTransformation(b,new ie.Matrix4),C=(m&&(u=oe.WebMercatorProjection.geodeticLatitudeToMercatorAngle(y),I=1/(oe.WebMercatorProjection.geodeticLatitudeToMercatorAngle(w)-u)),j.subarray(0,t)),A=j.subarray(t,2*t),W=j.subarray(2*t,3*t),P=re.defined(l),i=new Array(t),o=new Array(t),D=new Array(t),k=m?new Array(t):[],F=p?new Array(t):[],a=ge,s=(a.x=Number.POSITIVE_INFINITY,a.y=Number.POSITIVE_INFINITY,a.z=Number.POSITIVE_INFINITY,me),H=(s.x=Number.NEGATIVE_INFINITY,s.y=Number.NEGATIVE_INFINITY,s.z=Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),_=Number.NEGATIVE_INFINITY,G=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,d=0;d<t;++d){var Y=C[d],O=A[d],Y=Y/le,O=O/le,B=ne.CesiumMath.lerp(v,S,W[d]/le),R=(de.longitude=ne.CesiumMath.lerp(f,N,Y),de.latitude=ne.CesiumMath.lerp(y,w,O),de.height=B,H=Math.min(de.longitude,H),_=Math.max(de.longitude,_),G=Math.min(de.latitude,G),V=Math.max(de.latitude,V),n.cartographicToCartesian(de));i[d]=new te.Cartesian2(Y,O),o[d]=B,D[d]=R,m&&(k[d]=(oe.WebMercatorProjection.geodeticLatitudeToMercatorAngle(de.latitude)-u)*I),p&&(F[d]=n.geodeticSurfaceNormal(R)),ie.Matrix4.multiplyByPoint(x,R,se),te.Cartesian3.minimumByComponent(se,a,a),te.Cartesian3.maximumByComponent(se,s,s)}var L,j=pe(e.westIndices,function(e,t){return i[e].y-i[t].y}),U=pe(e.eastIndices,function(e,t){return i[t].y-i[e].y}),z=pe(e.southIndices,function(e,t){return i[t].x-i[e].x}),q=pe(e.northIndices,function(e,t){return i[e].x-i[t].x}),c=(v<0&&(L=new ue.EllipsoidalOccluder(n).computeHorizonCullingPointPossiblyUnderEllipsoid(M,D,v)),Math.min(v,Te(e.westIndices,e.westSkirtHeight,o,i,r,n,x,a,s)));c=Math.min(c,Te(e.southIndices,e.southSkirtHeight,o,i,r,n,x,a,s)),c=Math.min(c,Te(e.eastIndices,e.eastSkirtHeight,o,i,r,n,x,a,s)),c=Math.min(c,Te(e.northIndices,e.northSkirtHeight,o,i,r,n,x,a,s));for(var Q,K=new he.AxisAlignedBoundingBox(a,s,M),X=new ue.TerrainEncoding(M,K,c,S,b,P,m,p,T,E),K=X.stride,Z=new Float32Array(t*K+g*K),J=0,$=0;$<t;++$)P&&(ce.x=l[Q=2*$],ce.y=l[1+Q]),J=X.encode(Z,J,D[$],i[$],o[$],ce,k[$],F[$]);c=Math.max(0,2*(g-4)),b=e.indices.length+3*c;(T=Ie.IndexDatatype.createTypedArray(t+g,b)).set(e.indices,0);var g=E=1e-4*(_-H),b=c=1e-4*(V-G),c=-c,ee=t*K;return Ee(Z,ee,j,X,o,i,l,n,r,e.westSkirtHeight,u,I,-E,0),Ee(Z,ee+=e.westIndices.length*K,z,X,o,i,l,n,r,e.southSkirtHeight,u,I,0,c),Ee(Z,ee+=e.southIndices.length*K,U,X,o,i,l,n,r,e.eastSkirtHeight,u,I,g,0),Ee(Z,ee+=e.eastIndices.length*K,q,X,o,i,l,n,r,e.northSkirtHeight,u,I,0,b),ae.addSkirtIndices(j,z,U,q,t,T,e.indices.length),h.push(Z.buffer,T.buffer),{vertices:Z.buffer,indices:T.buffer,westIndicesSouthToNorth:j,southIndicesEastToWest:z,eastIndicesNorthToSouth:U,northIndicesWestToEast:q,vertexStride:K,center:M,minimumHeight:v,maximumHeight:S,occludeePointInScaledSpace:L,encoding:X,indexCountWithoutSkirts:e.indices.length}})});
