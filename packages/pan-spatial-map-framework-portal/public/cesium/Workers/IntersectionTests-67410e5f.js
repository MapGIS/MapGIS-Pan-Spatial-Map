define(["exports","./Cartesian2-8dbd81c1","./when-695b7bde","./Check-c47ad5ed","./Transforms-afef28e3","./Math-09ca1a10"],function(t,w,d,a,v,R){"use strict";var S={};function i(t,a,e){var r=t+a;return R.CesiumMath.sign(t)!==R.CesiumMath.sign(a)&&Math.abs(r/Math.max(Math.abs(t),Math.abs(a)))<e?0:r}S.computeDiscriminant=function(t,a,e){return a*a-4*t*e},S.computeRealRoots=function(t,a,e){if(0===t)return 0===a?[]:[-e/a];if(0===a){if(0===e)return[0,0];var r=Math.abs(e),n=Math.abs(t);if(r<n&&r/n<R.CesiumMath.EPSILON14)return[0,0];if(n<r&&n/r<R.CesiumMath.EPSILON14)return[];if((n=-e/t)<0)return[];r=Math.sqrt(n);return[-r,r]}if(0===e)return(n=-a/t)<0?[n,0]:[0,n];r=i(a*a,-(4*t*e),R.CesiumMath.EPSILON14);if(r<0)return[];n=-.5*i(a,R.CesiumMath.sign(a)*Math.sqrt(r),R.CesiumMath.EPSILON14);return 0<a?[n/t,e/n]:[e/n,n/t]};var f={};function s(t,a,e,r){var c,n,a=a/3,e=e/3,l=t*e,h=a*r,M=a*a,i=e*e,s=t*e-M,o=t*r-a*e,m=a*r-i,f=4*s*m-o*o;if(f<0)return u=(u=(c=(C=-((n=l*i<=M*h?-2*a*(d=s)+(C=t)*o:-(C=r)*o+2*e*(d=m))<0?-1:1)*Math.abs(C)*Math.sqrt(-f))-n)/2)<0?-Math.pow(-u,1/3):Math.pow(u,1/3),C=c===C?-u:-d/u,n=d<=0?u+C:-n/(u*u+C*C+d),l*i<=M*h?[(n-a)/t]:[-r/(n+e)];var u=s,C=-2*a*s+t*o,d=m,l=-r*o+2*e*m,i=Math.sqrt(f),M=Math.sqrt(3)/2,h=Math.abs(Math.atan2(t*i,-C)/3),s=(n=2*Math.sqrt(-u),Math.cos(h)),o=(c=n*s,n*(-s/2-M*Math.sin(h))),m=2*a<c+o?c-a:o-a,f=t,C=m/f,h=Math.abs(Math.atan2(r*i,-l)/3),u=-r,t=(c=(n=2*Math.sqrt(-d))*(s=Math.cos(h)))+(o=n*(-s/2-M*Math.sin(h)))<2*e?c+e:o+e,i=u/t,l=-m*t-f*u,r=(e*l-a*(m*u))/(-a*l+e*(f*t));return C<=r?C<=i?r<=i?[C,r,i]:[C,i,r]:[i,C,r]:C<=i?[r,C,i]:r<=i?[r,i,C]:[i,r,C]}f.computeDiscriminant=function(t,a,e,r){var n=a*a,i=e*e;return 18*t*a*e*r+n*i-27*(t*t)*(r*r)-4*(t*i*e+n*a*r)},f.computeRealRoots=function(t,a,e,r){var n;if(0===t)return S.computeRealRoots(a,e,r);if(0!==a)return 0===e?0===r?(i=-a/t)<0?[i,0,0]:[0,0,i]:s(t,a,0,r):0===r?0===(n=S.computeRealRoots(t,a,e)).length?[0]:n[1]<=0?[n[0],n[1],0]:0<=n[0]?[0,n[0],n[1]]:[n[0],0,n[1]]:s(t,a,e,r);if(0!==e)return 0===r?0===(n=S.computeRealRoots(t,0,e)).Length?[0]:[n[0],0,n[1]]:s(t,0,e,r);if(0===r)return[0,0,0];var i,a=(i=-r/t)<0?-Math.pow(-i,1/3):Math.pow(i,1/3);return[a,a,a]};var x={};function C(t,a,e,r){var n=t*t,i=a-3*n/8,s=e-a*t/2+n*t/8,r=r-e*t/4+a*n/16-3*n*n/256,e=f.computeRealRoots(1,2*i,i*i-4*r,-s*s);if(0<e.length){a=-t/4,n=e[e.length-1];if(Math.abs(n)<R.CesiumMath.EPSILON14){var t=S.computeRealRoots(1,i,r);if(2===t.length){var o,u,e=t[0],r=t[1];if(0<=e&&0<=r)return t=Math.sqrt(e),[a-(u=Math.sqrt(r)),a-t,a+t,a+u];if(0<=e&&r<0)return[a-(o=Math.sqrt(e)),a+o];if(e<0&&0<=r)return[a-(o=Math.sqrt(r)),a+o]}return[]}if(0<n)return u=(i+n+s/(t=Math.sqrt(n)))/2,e=S.computeRealRoots(1,t,(i+n-s/t)/2),r=S.computeRealRoots(1,-t,u),0!==e.length?(e[0]+=a,e[1]+=a,0!==r.length?(r[0]+=a,r[1]+=a,e[1]<=r[0]?[e[0],e[1],r[0],r[1]]:r[1]<=e[0]?[r[0],r[1],e[0],e[1]]:e[0]>=r[0]&&e[1]<=r[1]?[r[0],e[0],e[1],r[1]]:r[0]>=e[0]&&r[1]<=e[1]?[e[0],r[0],r[1],e[1]]:e[0]>r[0]&&e[0]<r[1]?[r[0],e[0],r[1],e[1]]:[e[0],r[0],e[1],r[1]]):e):0!==r.length?(r[0]+=a,r[1]+=a,r):[]}return[]}function l(t,a,e,r){var n=t*t,i=f.computeRealRoots(1,-2*a,e*t+a*a-4*r,n*r-e*a*t+e*e);if(0<i.length){var s,c,l,h,M,i=i[0],a=a-i,o=a*a,m=t/2,a=a/2,u=o-4*r,o=o+4*Math.abs(r),C=n-4*i,n=n+4*Math.abs(i),n=(C=i<0||u*n<C*o?(s=(n=Math.sqrt(C))/2,0===n?0:(t*a-e)/n):(s=0===(o=Math.sqrt(u))?0:(t*a-e)/o,o/2),0==m&&0===s?l=c=0:R.CesiumMath.sign(m)===R.CesiumMath.sign(s)?l=i/(c=m+s):c=i/(l=m-s),0==a&&0===C?M=h=0:R.CesiumMath.sign(a)===R.CesiumMath.sign(C)?M=r/(h=a+C):h=r/(M=a-C),S.computeRealRoots(1,c,h)),u=S.computeRealRoots(1,l,M);if(0!==n.length)return 0!==u.length?n[1]<=u[0]?[n[0],n[1],u[0],u[1]]:u[1]<=n[0]?[u[0],u[1],n[0],n[1]]:n[0]>=u[0]&&n[1]<=u[1]?[u[0],n[0],n[1],u[1]]:u[0]>=n[0]&&u[1]<=n[1]?[n[0],u[0],u[1],n[1]]:n[0]>u[0]&&n[0]<u[1]?[u[0],n[0],u[1],n[1]]:[n[0],u[0],n[1],u[1]]:n;if(0!==u.length)return u}return[]}function e(t,a){a=w.Cartesian3.clone(d.defaultValue(a,w.Cartesian3.ZERO)),w.Cartesian3.equals(a,w.Cartesian3.ZERO)||w.Cartesian3.normalize(a,a),this.origin=w.Cartesian3.clone(d.defaultValue(t,w.Cartesian3.ZERO)),this.direction=a}x.computeDiscriminant=function(t,a,e,r,n){var i=t*t,s=a*a,o=s*a,u=e*e,c=u*e,C=r*r,l=C*r,h=n*n;return s*u*C-4*o*l-4*t*c*C+18*t*a*e*l-27*i*C*C+256*(i*t)*(h*n)+n*(18*o*e*r-4*s*c+16*t*u*u-80*t*a*u*r-6*t*s*C+144*i*e*C)+h*(144*t*s*e-27*s*s-128*i*u-192*i*a*r)},x.computeRealRoots=function(t,a,e,r,n){if(Math.abs(t)<R.CesiumMath.EPSILON15)return f.computeRealRoots(a,e,r,n);var i=a/t,s=e/t,o=r/t,u=n/t,a=i<0?1:0;switch(a=(a=(a+=s<0?a+1:a)+(o<0?a+1:a))+(u<0?a+1:a)){case 0:return C(i,s,o,u);case 1:case 2:return l(i,s,o,u);case 3:case 4:return C(i,s,o,u);case 5:return l(i,s,o,u);case 6:case 7:return C(i,s,o,u);case 8:return l(i,s,o,u);case 9:case 10:return C(i,s,o,u);case 11:return l(i,s,o,u);case 12:case 13:case 14:case 15:return C(i,s,o,u);default:return}},e.clone=function(t,a){if(d.defined(t))return d.defined(a)?(a.origin=w.Cartesian3.clone(t.origin),a.direction=w.Cartesian3.clone(t.direction),a):new e(t.origin,t.direction)},e.getPoint=function(t,a,e){return d.defined(e)||(e=new w.Cartesian3),e=w.Cartesian3.multiplyByScalar(t.direction,a,e),w.Cartesian3.add(t.origin,e,e)};var c={rayPlane:function(t,a,e){d.defined(e)||(e=new w.Cartesian3);var r=t.origin,t=t.direction,n=a.normal,i=w.Cartesian3.dot(n,t);if(!(Math.abs(i)<R.CesiumMath.EPSILON15)){a=(-a.distance-w.Cartesian3.dot(n,r))/i;if(!(a<0))return e=w.Cartesian3.multiplyByScalar(t,a,e),w.Cartesian3.add(r,e,e)}}},M=new w.Cartesian3,m=new w.Cartesian3,g=new w.Cartesian3,p=new w.Cartesian3,y=new w.Cartesian3,u=(c.rayTriangleParametric=function(t,a,e,r,n){n=d.defaultValue(n,!1);var i,s,c,l=t.origin,t=t.direction,e=w.Cartesian3.subtract(e,a,M),r=w.Cartesian3.subtract(r,a,m),h=w.Cartesian3.cross(t,r,g),o=w.Cartesian3.dot(e,h);if(n){if(o<R.CesiumMath.EPSILON6)return;if(C=w.Cartesian3.subtract(l,a,p),(u=w.Cartesian3.dot(C,h))<0||o<u)return;if(i=w.Cartesian3.cross(C,e,y),(s=w.Cartesian3.dot(t,i))<0||o<u+s)return;c=w.Cartesian3.dot(r,i)/o}else{if(Math.abs(o)<R.CesiumMath.EPSILON6)return;var u,n=1/o,C=w.Cartesian3.subtract(l,a,p);if((u=w.Cartesian3.dot(C,h)*n)<0||1<u)return;if(i=w.Cartesian3.cross(C,e,y),(s=w.Cartesian3.dot(t,i)*n)<0||1<u+s)return;c=w.Cartesian3.dot(r,i)*n}return c},c.rayTriangle=function(t,a,e,r,n,i){a=c.rayTriangleParametric(t,a,e,r,n);if(d.defined(a)&&!(a<0))return d.defined(i)||(i=new w.Cartesian3),w.Cartesian3.multiplyByScalar(t.direction,a,i),w.Cartesian3.add(t.origin,i,i)},new e);c.lineSegmentTriangle=function(t,a,e,r,n,i,s){var o=u,e=(w.Cartesian3.clone(t,o.origin),w.Cartesian3.subtract(a,t,o.direction),w.Cartesian3.normalize(o.direction,o.direction),c.rayTriangleParametric(o,e,r,n,i));if(!(!d.defined(e)||e<0||e>w.Cartesian3.distance(t,a)))return d.defined(s)||(s=new w.Cartesian3),w.Cartesian3.multiplyByScalar(o.direction,e,s),w.Cartesian3.add(o.origin,s,s)};var o={root0:0,root1:0};function h(t,a,e){d.defined(e)||(e=new v.Interval);var r=t.origin,t=t.direction,n=a.center,a=a.radius*a.radius,r=w.Cartesian3.subtract(r,n,g),n=function(t,a,e,r){var n;if(!((e=a*a-4*t*e)<0)){if(0<e)return i=1/(2*t),(n=(-a+(e=Math.sqrt(e)))*i)<(e=(-a-e)*i)?(r.root0=n,r.root1=e):(r.root0=e,r.root1=n),r;var i=-a/(2*t);return 0!=i?(r.root0=r.root1=i,r):void 0}}(w.Cartesian3.dot(t,t),2*w.Cartesian3.dot(t,r),w.Cartesian3.magnitudeSquared(r)-a,o);if(d.defined(n))return e.start=n.root0,e.stop=n.root1,e}c.raySphere=function(t,a,e){if(e=h(t,a,e),d.defined(e)&&!(e.stop<0))return e.start=Math.max(e.start,0),e};var P=new e,b=(c.lineSegmentSphere=function(t,a,e,r){var n=P,a=(w.Cartesian3.clone(t,n.origin),w.Cartesian3.subtract(a,t,n.direction)),t=w.Cartesian3.magnitude(a);if(w.Cartesian3.normalize(a,a),r=h(n,e,r),!(!d.defined(r)||r.stop<0||r.start>t))return r.start=Math.max(r.start,0),r.stop=Math.min(r.stop,t),r},new w.Cartesian3),N=new w.Cartesian3;function O(t,a,e){var r=t+a;return R.CesiumMath.sign(t)!==R.CesiumMath.sign(a)&&Math.abs(r/Math.max(Math.abs(t),Math.abs(a)))<e?0:r}c.rayEllipsoid=function(t,a){var a=a.oneOverRadii,e=w.Cartesian3.multiplyComponents(a,t.origin,b),a=w.Cartesian3.multiplyComponents(a,t.direction,N),t=w.Cartesian3.magnitudeSquared(e),e=w.Cartesian3.dot(e,a);if(1<t){if(0<=e)return;var r,n,i,s,o=e*e,u=t-1;if(o<(n=(r=w.Cartesian3.magnitudeSquared(a))*u))return;if(n<o)return i=e*e-n,(o=(s=-e+Math.sqrt(i))/r)<(C=u/s)?new v.Interval(o,C):{start:C,stop:o};var C=Math.sqrt(u/r);return new v.Interval(C,C)}return t<1?(u=t-1,i=e*e-(n=(r=w.Cartesian3.magnitudeSquared(a))*u),s=-e+Math.sqrt(i),new v.Interval(0,s/r)):e<0?(r=w.Cartesian3.magnitudeSquared(a),new v.Interval(0,-e/r)):void 0};var q=new w.Cartesian3,L=new w.Cartesian3,I=new w.Cartesian3,E=new w.Cartesian3,z=new w.Cartesian3,T=new v.Matrix3,U=new v.Matrix3,W=new v.Matrix3,B=new v.Matrix3,V=new v.Matrix3,Z=new v.Matrix3,A=new v.Matrix3,D=new w.Cartesian3,k=new w.Cartesian3,F=new w.Cartographic,G=(c.grazingAltitudeLocation=function(t,a){var e=t.origin,r=t.direction;if(!w.Cartesian3.equals(e,w.Cartesian3.ZERO)){var c=a.geodeticSurfaceNormal(e,q);if(0<=w.Cartesian3.dot(r,c))return e}var c=d.defined(this.rayEllipsoid(t,a)),t=a.transformPositionToScaledSpace(r,q),n=w.Cartesian3.normalize(t,t),t=w.Cartesian3.mostOrthogonalAxis(t,E),t=w.Cartesian3.normalize(w.Cartesian3.cross(t,n,L),L),i=w.Cartesian3.normalize(w.Cartesian3.cross(n,t,I),I),s=T,n=(s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=t.x,s[4]=t.y,s[5]=t.z,s[6]=i.x,s[7]=i.y,s[8]=i.z,v.Matrix3.transpose(s,U)),l=v.Matrix3.fromScale(a.radii,W),t=v.Matrix3.fromScale(a.oneOverRadii,B),i=V,n=(i[0]=0,i[1]=-r.z,i[2]=r.y,i[3]=r.z,i[4]=0,i[5]=-r.x,i[6]=-r.y,i[7]=r.x,i[8]=0,v.Matrix3.multiply(v.Matrix3.multiply(n,t,Z),i,Z)),t=v.Matrix3.multiply(v.Matrix3.multiply(n,l,A),s,A),i=v.Matrix3.multiplyByVector(n,e,z),h=function(t,c,a,e,r){var n=e*e,i=r*r,s=(t[v.Matrix3.COLUMN1ROW1]-t[v.Matrix3.COLUMN2ROW2])*i,l=r*(e*O(t[v.Matrix3.COLUMN1ROW0],t[v.Matrix3.COLUMN0ROW1],R.CesiumMath.EPSILON15)+c.y),o=t[v.Matrix3.COLUMN0ROW0]*n+t[v.Matrix3.COLUMN2ROW2]*i+e*c.x+a,h=i*O(t[v.Matrix3.COLUMN2ROW1],t[v.Matrix3.COLUMN1ROW2],R.CesiumMath.EPSILON15),M=r*(e*O(t[v.Matrix3.COLUMN2ROW0],t[v.Matrix3.COLUMN0ROW2])+c.z),u=[];if(0==M&&0==h){if(0===(m=S.computeRealRoots(s,l,o)).length)return u;n=m[0],a=Math.sqrt(Math.max(1-n*n,0));return u.push(new w.Cartesian3(e,r*n,r*-a)),u.push(new w.Cartesian3(e,r*n,r*a)),2===m.length&&(i=m[1],t=Math.sqrt(Math.max(1-i*i,0)),u.push(new w.Cartesian3(e,r*i,r*-t)),u.push(new w.Cartesian3(e,r*i,r*t))),u}if(i=s*s+(n=h*h),t=2*(l*s+(a=M*h)),n=2*o*s+l*l-n+(c=M*M),a=2*(o*l-a),0==i&&0==t&&0==n&&0==a)return u;var m,f=(m=x.computeRealRoots(i,t,n,a,o*o-c)).length;if(0===f)return u;for(var d=0;d<f;++d){var C=m[d],g=C*C,p=Math.max(1-g,0),p=Math.sqrt(p),g=R.CesiumMath.sign(s)===R.CesiumMath.sign(o)?O(s*g+o,l*C,R.CesiumMath.EPSILON12):R.CesiumMath.sign(o)===R.CesiumMath.sign(l*C)?O(s*g,l*C+o,R.CesiumMath.EPSILON12):O(s*g+l*C,o,R.CesiumMath.EPSILON12),g=g*O(h*C,M,R.CesiumMath.EPSILON15);g<0?u.push(new w.Cartesian3(e,r*C,r*p)):0<g?u.push(new w.Cartesian3(e,r*C,r*-p)):0!==p?(u.push(new w.Cartesian3(e,r*C,r*-p)),u.push(new w.Cartesian3(e,r*C,r*p)),++d):u.push(new w.Cartesian3(e,r*C,r*p))}return u}(t,w.Cartesian3.negate(i,q),0,0,1),M=h.length;if(0<M){for(var o=w.Cartesian3.clone(w.Cartesian3.ZERO,k),u=Number.NEGATIVE_INFINITY,C=0;C<M;++C){var m=v.Matrix3.multiplyByVector(l,v.Matrix3.multiplyByVector(s,h[C],D),D),f=w.Cartesian3.normalize(w.Cartesian3.subtract(m,e,E),E),f=w.Cartesian3.dot(f,r);u<f&&(u=f,o=w.Cartesian3.clone(m,o))}n=a.cartesianToCartographic(o,F),u=R.CesiumMath.clamp(u,0,1),t=w.Cartesian3.magnitude(w.Cartesian3.subtract(o,e,E))*Math.sqrt(1-u*u);return n.height=t=c?-t:t,a.cartographicToCartesian(n,new w.Cartesian3)}},new w.Cartesian3);c.lineSegmentPlane=function(t,a,e,r){d.defined(r)||(r=new w.Cartesian3);var a=w.Cartesian3.subtract(a,t,G),n=e.normal,i=w.Cartesian3.dot(n,a);if(!(Math.abs(i)<R.CesiumMath.EPSILON6)){n=w.Cartesian3.dot(n,t),e=-(e.distance+n)/i;if(!(e<0||1<e))return w.Cartesian3.multiplyByScalar(a,e,r),w.Cartesian3.add(t,r,r),r}},c.trianglePlaneIntersection=function(t,a,e,r){var n,i,s=r.normal,o=r.distance,u=w.Cartesian3.dot(s,t)+o<0,C=w.Cartesian3.dot(s,a)+o<0,s=w.Cartesian3.dot(s,e)+o<0,o=0;if(1!=(o=(o+=u?1:0)+(C?1:0)+(s?1:0))&&2!=o||(n=new w.Cartesian3,i=new w.Cartesian3),1==o){if(u)return c.lineSegmentPlane(t,a,r,n),c.lineSegmentPlane(t,e,r,i),{positions:[t,a,e,n,i],indices:[0,3,4,1,2,4,1,4,3]};if(C)return c.lineSegmentPlane(a,e,r,n),c.lineSegmentPlane(a,t,r,i),{positions:[t,a,e,n,i],indices:[1,3,4,2,0,4,2,4,3]};if(s)return c.lineSegmentPlane(e,t,r,n),c.lineSegmentPlane(e,a,r,i),{positions:[t,a,e,n,i],indices:[2,3,4,0,1,4,0,4,3]}}else if(2==o){if(!u)return c.lineSegmentPlane(a,t,r,n),c.lineSegmentPlane(e,t,r,i),{positions:[t,a,e,n,i],indices:[1,2,4,1,4,3,0,3,4]};if(!C)return c.lineSegmentPlane(e,a,r,n),c.lineSegmentPlane(t,a,r,i),{positions:[t,a,e,n,i],indices:[2,0,4,2,4,3,1,3,4]};if(!s)return c.lineSegmentPlane(t,e,r,n),c.lineSegmentPlane(a,e,r,i),{positions:[t,a,e,n,i],indices:[0,1,4,0,4,3,2,3,4]}}},t.IntersectionTests=c,t.Ray=e});
