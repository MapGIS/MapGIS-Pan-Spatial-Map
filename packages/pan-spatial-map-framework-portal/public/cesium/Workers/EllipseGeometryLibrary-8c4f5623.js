define(["exports","./Cartesian2-38b35910","./Math-5bbcea10","./Transforms-07a9fab5"],function(e,E,V,y){"use strict";var a={},u=new E.Cartesian3,m=new E.Cartesian3,c=new y.Quaternion,h=new y.Matrix3;function v(a,e,r,t,i,n,s,o,l,C){e=a+e,E.Cartesian3.multiplyByScalar(t,Math.cos(e),u),E.Cartesian3.multiplyByScalar(r,Math.sin(e),m),E.Cartesian3.add(u,m,u),t=Math.cos(a),t*=t,r=Math.sin(a),r*=r,e=n/Math.sqrt(s*t+i*r);return y.Quaternion.fromAxisAngle(u,e/o,c),y.Matrix3.fromQuaternion(c,h),y.Matrix3.multiplyByVector(h,l,C),E.Cartesian3.normalize(C,C),E.Cartesian3.multiplyByScalar(C,o,C),C}var R=new E.Cartesian3,W=new E.Cartesian3,A=new E.Cartesian3,M=new E.Cartesian3,S=(a.raisePositionsToHeight=function(a,e,r){for(var t=e.ellipsoid,y=e.height,u=e.extrudedHeight,e=r?a.length/3*2:a.length/3,i=new Float64Array(3*e),m=a.length,n=r?m:0,s=0;s<m;s+=3){var c=s+1,h=s+2,o=E.Cartesian3.fromArray(a,s,R),l=(t.scaleToGeodeticSurface(o,o),E.Cartesian3.clone(o,W)),x=t.geodeticSurfaceNormal(o,M),C=E.Cartesian3.multiplyByScalar(x,y,A);E.Cartesian3.add(o,C,o),r&&(E.Cartesian3.multiplyByScalar(x,u,C),E.Cartesian3.add(l,C,l),i[s+n]=l.x,i[c+n]=l.y,i[h+n]=l.z),i[s]=o.x,i[c]=o.y,i[h]=o.z}return i},new E.Cartesian3),b=new E.Cartesian3,B=new E.Cartesian3;a.computeEllipsePositions=function(y,u,m){var c=y.semiMinorAxis,h=y.semiMajorAxis,x=y.rotation,M=y.center,y=8*y.granularity,f=c*c,z=h*h,_=h*c,O=E.Cartesian3.magnitude(M),d=E.Cartesian3.normalize(M,S),a=E.Cartesian3.cross(E.Cartesian3.UNIT_Z,M,b),a=E.Cartesian3.normalize(a,a),p=E.Cartesian3.cross(d,a,B),e=1+Math.ceil(V.CesiumMath.PI_OVER_TWO/y),w=V.CesiumMath.PI_OVER_TWO/(e-1),r=V.CesiumMath.PI_OVER_TWO-e*w;r<0&&(e-=Math.ceil(Math.abs(r)/w));var t,P,T,I,i=u?new Array(3*(e*(e+2)*2)):void 0,n=0,s=R,o=W,h=4*e*3,l=h-1,g=0,C=m?new Array(h):void 0,s=v(r=V.CesiumMath.PI_OVER_TWO,x,p,a,f,_,z,O,d,s);for(u&&(i[n++]=s.x,i[n++]=s.y,i[n++]=s.z),m&&(C[l--]=s.z,C[l--]=s.y,C[l--]=s.x),r=V.CesiumMath.PI_OVER_TWO-w,t=1;t<e+1;++t){if(s=v(r,x,p,a,f,_,z,O,d,s),o=v(Math.PI-r,x,p,a,f,_,z,O,d,o),u){for(i[n++]=s.x,i[n++]=s.y,i[n++]=s.z,T=2*t+2,P=1;P<T-1;++P)I=E.Cartesian3.lerp(s,o,P/(T-1),A),i[n++]=I.x,i[n++]=I.y,i[n++]=I.z;i[n++]=o.x,i[n++]=o.y,i[n++]=o.z}m&&(C[l--]=s.z,C[l--]=s.y,C[l--]=s.x,C[g++]=o.x,C[g++]=o.y,C[g++]=o.z),r=V.CesiumMath.PI_OVER_TWO-(t+1)*w}for(t=e;1<t;--t){if(s=v(-(r=V.CesiumMath.PI_OVER_TWO-(t-1)*w),x,p,a,f,_,z,O,d,s),o=v(r+Math.PI,x,p,a,f,_,z,O,d,o),u){for(i[n++]=s.x,i[n++]=s.y,i[n++]=s.z,T=2*(t-1)+2,P=1;P<T-1;++P)I=E.Cartesian3.lerp(s,o,P/(T-1),A),i[n++]=I.x,i[n++]=I.y,i[n++]=I.z;i[n++]=o.x,i[n++]=o.y,i[n++]=o.z}m&&(C[l--]=s.z,C[l--]=s.y,C[l--]=s.x,C[g++]=o.x,C[g++]=o.y,C[g++]=o.z)}s=v(-(r=V.CesiumMath.PI_OVER_TWO),x,p,a,f,_,z,O,d,s);c={};return u&&(i[n++]=s.x,i[n++]=s.y,i[n++]=s.z,c.positions=i,c.numPts=e),m&&(C[l--]=s.z,C[l--]=s.y,C[l--]=s.x,c.outerPositions=C),c},e.EllipseGeometryLibrary=a});
