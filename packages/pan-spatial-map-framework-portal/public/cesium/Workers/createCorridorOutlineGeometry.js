define(["./GeometryOffsetAttribute-b02d5bb9","./arrayRemoveDuplicates-bdf50aa0","./Transforms-07a9fab5","./Cartesian2-38b35910","./Check-f996273c","./ComponentDatatype-e44126e4","./PolylineVolumeGeometryLibrary-c00aade2","./CorridorGeometryLibrary-aa7b3a60","./when-ae2e0b60","./GeometryAttribute-586bf52c","./GeometryAttributes-5ce4955a","./IndexDatatype-516320ea","./Math-5bbcea10","./PolygonPipeline-06aa4301","./combine-276652d0","./RuntimeError-ac2797b4","./WebGLConstants-35626ea2","./EllipsoidTangentPlane-19622103","./AxisAlignedBoundingBox-d272def4","./IntersectionTests-f49c7cd3","./Plane-45ad3143","./PolylinePipeline-f47a23a0","./EllipsoidGeodesic-0207b202","./EllipsoidRhumbLine-af7b5ebe"],function(A,d,u,B,e,M,R,U,F,Y,q,W,l,v,t,i,r,o,a,n,s,p,h,c){"use strict";var J=new B.Cartesian3,j=new B.Cartesian3,z=new B.Cartesian3;function _(u,p){var h,e=[],f=u.positions,y=u.corners,u=u.endPositions,c=new q.GeometryAttributes,g=0,b=0,m=0;for(l=0;l<f.length;l+=2)g+=h=f[l].length-3,m+=h/3*4,b+=f[l+1].length-3;for(g+=3,b+=3,l=0;l<y.length;l++){var A=y[l],v=y[l].leftPositions;F.defined(v)?g+=h=v.length:b+=h=y[l].rightPositions.length,m+=h/3*2}var _,E,C,t,i,G=F.defined(u),T=(G&&(g+=_=u[0].length-3,b+=_,m+=4*(_/=3)),g+b),r=new Float64Array(T),o=0,a=T-1,P=_/2,n=W.IndexDatatype.createTypedArray(T/3,m+4),s=0;if(n[s++]=o/3,n[s++]=(a-2)/3,G){e.push(o/3);for(var w=J,L=j,D=u[0],l=0;l<P;l++)w=B.Cartesian3.fromArray(D,3*(P-1-l),w),L=B.Cartesian3.fromArray(D,3*(P+l),L),U.CorridorGeometryLibrary.addAttribute(r,L,o),U.CorridorGeometryLibrary.addAttribute(r,w,void 0,a),i=(C=o/3)+1,t=(E=(a-2)/3)-1,n[s++]=E,n[s++]=t,n[s++]=C,n[s++]=i,o+=3,a-=3}var k=0,x=f[k++],N=f[k++];for(r.set(x,o),r.set(N,a-N.length+1),h=N.length-3,e.push(o/3,(a-2)/3),l=0;l<h;l+=3)i=(C=o/3)+1,t=(E=(a-2)/3)-1,n[s++]=E,n[s++]=t,n[s++]=C,n[s++]=i,o+=3,a-=3;for(l=0;l<y.length;l++){var d,O,V=(A=y[l]).leftPositions,H=A.rightPositions,I=z;if(F.defined(V)){for(a-=3,O=t,e.push(i),d=0;d<V.length/3;d++)I=B.Cartesian3.fromArray(V,3*d,I),n[s++]=O-d-1,n[s++]=O-d,U.CorridorGeometryLibrary.addAttribute(r,I,void 0,a),a-=3;e.push(O-Math.floor(V.length/6)),p===R.CornerType.BEVELED&&e.push((a-2)/3+1),o+=3}else{for(o+=3,O=i,e.push(t),d=0;d<H.length/3;d++)I=B.Cartesian3.fromArray(H,3*d,I),n[s++]=O+d,n[s++]=O+d+1,U.CorridorGeometryLibrary.addAttribute(r,I,o),o+=3;e.push(O+Math.floor(H.length/6)),p===R.CornerType.BEVELED&&e.push(o/3-1),a-=3}for(x=f[k++],N=f[k++],x.splice(0,3),N.splice(N.length-3,3),r.set(x,o),r.set(N,a-N.length+1),h=N.length-3,d=0;d<N.length;d+=3)C=(i=o/3)-1,n[s++]=E=(t=(a-2)/3)+1,n[s++]=t,n[s++]=C,n[s++]=i,o+=3,a-=3;o-=3,a+=3,e.push(o/3,(a-2)/3)}if(G){o+=3,a-=3,w=J,L=j;var S=u[1];for(l=0;l<P;l++)w=B.Cartesian3.fromArray(S,3*(_-l-1),w),L=B.Cartesian3.fromArray(S,3*l,L),U.CorridorGeometryLibrary.addAttribute(r,w,void 0,a),U.CorridorGeometryLibrary.addAttribute(r,L,o),C=(i=o/3)-1,n[s++]=E=(t=(a-2)/3)+1,n[s++]=t,n[s++]=C,n[s++]=i,o+=3,a-=3;e.push(o/3)}else e.push(o/3,(a-2)/3);return n[s++]=o/3,n[s++]=(a-2)/3,c.position=new Y.GeometryAttribute({componentDatatype:M.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:r}),{attributes:c,indices:n,wallIndices:e}}function f(e){var t=(e=F.defaultValue(e,F.defaultValue.EMPTY_OBJECT)).positions,i=e.width,r=F.defaultValue(e.height,0),o=F.defaultValue(e.extrudedHeight,r);this._positions=t,this._ellipsoid=B.Ellipsoid.clone(F.defaultValue(e.ellipsoid,B.Ellipsoid.WGS84)),this._width=i,this._height=Math.max(r,o),this._extrudedHeight=Math.min(r,o),this._cornerType=F.defaultValue(e.cornerType,R.CornerType.ROUNDED),this._granularity=F.defaultValue(e.granularity,l.CesiumMath.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*B.Cartesian3.packedLength+B.Ellipsoid.packedLength+6}f.pack=function(e,t,i){i=F.defaultValue(i,0);var r=e._positions,o=r.length;t[i++]=o;for(var a=0;a<o;++a,i+=B.Cartesian3.packedLength)B.Cartesian3.pack(r[a],t,i);return B.Ellipsoid.pack(e._ellipsoid,t,i),i+=B.Ellipsoid.packedLength,t[i++]=e._width,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._cornerType,t[i++]=e._granularity,t[i]=F.defaultValue(e._offsetAttribute,-1),t};var g=B.Ellipsoid.clone(B.Ellipsoid.UNIT_SPHERE),y={positions:void 0,ellipsoid:g,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};return f.unpack=function(e,t,i){t=F.defaultValue(t,0);for(var r=e[t++],o=new Array(r),a=0;a<r;++a,t+=B.Cartesian3.packedLength)o[a]=B.Cartesian3.unpack(e,t);var u=B.Ellipsoid.unpack(e,t,g),n=(t+=B.Ellipsoid.packedLength,e[t++]),s=e[t++],l=e[t++],p=e[t++],h=e[t++],d=e[t];return F.defined(i)?(i._positions=o,i._ellipsoid=B.Ellipsoid.clone(u,i._ellipsoid),i._width=n,i._height=s,i._extrudedHeight=l,i._cornerType=p,i._granularity=h,i._offsetAttribute=-1===d?void 0:d,i):(y.positions=o,y.width=n,y.height=s,y.extrudedHeight=l,y.cornerType=p,y.granularity=h,y.offsetAttribute=-1===d?void 0:d,new f(y))},f.createGeometry=function(e){var t,i,r,o,a=e._positions,n=e._width,s=e._ellipsoid,a=function(e,t){for(var i=0;i<e.length;i++)e[i]=t.scaleToGeodeticSurface(e[i],e[i]);return e}(a,s),a=d.arrayRemoveDuplicates(a,B.Cartesian3.equalsEpsilon);if(!(a.length<2||n<=0))return o=e._height,i=e._extrudedHeight,t=!l.CesiumMath.equalsEpsilon(o,i,0,l.CesiumMath.EPSILON2),a={ellipsoid:s,positions:a,width:n,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1},t?(a.height=o,a.extrudedHeight=i,a.offsetAttribute=e._offsetAttribute,r=function(e){for(var u,p,h=e.ellipsoid,f=(n=_(U.CorridorGeometryLibrary.computePositions(e),e.cornerType)).wallIndices,t=e.height,y=e.extrudedHeight,i=n.attributes,r=n.indices,o=(n=i.position.values).length,a=((c=new Float64Array(o)).set(n),new Float64Array(2*o)),n=v.PolygonPipeline.scaleToGeodeticHeight(n,t,h),c=v.PolygonPipeline.scaleToGeodeticHeight(c,y,h),g=(a.set(n),a.set(c,o),i.position.values=a,o/=3,F.defined(e.offsetAttribute)&&(t=new Uint8Array(2*o),t=e.offsetAttribute===A.GeometryOffsetAttribute.TOP?A.arrayFill(t,1,0,o):(y=e.offsetAttribute===A.GeometryOffsetAttribute.NONE?0:1,A.arrayFill(t,y)),i.applyOffset=new Y.GeometryAttribute({componentDatatype:M.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:t})),r.length),s=W.IndexDatatype.createTypedArray(a.length/3,2*(g+f.length)),l=(s.set(r),g),d=0;d<g;d+=2){var b=r[d],m=r[d+1];s[l++]=b+o,s[l++]=m+o}for(d=0;d<f.length;d++)p=(u=f[d])+o,s[l++]=u,s[l++]=p;return{attributes:i,indices:s}}(a)):((r=_(U.CorridorGeometryLibrary.computePositions(a),a.cornerType)).attributes.position.values=v.PolygonPipeline.scaleToGeodeticHeight(r.attributes.position.values,o,s),F.defined(e._offsetAttribute)&&(n=r.attributes.position.values.length,t=new Uint8Array(n/3),i=e._offsetAttribute===A.GeometryOffsetAttribute.NONE?0:1,A.arrayFill(t,i),r.attributes.applyOffset=new Y.GeometryAttribute({componentDatatype:M.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:t}))),a=r.attributes,o=u.BoundingSphere.fromVertices(a.position.values,void 0,3),new Y.Geometry({attributes:a,indices:r.indices,primitiveType:Y.PrimitiveType.LINES,boundingSphere:o,offsetAttribute:e._offsetAttribute})},function(e,t){return(e=F.defined(t)?f.unpack(e,t):e)._ellipsoid=B.Ellipsoid.clone(e._ellipsoid),f.createGeometry(e)}});
