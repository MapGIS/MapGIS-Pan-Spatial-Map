define(["exports","./Cartesian2-38b35910","./Check-f996273c","./ComponentDatatype-e44126e4","./when-ae2e0b60","./EllipsoidRhumbLine-af7b5ebe","./GeometryAttribute-586bf52c","./Math-5bbcea10","./WebGLConstants-35626ea2"],function(e,L,t,W,D,P,G,I,n){"use strict";function r(e,t,n){n=n||2;var r,a,i,u,x,p=t&&t.length,h=p?t[0]*n:e.length,o=v(e,0,h,n,!0),f=[];if(!o||o.next===o.prev)return f;if(p&&(o=function(e,t,n,r){var a,i,u,x,o=[];for(a=0,i=t.length;a<i;a++)x=t[a]*r,u=a<i-1?t[a+1]*r:e.length,(x=v(e,x,u,r,!1))===x.next&&(x.steiner=!0),o.push(function(e){var t=e,n=e;for(;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next,t!==e;);return n}(x));for(o.sort(c),a=0;a<o.length;a++)!function(e,t){(t=function(e,p){var t,n=p,r=e.x,a=e.y,i=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var u=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=r&&i<u){if((i=u)===r){if(a===n.y)return n;if(a===n.next.y)return n.next}t=n.x<n.next.x?n:n.next}}}while(n=n.next,n!==p);if(!t)return null;if(r===i)return t;var x,h=t,f=t.x,o=t.y,s=1/0;n=t;for(;r>=n.x&&n.x>=f&&r!==n.x&&A(a<o?r:i,a,f,o,a<o?i:r,a,n.x,n.y)&&(x=Math.abs(a-n.y)/(r-n.x),R(n,e)&&(x<s||x===s&&(n.x>t.x||n.x===t.x&&function(e,t){return z(e.prev,e,t.prev)<0&&z(t.next,e,e.next)<0}(t,n)))&&(t=n,s=x)),n=n.next,n!==h;);return t}(e,t))&&Z(t=_(t,e),t.next)}(o[a],n),n=Z(n,n.next);return n}(e,t,o,n)),e.length>80*n){for(var s=r=e[0],l=a=e[1],y=n;y<h;y+=n)(i=e[y])<s&&(s=i),(u=e[y+1])<l&&(l=u),r<i&&(r=i),a<u&&(a=u);x=0!==(x=Math.max(r-s,a-l))?1/x:0}return S(o,f,n,s,l,x),f}function v(e,t,n,r,a){var i,u;if(a===0<d(e,t,n,r))for(i=t;i<n;i+=r)u=x(i,e[i],e[i+1],u);else for(i=n-r;t<=i;i-=r)u=x(i,e[i],e[i+1],u);return u&&N(u,u.next)&&(O(u),u=u.next),u}function Z(e,t){if(!e)return e;t=t||e;var n,r=e;do{if(n=!1,r.steiner||!N(r,r.next)&&0!==z(r.prev,r,r.next))r=r.next;else{if(O(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function S(e,t,n,r,p,a,h){if(e){if(!h&&a){for(var f=e,l=r,y=p,v=a,i=f;null===i.z&&(i.z=B(i.x,i.y,l,y,v)),i.prevZ=i.prev,i.nextZ=i.next,(i=i.next)!==f;);i.prevZ.nextZ=null,i.prevZ=null;var c,u,x,o,s,d,m,C,g=i,b=1;do{for(u=g,s=g=null,d=0;u;){for(d++,x=u,c=m=0;c<b&&(m++,x=x.nextZ);c++);for(C=b;0<m||0<C&&x;)0!==m&&(0===C||!x||u.z<=x.z)?(u=(o=u).nextZ,m--):(x=(o=x).nextZ,C--),s?s.nextZ=o:g=o,o.prevZ=s,s=o;u=x}}while(s.nextZ=null,b*=2,1<d)}for(var w,E,M=e;e.prev!==e.next;)if(w=e.prev,E=e.next,a?function(e,t,n,r){var a=e.prev,i=e,u=e.next;if(0<=z(a,i,u))return!1;var p=(a.x<i.x?a.x<u.x?a:u:i.x<u.x?i:u).x,h=(a.y<i.y?a.y<u.y?a:u:i.y<u.y?i:u).y,f=(a.x>i.x?a.x>u.x?a:u:i.x>u.x?i:u).x,l=(a.y>i.y?a.y>u.y?a:u:i.y>u.y?i:u).y,x=B(p,h,t,n,r),y=B(f,l,t,n,r),o=e.prevZ,s=e.nextZ;for(;o&&o.z>=x&&s&&s.z<=y;){if(o!==e.prev&&o!==e.next&&A(a.x,a.y,i.x,i.y,u.x,u.y,o.x,o.y)&&0<=z(o.prev,o,o.next))return!1;if(o=o.prevZ,s!==e.prev&&s!==e.next&&A(a.x,a.y,i.x,i.y,u.x,u.y,s.x,s.y)&&0<=z(s.prev,s,s.next))return!1;s=s.nextZ}for(;o&&o.z>=x;){if(o!==e.prev&&o!==e.next&&A(a.x,a.y,i.x,i.y,u.x,u.y,o.x,o.y)&&0<=z(o.prev,o,o.next))return!1;o=o.prevZ}for(;s&&s.z<=y;){if(s!==e.prev&&s!==e.next&&A(a.x,a.y,i.x,i.y,u.x,u.y,s.x,s.y)&&0<=z(s.prev,s,s.next))return!1;s=s.nextZ}return!0}(e,r,p,a):function(e){var t=e.prev,n=e,r=e.next;if(0<=z(t,n,r))return!1;var a=e.next.next;for(;a!==e.prev;){if(A(t.x,t.y,n.x,n.y,r.x,r.y,a.x,a.y)&&0<=z(a.prev,a,a.next))return!1;a=a.next}return!0}(e))t.push(w.i/n),t.push(e.i/n),t.push(E.i/n),O(e),e=E.next,M=E.next;else if((e=E)===M){h?1===h?S(e=function(e,t,n){var r=e;do{var a=r.prev,i=r.next.next}while(!N(a,i)&&U(a,r,r.next,i)&&R(a,i)&&R(i,a)&&(t.push(a.i/n),t.push(r.i/n),t.push(i.i/n),O(r),O(r.next),r=e=i),r=r.next,r!==e);return Z(r)}(Z(e),t,n),t,n,r,p,a,2):2===h&&function(e,t,n,r,a,i){var u=e;do{for(var x,o=u.next.next;o!==u.prev;){if(u.i!==o.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&U(n,n.next,e,t))return!0}while(n=n.next,n!==e);return!1}(e,t)&&(R(e,t)&&R(t,e)&&function(e,t){var n=e,r=!1,a=(e.x+t.x)/2,i=(e.y+t.y)/2;for(;n.y>i!=n.next.y>i&&n.next.y!==n.y&&a<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==e;);return r}(e,t)&&(z(e.prev,e,t.prev)||z(e,t.prev,t))||N(e,t)&&0<z(e.prev,e,e.next)&&0<z(t.prev,t,t.next))}(u,o))return x=_(u,o),u=Z(u,u.next),x=Z(x,x.next),S(u,t,n,r,a,i),S(x,t,n,r,a,i);o=o.next}}while(u=u.next,u!==e)}(e,t,n,r,p,a):S(Z(e),t,n,r,p,a,1);break}}}function c(e,t){return e.x-t.x}function B(e,t,n,r,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function A(e,t,n,r,a,i,u,x){return 0<=(a-u)*(t-x)-(e-u)*(i-x)&&0<=(e-u)*(r-x)-(n-u)*(t-x)&&0<=(n-u)*(i-x)-(a-u)*(r-x)}function z(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function N(e,t){return e.x===t.x&&e.y===t.y}function U(e,t,n,r){var a=s(z(e,t,n)),i=s(z(e,t,r)),u=s(z(n,r,e)),x=s(z(n,r,t));return a!==i&&u!==x||(0===a&&o(e,n,t)||(0===i&&o(e,r,t)||(0===u&&o(n,e,r)||!(0!==x||!o(n,t,r)))))}function o(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function s(e){return 0<e?1:e<0?-1:0}function R(e,t){return z(e.prev,e,e.next)<0?0<=z(e,t,e.next)&&0<=z(e,e.prev,t):z(e,t,e.prev)<0||z(e,e.next,t)<0}function _(e,t){var n=new u(e.i,e.x,e.y),r=new u(t.i,t.x,t.y),a=e.next,i=t.prev;return(e.next=t).prev=e,(n.next=a).prev=n,(r.next=n).prev=r,(i.next=r).prev=i,r}function x(e,t,n,r){e=new u(e,t,n);return r?(e.next=r.next,(e.prev=r).next.prev=e,r.next=e):(e.prev=e).next=e,e}function O(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function u(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function d(e,t,n,r){for(var a=0,i=t,u=n-r;i<n;i+=r)a+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return a}r.deviation=function(e,t,n,r){var a=t&&t.length,p=a?t[0]*n:e.length,i=Math.abs(d(e,0,p,n));if(a)for(var u=0,x=t.length;u<x;u++){var h=t[u]*n,f=u<x-1?t[u+1]*n:e.length;i-=Math.abs(d(e,h,f,n))}for(var o=0,u=0;u<r.length;u+=3){var s=r[u]*n,l=r[u+1]*n,y=r[u+2]*n;o+=Math.abs((e[s]-e[y])*(e[1+l]-e[1+s])-(e[s]-e[l])*(e[1+y]-e[1+s]))}return 0===i&&0===o?0:Math.abs((o-i)/i)},r.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,a=0;a<e.length;a++){for(var i=0;i<e[a].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[a][i][u]);0<a&&(r+=e[a-1].length,n.holes.push(r))}return n};var a={CLOCKWISE:n.WebGLConstants.CW,COUNTER_CLOCKWISE:n.WebGLConstants.CCW,validate:function(e){return e===a.CLOCKWISE||e===a.COUNTER_CLOCKWISE}},i=Object.freeze(a),p=new L.Cartesian3,h=new L.Cartesian3,f={computeArea2D:function(e){for(var t=e.length,n=0,r=t-1,a=0;a<t;r=a++){var i=e[r],u=e[a];n+=i.x*u.y-u.x*i.y}return.5*n},computeWindingOrder2D:function(e){return 0<f.computeArea2D(e)?i.COUNTER_CLOCKWISE:i.CLOCKWISE},triangulate:function(e,t){return r(L.Cartesian2.packArray(e),t,2)}},K=new L.Cartesian3,V=new L.Cartesian3,k=new L.Cartesian3,q=new L.Cartesian3,F=new L.Cartesian3,j=new L.Cartesian3,T=new L.Cartesian3,H=(f.computeSubdivision=function(p,h,f,l){l=D.defaultValue(l,I.CesiumMath.RADIANS_PER_DEGREE);for(var e=f.slice(0),y=h.length,t=new Array(3*y),v=0,n=0;n<y;n++){var c=h[n];t[v++]=c.x,t[v++]=c.y,t[v++]=c.z}for(var d=[],r={},m=p.maximumRadius,f=I.CesiumMath.chordLength(l,m),C=f*f;0<e.length;){var a,i,u=e.pop(),x=e.pop(),o=e.pop(),g=L.Cartesian3.fromArray(t,3*o,K),b=L.Cartesian3.fromArray(t,3*x,V),w=L.Cartesian3.fromArray(t,3*u,k),s=L.Cartesian3.multiplyByScalar(L.Cartesian3.normalize(g,q),m,q),E=L.Cartesian3.multiplyByScalar(L.Cartesian3.normalize(b,F),m,F),M=L.Cartesian3.multiplyByScalar(L.Cartesian3.normalize(w,j),m,j),Z=L.Cartesian3.magnitudeSquared(L.Cartesian3.subtract(s,E,T)),E=L.Cartesian3.magnitudeSquared(L.Cartesian3.subtract(E,M,T)),M=L.Cartesian3.magnitudeSquared(L.Cartesian3.subtract(M,s,T)),s=Math.max(Z,E,M);C<s?Z===s?(n=r[a=Math.min(o,x)+" "+Math.max(o,x)],D.defined(n)||(i=L.Cartesian3.add(g,b,T),L.Cartesian3.multiplyByScalar(i,.5,i),t.push(i.x,i.y,i.z),n=t.length/3-1,r[a]=n),e.push(o,n,u),e.push(n,x,u)):E===s?(n=r[a=Math.min(x,u)+" "+Math.max(x,u)],D.defined(n)||(i=L.Cartesian3.add(b,w,T),L.Cartesian3.multiplyByScalar(i,.5,i),t.push(i.x,i.y,i.z),n=t.length/3-1,r[a]=n),e.push(x,n,o),e.push(n,u,o)):M===s&&(n=r[a=Math.min(u,o)+" "+Math.max(u,o)],D.defined(n)||(i=L.Cartesian3.add(w,g,T),L.Cartesian3.multiplyByScalar(i,.5,i),t.push(i.x,i.y,i.z),n=t.length/3-1,r[a]=n),e.push(u,n,x),e.push(n,o,x)):(d.push(o),d.push(x),d.push(u))}return new G.Geometry({attributes:{position:new G.GeometryAttribute({componentDatatype:W.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:t})},indices:d,primitiveType:G.PrimitiveType.TRIANGLES})},new L.Cartographic),J=new L.Cartographic,Q=new L.Cartographic,X=new L.Cartographic;f.computeRhumbLineSubdivision=function(e,p,h,f){f=D.defaultValue(f,I.CesiumMath.RADIANS_PER_DEGREE);for(var t=h.slice(0),l=p.length,n=new Array(3*l),y=0,r=0;r<l;r++){var v=p[r];n[y++]=v.x,n[y++]=v.y,n[y++]=v.z}for(var c=[],a={},h=e.maximumRadius,d=I.CesiumMath.chordLength(f,h),m=new P.EllipsoidRhumbLine(void 0,void 0,e),C=new P.EllipsoidRhumbLine(void 0,void 0,e),g=new P.EllipsoidRhumbLine(void 0,void 0,e);0<t.length;){var b,i,w,u,x=t.pop(),o=t.pop(),s=t.pop(),E=L.Cartesian3.fromArray(n,3*s,K),M=L.Cartesian3.fromArray(n,3*o,V),Z=L.Cartesian3.fromArray(n,3*x,k),E=e.cartesianToCartographic(E,H),M=e.cartesianToCartographic(M,J),Z=e.cartesianToCartographic(Z,Q),S=(m.setEndPoints(E,M),m.surfaceDistance),A=(C.setEndPoints(M,Z),C.surfaceDistance),z=(g.setEndPoints(Z,E),g.surfaceDistance),R=Math.max(S,A,z);d<R?S===R?(r=a[b=Math.min(s,o)+" "+Math.max(s,o)],D.defined(r)||(i=m.interpolateUsingFraction(.5,X),w=.5*(E.height+M.height),u=L.Cartesian3.fromRadians(i.longitude,i.latitude,w,e,T),n.push(u.x,u.y,u.z),r=n.length/3-1,a[b]=r),t.push(s,r,x),t.push(r,o,x)):A===R?(r=a[b=Math.min(o,x)+" "+Math.max(o,x)],D.defined(r)||(i=C.interpolateUsingFraction(.5,X),w=.5*(M.height+Z.height),u=L.Cartesian3.fromRadians(i.longitude,i.latitude,w,e,T),n.push(u.x,u.y,u.z),r=n.length/3-1,a[b]=r),t.push(o,r,s),t.push(r,x,s)):z===R&&(r=a[b=Math.min(x,s)+" "+Math.max(x,s)],D.defined(r)||(i=g.interpolateUsingFraction(.5,X),w=.5*(Z.height+E.height),u=L.Cartesian3.fromRadians(i.longitude,i.latitude,w,e,T),n.push(u.x,u.y,u.z),r=n.length/3-1,a[b]=r),t.push(x,r,o),t.push(r,s,o)):(c.push(s),c.push(o),c.push(x))}return new G.Geometry({attributes:{position:new G.GeometryAttribute({componentDatatype:W.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:n})},indices:c,primitiveType:G.PrimitiveType.TRIANGLES})},f.scaleToGeodeticHeight=function(e,t,n,r){n=D.defaultValue(n,L.Ellipsoid.WGS84);var a=p,i=h;if(t=D.defaultValue(t,0),r=D.defaultValue(r,!0),D.defined(e))for(var u=e.length,x=0;x<u;x+=3)L.Cartesian3.fromArray(e,x,i),r&&(i=n.scaleToGeodeticSurface(i,i)),0!==t&&(a=n.geodeticSurfaceNormal(i,a),L.Cartesian3.multiplyByScalar(a,t,a),L.Cartesian3.add(i,a,i)),e[x]=i.x,e[x+1]=i.y,e[x+2]=i.z;return e},e.PolygonPipeline=f,e.WindingOrder=i});
