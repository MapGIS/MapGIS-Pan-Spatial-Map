define(["exports","./GeometryOffsetAttribute-b02d5bb9","./Transforms-07a9fab5","./Cartesian2-38b35910","./ComponentDatatype-e44126e4","./when-ae2e0b60","./Check-f996273c","./GeometryAttribute-586bf52c","./GeometryAttributes-5ce4955a","./IndexDatatype-516320ea","./Math-5bbcea10","./VertexFormat-90d15264"],function(e,Q,rt,$,tt,et,a,at,nt,ot,it,f){"use strict";var mt=new $.Cartesian3,st=new $.Cartesian3,ut=new $.Cartesian3,lt=new $.Cartesian3,ct=new $.Cartesian3,l=new $.Cartesian3(1,1,1),ft=Math.cos,dt=Math.sin;function d(t){t=et.defaultValue(t,et.defaultValue.EMPTY_OBJECT);var e=et.defaultValue(t.radii,l),a=et.defaultValue(t.innerRadii,e),i=et.defaultValue(t.minimumClock,0),r=et.defaultValue(t.maximumClock,it.CesiumMath.TWO_PI),n=et.defaultValue(t.minimumCone,0),o=et.defaultValue(t.maximumCone,it.CesiumMath.PI),m=Math.round(et.defaultValue(t.stackPartitions,64)),s=Math.round(et.defaultValue(t.slicePartitions,64)),u=et.defaultValue(t.vertexFormat,f.VertexFormat.DEFAULT);this._radii=$.Cartesian3.clone(e),this._innerRadii=$.Cartesian3.clone(a),this._minimumClock=i,this._maximumClock=r,this._minimumCone=n,this._maximumCone=o,this._stackPartitions=m,this._slicePartitions=s,this._vertexFormat=f.VertexFormat.clone(u),this._offsetAttribute=t.offsetAttribute,this._workerName="createEllipsoidGeometry"}d.packedLength=2*$.Cartesian3.packedLength+f.VertexFormat.packedLength+7,d.pack=function(t,e,a){return a=et.defaultValue(a,0),$.Cartesian3.pack(t._radii,e,a),a+=$.Cartesian3.packedLength,$.Cartesian3.pack(t._innerRadii,e,a),a+=$.Cartesian3.packedLength,f.VertexFormat.pack(t._vertexFormat,e,a),a+=f.VertexFormat.packedLength,e[a++]=t._minimumClock,e[a++]=t._maximumClock,e[a++]=t._minimumCone,e[a++]=t._maximumCone,e[a++]=t._stackPartitions,e[a++]=t._slicePartitions,e[a]=et.defaultValue(t._offsetAttribute,-1),e};var t,p=new $.Cartesian3,y=new $.Cartesian3,_=new f.VertexFormat,C={radii:p,innerRadii:y,vertexFormat:_,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};d.unpack=function(t,e,a){e=et.defaultValue(e,0);var i=$.Cartesian3.unpack(t,e,p),l=(e+=$.Cartesian3.packedLength,$.Cartesian3.unpack(t,e,y)),c=(e+=$.Cartesian3.packedLength,f.VertexFormat.unpack(t,e,_)),r=(e+=f.VertexFormat.packedLength,t[e++]),n=t[e++],o=t[e++],m=t[e++],s=t[e++],u=t[e++],t=t[e];return et.defined(a)?(a._radii=$.Cartesian3.clone(i,a._radii),a._innerRadii=$.Cartesian3.clone(l,a._innerRadii),a._vertexFormat=f.VertexFormat.clone(c,a._vertexFormat),a._minimumClock=r,a._maximumClock=n,a._minimumCone=o,a._maximumCone=m,a._stackPartitions=s,a._slicePartitions=u,a._offsetAttribute=-1===t?void 0:t,a):(C.minimumClock=r,C.maximumClock=n,C.minimumCone=o,C.maximumCone=m,C.stackPartitions=s,C.slicePartitions=u,C.offsetAttribute=-1===t?void 0:t,new d(C))},d.createGeometry=function(l){var c=l._radii;if(!(c.x<=0||c.y<=0||c.z<=0)){var f=l._innerRadii;if(!(f.x<=0||f.y<=0||f.z<=0)){var d=l._minimumClock,C=l._maximumClock,p=l._minimumCone,y=l._maximumCone,t=l._vertexFormat,_=l._slicePartitions+1,h=l._stackPartitions+1,e=((_=Math.round(_*Math.abs(C-d)/it.CesiumMath.TWO_PI))<2&&(_=2),(h=Math.round(h*Math.abs(y-p)/it.CesiumMath.PI))<2&&(h=2),0),A=[p],b=[d];for(m=0;m<h;m++)A.push(p+m*(y-p)/(h-1));for(A.push(y),n=0;n<_;n++)b.push(d+n*(C-d)/(_-1));b.push(C);var a=A.length,i=b.length,x=0,v=1,k=f.x!==c.x||f.y!==c.y||f.z!==c.z,w=!1,F=!1,P=!1,g=(k&&(v=2,0<p&&(w=!0,x+=_-1),y<Math.PI&&(F=!0,x+=_-1),(C-d)%it.CesiumMath.TWO_PI?(P=!0,x+=2*(h-1)+1):x+=1),i*a*v),V=new Float64Array(3*g),M=Q.arrayFill(new Array(g),!1),T=Q.arrayFill(new Array(g),!1),D=_*h*v,r=ot.IndexDatatype.createTypedArray(D,6*(D+x+1-(_+h)*v)),G=t.normal?new Float32Array(3*g):void 0,L=t.tangent?new Float32Array(3*g):void 0,O=t.bitangent?new Float32Array(3*g):void 0,I=t.st?new Float32Array(2*g):void 0,E=new Array(a),z=new Array(a);for(m=0;m<a;m++)E[m]=dt(A[m]),z[m]=ft(A[m]);for(var N=new Array(i),R=new Array(i),n=0;n<i;n++)R[n]=ft(b[n]),N[n]=dt(b[n]);for(m=0;m<a;m++)for(n=0;n<i;n++)V[e++]=c.x*E[m]*R[n],V[e++]=c.y*E[m]*N[n],V[e++]=c.z*z[m];var U,S,B,o,W=g/2;if(k)for(m=0;m<a;m++)for(n=0;n<i;n++)V[e++]=f.x*E[m]*R[n],V[e++]=f.y*E[m]*N[n],V[e++]=f.z*z[m],M[W]=!0,0<m&&m!==a-1&&0!==n&&n!==i-1&&(T[W]=!0),W++;for(e=0,m=1;m<a-2;m++)for(U=m*i,S=(m+1)*i,n=1;n<i-2;n++)r[e++]=S+n,r[e++]=S+n+1,r[e++]=U+n+1,r[e++]=S+n,r[e++]=U+n+1,r[e++]=U+n;if(k)for(var Y=a*i,m=1;m<a-2;m++)for(U=Y+m*i,S=Y+(m+1)*i,n=1;n<i-2;n++)r[e++]=S+n,r[e++]=U+n,r[e++]=U+n+1,r[e++]=S+n,r[e++]=U+n+1,r[e++]=S+n+1;if(k){if(w)for(o=a*i,m=1;m<i-2;m++)r[e++]=m,r[e++]=m+1,r[e++]=o+m+1,r[e++]=m,r[e++]=o+m+1,r[e++]=o+m;if(F)for(B=a*i-i,o=a*i*v-i,m=1;m<i-2;m++)r[e++]=B+m+1,r[e++]=B+m,r[e++]=o+m,r[e++]=B+m+1,r[e++]=o+m,r[e++]=o+m+1}if(P){for(m=1;m<a-2;m++)r[e++]=o=i*a+(B=i*m),r[e++]=B+i,r[e++]=B,r[e++]=o,r[e++]=o+i,r[e++]=B+i;for(m=1;m<a-2;m++)o=i*a+i*(m+1)-1,r[e++]=(B=i*(m+1)-1)+i,r[e++]=o,r[e++]=B,r[e++]=B+i,r[e++]=o+i,r[e++]=o}var D=new nt.GeometryAttributes,J=(t.position&&(D.position=new at.GeometryAttribute({componentDatatype:tt.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:V})),0),X=0,Z=0,j=0,q=g/2,H=$.Ellipsoid.fromCartesian3(c),K=$.Ellipsoid.fromCartesian3(f);if(t.st||t.normal||t.tangent||t.bitangent){for(m=0;m<g;m++){var s=M[m]?K:H,u=$.Cartesian3.fromArray(V,3*m,mt),s=s.geodeticSurfaceNormal(u,st);T[m]&&$.Cartesian3.negate(s,s),t.st&&(u=$.Cartesian2.negate(s,ct),I[J++]=Math.atan2(u.y,u.x)/it.CesiumMath.TWO_PI+.5,I[J++]=Math.asin(s.z)/Math.PI+.5),t.normal&&(G[X++]=s.x,G[X++]=s.y,G[X++]=s.z),(t.tangent||t.bitangent)&&(u=0,M[m]&&(u=q),u=!w&&u<=m&&m<u+2*i?$.Cartesian3.UNIT_X:$.Cartesian3.UNIT_Z,$.Cartesian3.cross(u,s,u=ut),$.Cartesian3.normalize(u,u),t.tangent&&(L[Z++]=u.x,L[Z++]=u.y,L[Z++]=u.z),t.bitangent&&(s=$.Cartesian3.cross(s,u,lt),$.Cartesian3.normalize(s,s),O[j++]=s.x,O[j++]=s.y,O[j++]=s.z))}t.st&&(D.st=new at.GeometryAttribute({componentDatatype:tt.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:I})),t.normal&&(D.normal=new at.GeometryAttribute({componentDatatype:tt.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),t.tangent&&(D.tangent=new at.GeometryAttribute({componentDatatype:tt.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),t.bitangent&&(D.bitangent=new at.GeometryAttribute({componentDatatype:tt.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:O}))}return et.defined(l._offsetAttribute)&&(x=V.length,k=new Uint8Array(x/3),F=l._offsetAttribute===Q.GeometryOffsetAttribute.NONE?0:1,Q.arrayFill(k,F),D.applyOffset=new at.GeometryAttribute({componentDatatype:tt.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:k})),new at.Geometry({attributes:D,indices:r,primitiveType:at.PrimitiveType.TRIANGLES,boundingSphere:rt.BoundingSphere.fromEllipsoid(H),offsetAttribute:l._offsetAttribute})}}},d.getUnitEllipsoid=function(){return t=et.defined(t)?t:d.createGeometry(new d({radii:new $.Cartesian3(1,1,1),vertexFormat:f.VertexFormat.POSITION_ONLY}))},e.EllipsoidGeometry=d});
