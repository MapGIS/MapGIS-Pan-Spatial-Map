define(["exports","./GeometryOffsetAttribute-70462dd7","./Transforms-afef28e3","./Cartesian2-8dbd81c1","./Check-c47ad5ed","./ComponentDatatype-2104c626","./when-695b7bde","./EllipseGeometryLibrary-1ca016d4","./GeometryAttribute-8921fd23","./GeometryAttributes-5198def4","./GeometryInstance-bb899a5c","./GeometryPipeline-401060df","./IndexDatatype-a458492e","./Math-09ca1a10","./VertexFormat-327b5e55"],function(t,S,L,R,e,j,k,Y,z,H,m,y,c,p,d){"use strict";var U=new R.Cartesian3,Q=new R.Cartesian3,W=new R.Cartesian3,J=new R.Cartesian3,B=new R.Cartesian2,q=new L.Matrix3,Z=new L.Matrix3,K=new L.Quaternion,X=new R.Cartesian3,$=new R.Cartesian3,tt=new R.Cartesian3,et=new R.Cartographic,rt=new R.Cartesian3,at=new R.Cartesian2,it=new R.Cartesian2;function f(m,t,p){for(var e=t.vertexFormat,r=t.center,y=t.semiMajorAxis,c=t.semiMinorAxis,d=t.ellipsoid,A=t.stRotation,f=p?m.length/3*2:m.length/3,h=t.shadowVolume,a=e.st?new Float32Array(2*f):void 0,x=e.normal?new Float32Array(3*f):void 0,g=e.tangent?new Float32Array(3*f):void 0,_=e.bitangent?new Float32Array(3*f):void 0,b=h?new Float32Array(3*f):void 0,C=0,i=X,n=$,o=tt,v=new L.GeographicProjection(d),w=v.project(d.cartesianToCartographic(r,et),rt),r=d.scaleToGeodeticSurface(r,U),M=(d.geodeticSurfaceNormal(r,r),q),E=Z,I=(E=0!==A?(u=L.Quaternion.fromAxisAngle(r,A,K),M=L.Matrix3.fromQuaternion(u,M),u=L.Quaternion.fromAxisAngle(r,-A,K),L.Matrix3.fromQuaternion(u,E)):(M=L.Matrix3.clone(L.Matrix3.IDENTITY,M),L.Matrix3.clone(L.Matrix3.IDENTITY,E)),R.Cartesian2.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,at)),T=R.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,it),G=m.length,s=p?G:0,N=s/3*2,l=0;l<G;l+=3){var P,F=l+1,V=l+2,D=R.Cartesian3.fromArray(m,l,U);e.st&&(P=L.Matrix3.multiplyByVector(M,D,Q),P=v.project(d.cartesianToCartographic(P,et),W),R.Cartesian3.subtract(P,w,P),B.x=(P.x+y)/(2*y),B.y=(P.y+c)/(2*c),I.x=Math.min(B.x,I.x),I.y=Math.min(B.y,I.y),T.x=Math.max(B.x,T.x),T.y=Math.max(B.y,T.y),p&&(a[C+N]=B.x,a[C+1+N]=B.y),a[C++]=B.x,a[C++]=B.y),(e.normal||e.tangent||e.bitangent||h)&&(i=d.geodeticSurfaceNormal(D,i),h&&(b[l+s]=-i.x,b[F+s]=-i.y,b[V+s]=-i.z),(e.normal||e.tangent||e.bitangent)&&((e.tangent||e.bitangent)&&(n=R.Cartesian3.normalize(R.Cartesian3.cross(R.Cartesian3.UNIT_Z,i,n),n),L.Matrix3.multiplyByVector(E,n,n)),e.normal&&(x[l]=i.x,x[F]=i.y,x[V]=i.z,p&&(x[l+s]=-i.x,x[F+s]=-i.y,x[V+s]=-i.z)),e.tangent&&(g[l]=n.x,g[F]=n.y,g[V]=n.z,p&&(g[l+s]=-n.x,g[F+s]=-n.y,g[V+s]=-n.z)),e.bitangent&&(o=R.Cartesian3.normalize(R.Cartesian3.cross(i,n,o),o),_[l]=o.x,_[F]=o.y,_[V]=o.z,p&&(_[l+s]=o.x,_[F+s]=o.y,_[V+s]=o.z))))}if(e.st)for(var G=a.length,O=0;O<G;O+=2)a[O]=(a[O]-I.x)/(T.x-I.x),a[O+1]=(a[O+1]-I.y)/(T.y-I.y);var u,r=new H.GeometryAttributes;return e.position&&(A=Y.EllipseGeometryLibrary.raisePositionsToHeight(m,t,p),r.position=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:A})),e.st&&(r.st=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:a})),e.normal&&(r.normal=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x})),e.tangent&&(r.tangent=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:g})),e.bitangent&&(r.bitangent=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_})),h&&(r.extrudeDirection=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:b})),p&&k.defined(t.offsetAttribute)&&(u=new Uint8Array(f),u=t.offsetAttribute===S.GeometryOffsetAttribute.TOP?S.arrayFill(u,1,0,f/2):(A=t.offsetAttribute===S.GeometryOffsetAttribute.NONE?0:1,S.arrayFill(u,A)),r.applyOffset=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:u})),r}function h(t){for(var e,r,a=new Array(t*(t+1)*12-6),i=0,n=0,o=1,s=0;s<3;s++)a[i++]=o++,a[i++]=n,a[i++]=o;for(s=2;s<t+1;++s){for(o=s*(s+1)-1,n=(s-1)*s-1,a[i++]=o++,a[i++]=n,a[i++]=o,e=2*s,r=0;r<e-1;++r)a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n,a[i++]=o;a[i++]=o++,a[i++]=n,a[i++]=o}for(e=2*t,++o,++n,s=0;s<e-1;++s)a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n,a[i++]=o;for(a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n++,a[i++]=n,++n,s=t-1;1<s;--s){for(a[i++]=n++,a[i++]=n,a[i++]=o,e=2*s,r=0;r<e-1;++r)a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n,a[i++]=o;a[i++]=n++,a[i++]=n++,a[i++]=o++}for(s=0;s<3;s++)a[i++]=n++,a[i++]=n,a[i++]=o;return a}var o=new R.Cartesian3;var x=new L.BoundingSphere,g=new L.BoundingSphere;function s(t){for(var e=t.center,r=t.ellipsoid,a=t.semiMajorAxis,i=R.Cartesian3.multiplyByScalar(r.geodeticSurfaceNormal(e,U),t.height,U),r=(x.center=R.Cartesian3.add(e,i,x.center),x.radius=a,i=R.Cartesian3.multiplyByScalar(r.geodeticSurfaceNormal(e,i),t.extrudedHeight,i),g.center=R.Cartesian3.add(e,i,g.center),g.radius=a,Y.EllipseGeometryLibrary.computeEllipsePositions(t,!0,!0)),e=r.positions,i=r.numPts,a=r.outerPositions,r=L.BoundingSphere.union(x,g),n=f(e,t,!0),o=(u=h(i)).length,s=(u.length=2*o,e.length/3),l=0;l<o;l+=3)u[l+o]=u[l+2]+s,u[l+1+o]=u[l+1]+s,u[l+2+o]=u[l]+s;var i=c.IndexDatatype.createTypedArray(2*s/3,u),e=new z.Geometry({attributes:n,indices:i,primitiveType:z.PrimitiveType.TRIANGLES}),n=function(m,t){for(var e=t.vertexFormat,r=t.center,p=t.semiMajorAxis,y=t.semiMinorAxis,c=t.ellipsoid,d=t.height,A=t.extrudedHeight,a=t.stRotation,i=m.length/3*2,f=new Float64Array(3*i),h=e.st?new Float32Array(2*i):void 0,x=e.normal?new Float32Array(3*i):void 0,g=e.tangent?new Float32Array(3*i):void 0,_=e.bitangent?new Float32Array(3*i):void 0,b=t.shadowVolume,C=b?new Float32Array(3*i):void 0,v=0,n=X,w=$,M=tt,E=new L.GeographicProjection(c),I=E.project(c.cartesianToCartographic(r,et),rt),r=c.scaleToGeodeticSurface(r,U),r=(c.geodeticSurfaceNormal(r,r),L.Quaternion.fromAxisAngle(r,a,K)),T=L.Matrix3.fromQuaternion(r,q),G=R.Cartesian2.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,at),N=R.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,it),P=(u=m.length)/3*2,o=0;o<u;o+=3){var F=o+1,V=o+2,s=R.Cartesian3.fromArray(m,o,U),D=(e.st&&(l=L.Matrix3.multiplyByVector(T,s,Q),l=E.project(c.cartesianToCartographic(l,et),W),R.Cartesian3.subtract(l,I,l),B.x=(l.x+p)/(2*p),B.y=(l.y+y)/(2*y),G.x=Math.min(B.x,G.x),G.y=Math.min(B.y,G.y),N.x=Math.max(B.x,N.x),N.y=Math.max(B.y,N.y),h[v+P]=B.x,h[v+1+P]=B.y,h[v++]=B.x,h[v++]=B.y),s=c.scaleToGeodeticSurface(s,s),l=R.Cartesian3.clone(s,Q),n=c.geodeticSurfaceNormal(s,n),b&&(C[o+u]=-n.x,C[F+u]=-n.y,C[V+u]=-n.z),R.Cartesian3.multiplyByScalar(n,d,J)),s=R.Cartesian3.add(s,D,s),D=R.Cartesian3.multiplyByScalar(n,A,D),l=R.Cartesian3.add(l,D,l);e.position&&(f[o+u]=l.x,f[F+u]=l.y,f[V+u]=l.z,f[o]=s.x,f[F]=s.y,f[V]=s.z),(e.normal||e.tangent||e.bitangent)&&(M=R.Cartesian3.clone(n,M),D=R.Cartesian3.fromArray(m,(o+3)%u,J),R.Cartesian3.subtract(D,s,D),s=R.Cartesian3.subtract(l,s,W),n=R.Cartesian3.normalize(R.Cartesian3.cross(s,D,n),n),e.normal&&(x[o]=n.x,x[F]=n.y,x[V]=n.z,x[o+u]=n.x,x[F+u]=n.y,x[V+u]=n.z),e.tangent&&(w=R.Cartesian3.normalize(R.Cartesian3.cross(M,n,w),w),g[o]=w.x,g[F]=w.y,g[V]=w.z,g[o+u]=w.x,g[o+1+u]=w.y,g[o+2+u]=w.z),e.bitangent&&(_[o]=M.x,_[F]=M.y,_[V]=M.z,_[o+u]=M.x,_[F+u]=M.y,_[V+u]=M.z))}if(e.st)for(var u=h.length,O=0;O<u;O+=2)h[O]=(h[O]-G.x)/(N.x-G.x),h[O+1]=(h[O+1]-G.y)/(N.y-G.y);return a=new H.GeometryAttributes,e.position&&(a.position=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f})),e.st&&(a.st=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:h})),e.normal&&(a.normal=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x})),e.tangent&&(a.tangent=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:g})),e.bitangent&&(a.bitangent=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_})),b&&(a.extrudeDirection=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:C})),k.defined(t.offsetAttribute)&&(r=new Uint8Array(i),r=t.offsetAttribute===S.GeometryOffsetAttribute.TOP?S.arrayFill(r,1,0,i/2):(i=t.offsetAttribute===S.GeometryOffsetAttribute.NONE?0:1,S.arrayFill(r,i)),a.applyOffset=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:r})),a}(a,t),u=function(t){for(var e=t.length/3,r=c.IndexDatatype.createTypedArray(e,6*e),a=0,i=0;i<e;i++){var n=i,o=i+e,s=(n+1)%e,l=s+e;r[a++]=n,r[a++]=o,r[a++]=s,r[a++]=s,r[a++]=o,r[a++]=l}return r}(a),i=c.IndexDatatype.createTypedArray(2*a.length/3,u),t=new z.Geometry({attributes:n,indices:i,primitiveType:z.PrimitiveType.TRIANGLES}),a=y.GeometryPipeline.combineInstances([new m.GeometryInstance({geometry:e}),new m.GeometryInstance({geometry:t})]);return{boundingSphere:r,attributes:a[0].attributes,indices:a[0].indices}}function l(t,e,r,a,i,n,m){for(var o=Y.EllipseGeometryLibrary.computeEllipsePositions({center:t,semiMajorAxis:e,semiMinorAxis:r,rotation:a,granularity:i},!1,!0).outerPositions,s=o.length/3,l=new Array(s),u=0;u<s;++u)l[u]=R.Cartesian3.fromArray(o,3*u);t=R.Rectangle.fromCartesianArray(l,n,m);return t.width>p.CesiumMath.PI&&(t.north=0<t.north?p.CesiumMath.PI_OVER_TWO-p.CesiumMath.EPSILON7:t.north,t.south=t.south<0?p.CesiumMath.EPSILON7-p.CesiumMath.PI_OVER_TWO:t.south,t.east=p.CesiumMath.PI,t.west=-p.CesiumMath.PI),t}function A(t){var e=(t=k.defaultValue(t,k.defaultValue.EMPTY_OBJECT)).center,r=k.defaultValue(t.ellipsoid,R.Ellipsoid.WGS84),a=t.semiMajorAxis,i=t.semiMinorAxis,n=k.defaultValue(t.granularity,p.CesiumMath.RADIANS_PER_DEGREE),o=k.defaultValue(t.vertexFormat,d.VertexFormat.DEFAULT),s=k.defaultValue(t.height,0),l=k.defaultValue(t.extrudedHeight,s);this._center=R.Cartesian3.clone(e),this._semiMajorAxis=a,this._semiMinorAxis=i,this._ellipsoid=R.Ellipsoid.clone(r),this._rotation=k.defaultValue(t.rotation,0),this._stRotation=k.defaultValue(t.stRotation,0),this._height=Math.max(l,s),this._granularity=n,this._vertexFormat=d.VertexFormat.clone(o),this._extrudedHeight=Math.min(l,s),this._shadowVolume=k.defaultValue(t.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}A.packedLength=R.Cartesian3.packedLength+R.Ellipsoid.packedLength+d.VertexFormat.packedLength+9,A.pack=function(t,e,r){return r=k.defaultValue(r,0),R.Cartesian3.pack(t._center,e,r),r+=R.Cartesian3.packedLength,R.Ellipsoid.pack(t._ellipsoid,e,r),r+=R.Ellipsoid.packedLength,d.VertexFormat.pack(t._vertexFormat,e,r),r+=d.VertexFormat.packedLength,e[r++]=t._semiMajorAxis,e[r++]=t._semiMinorAxis,e[r++]=t._rotation,e[r++]=t._stRotation,e[r++]=t._height,e[r++]=t._granularity,e[r++]=t._extrudedHeight,e[r++]=t._shadowVolume?1:0,e[r]=k.defaultValue(t._offsetAttribute,-1),e};var _=new R.Cartesian3,b=new R.Ellipsoid,C=new d.VertexFormat,v={center:_,ellipsoid:b,vertexFormat:C,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};A.unpack=function(t,e,r){e=k.defaultValue(e,0);var m=R.Cartesian3.unpack(t,e,_),p=(e+=R.Cartesian3.packedLength,R.Ellipsoid.unpack(t,e,b)),y=(e+=R.Ellipsoid.packedLength,d.VertexFormat.unpack(t,e,C)),a=(e+=d.VertexFormat.packedLength,t[e++]),i=t[e++],n=t[e++],o=t[e++],s=t[e++],l=t[e++],u=t[e++],c=1===t[e++],t=t[e];return k.defined(r)?(r._center=R.Cartesian3.clone(m,r._center),r._ellipsoid=R.Ellipsoid.clone(p,r._ellipsoid),r._vertexFormat=d.VertexFormat.clone(y,r._vertexFormat),r._semiMajorAxis=a,r._semiMinorAxis=i,r._rotation=n,r._stRotation=o,r._height=s,r._granularity=l,r._extrudedHeight=u,r._shadowVolume=c,r._offsetAttribute=-1===t?void 0:t,r):(v.height=s,v.extrudedHeight=u,v.granularity=l,v.stRotation=o,v.rotation=n,v.semiMajorAxis=a,v.semiMinorAxis=i,v.shadowVolume=c,v.offsetAttribute=-1===t?void 0:t,new A(v))},A.computeRectangle=function(t,e){var r=(t=k.defaultValue(t,k.defaultValue.EMPTY_OBJECT)).center,a=k.defaultValue(t.ellipsoid,R.Ellipsoid.WGS84),i=t.semiMajorAxis,n=t.semiMinorAxis,o=k.defaultValue(t.granularity,p.CesiumMath.RADIANS_PER_DEGREE);return l(r,i,n,k.defaultValue(t.rotation,0),o,a,e)},A.createGeometry=function(t){var e,r,a,i,n;if(!(t._semiMajorAxis<=0||t._semiMinorAxis<=0))return n=t._height,a=t._extrudedHeight,r=!p.CesiumMath.equalsEpsilon(n,a,0,p.CesiumMath.EPSILON2),t._center=t._ellipsoid.scaleToGeodeticSurface(t._center,t._center),n={center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:t._ellipsoid,rotation:t._rotation,height:n,granularity:t._granularity,vertexFormat:t._vertexFormat,stRotation:t._stRotation},r?(n.extrudedHeight=a,n.shadowVolume=t._shadowVolume,n.offsetAttribute=t._offsetAttribute,e=s(n)):(a=(r=n).center,o=R.Cartesian3.multiplyByScalar(r.ellipsoid.geodeticSurfaceNormal(a,o),r.height,o),o=R.Cartesian3.add(a,o,o),a=new L.BoundingSphere(o,r.semiMajorAxis),i=(n=Y.EllipseGeometryLibrary.computeEllipsePositions(r,!0,!1)).positions,n=n.numPts,r=f(i,r,!1),n=h(n),e={boundingSphere:a,attributes:r,indices:c.IndexDatatype.createTypedArray(i.length/3,n)},k.defined(t._offsetAttribute)&&(a=e.attributes.position.values.length,r=new Uint8Array(a/3),i=t._offsetAttribute===S.GeometryOffsetAttribute.NONE?0:1,S.arrayFill(r,i),e.attributes.applyOffset=new z.GeometryAttribute({componentDatatype:j.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:r}))),new z.Geometry({attributes:e.attributes,indices:e.indices,primitiveType:z.PrimitiveType.TRIANGLES,boundingSphere:e.boundingSphere,offsetAttribute:t._offsetAttribute})},A.createShadowVolume=function(t,e,r){var a=t._granularity,i=t._ellipsoid,e=e(a,i),r=r(a,i);return new A({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:i,rotation:t._rotation,stRotation:t._stRotation,granularity:a,extrudedHeight:e,height:r,vertexFormat:d.VertexFormat.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(A.prototype,{rectangle:{get:function(){return k.defined(this._rectangle)||(this._rectangle=l(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return k.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0==e)return[0,0,0,1,1,0];for(var r=Y.EllipseGeometryLibrary.computeEllipsePositions({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,rotation:t._rotation,granularity:t._granularity},!1,!0).outerPositions,a=r.length/3,i=new Array(a),n=0;n<a;++n)i[n]=R.Cartesian3.fromArray(r,3*n);var o=t._ellipsoid,t=t.rectangle;return z.Geometry._textureCoordinateRotationPoints(i,e,o,t)}(this)),this._textureCoordinateRotationPoints}}}),t.EllipseGeometry=A});
