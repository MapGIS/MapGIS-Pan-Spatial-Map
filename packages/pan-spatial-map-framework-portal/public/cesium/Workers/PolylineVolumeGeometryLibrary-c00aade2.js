define(["exports","./Cartesian2-38b35910","./Transforms-07a9fab5","./EllipsoidTangentPlane-19622103","./Math-5bbcea10","./PolylinePipeline-f47a23a0","./when-ae2e0b60","./Check-f996273c"],function(e,R,m,y,L,j,r,a){"use strict";var O=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),n={};function I(e,a){r.defined(n[e])||(n[e]=!0,console.warn(r.defaultValue(a,e)))}I.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",I.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",I.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",I.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var V=[new R.Cartesian3,new R.Cartesian3],Q=new R.Cartesian3,q=new R.Cartesian3,F=new R.Cartesian3,U=new R.Cartesian3,_=new R.Cartesian3,Z=new R.Cartesian3,k=new R.Cartesian3,W=new R.Cartesian3,Y=new R.Cartesian3,N=new R.Cartesian3,f=new R.Cartesian3,G={},J=new R.Cartographic;function K(e,a,r,n){var t=e[0],e=e[1],t=R.Cartesian3.angleBetween(t,e),i=Math.ceil(t/n),s=new Array(i);if(a===r){for(l=0;l<i;l++)s[l]=a;return s.push(r),s}for(var o=(r-a)/i,l=1;l<i;l++)s[l]=a+l*o;return s[0]=a,s.push(r),s}var h=new R.Cartesian3,p=new R.Cartesian3;var w=new R.Cartesian3(-1,0,0),g=new m.Matrix4,x=new m.Matrix4,v=new m.Matrix3,E=m.Matrix3.IDENTITY.clone(),P=new R.Cartesian3,b=new m.Cartesian4,M=new R.Cartesian3;function H(e,a,r,n,t,c,u,d){var i=P,s=b,a=(g=m.Transforms.eastNorthUpToFixedFrame(e,t,g),i=m.Matrix4.multiplyByPointAsVector(g,w,i),i=R.Cartesian3.normalize(i,i),i=i,a=a,e=e,t=t,t=new y.EllipsoidTangentPlane(e,t),i=t.projectPointOntoPlane(R.Cartesian3.add(e,i,h),h),t=t.projectPointOntoPlane(R.Cartesian3.add(e,a,p),p),e=R.Cartesian2.angleBetween(i,t),0<=t.x*i.y-t.y*i.x?-e:e),o=(v=m.Matrix3.fromRotationZ(a,v),M.z=c,g=m.Matrix4.multiplyTransformation(g,m.Matrix4.fromRotationTranslation(v,M,x),g),E);o[0]=u;for(var l=0;l<d;l++)for(var C=0;C<r.length;C+=3)s=R.Cartesian3.fromArray(r,C,s),s=m.Matrix3.multiplyByVector(o,s,s),s=m.Matrix4.multiplyByPoint(g,s,s),n.push(s.x,s.y,s.z);return n}var l=new R.Cartesian3;function X(e,a,r,n,t,i,s){for(var o=0;o<e.length;o+=3)n=H(R.Cartesian3.fromArray(e,o,l),a,r,n,t,i[o/3],s,1);return n}function $(e,a){for(var r=e.length,n=new Array(3*r),t=0,i=a.x+a.width/2,s=a.y+a.height/2,o=0;o<r;o++)n[t++]=e[o].x-i,n[t++]=0,n[t++]=e[o].y-s;return n}var T=new m.Quaternion,B=new R.Cartesian3,z=new m.Matrix3;function ee(e,a,r,c,n,t,i,s,o,u){var l,d=R.Cartesian3.angleBetween(R.Cartesian3.subtract(a,e,N),R.Cartesian3.subtract(r,e,f)),C=c===O.BEVELED?0:Math.ceil(d/L.CesiumMath.toRadians(5)),g=n?m.Matrix3.fromQuaternion(m.Quaternion.fromAxisAngle(R.Cartesian3.negate(e,N),d/(C+1),T),z):m.Matrix3.fromQuaternion(m.Quaternion.fromAxisAngle(e,d/(C+1),T),z);if(a=R.Cartesian3.clone(a,B),0<C)for(var y=u?2:1,h=0;h<C;h++)a=m.Matrix3.multiplyByVector(g,a,a),l=R.Cartesian3.subtract(a,e,N),l=R.Cartesian3.normalize(l,l),n||(l=R.Cartesian3.negate(l,l)),i=H(t.scaleToGeodeticSurface(a,f),l,s,i,t,o,1,y);else l=R.Cartesian3.subtract(a,e,N),l=R.Cartesian3.normalize(l,l),n||(l=R.Cartesian3.negate(l,l)),i=H(t.scaleToGeodeticSurface(a,f),l,s,i,t,o,1,1),r=R.Cartesian3.clone(r,B),l=R.Cartesian3.subtract(r,e,N),l=R.Cartesian3.normalize(l,l),n||(l=R.Cartesian3.negate(l,l)),i=H(t.scaleToGeodeticSurface(r,f),l,s,i,t,o,1,1);return i}G.removeDuplicatesFromShape=function(e){for(var a=e.length,r=[],n=a-1,t=0;t<a;n=t++){var i=e[n],s=e[t];R.Cartesian2.equals(i,s)||r.push(s)}return r},G.angleIsGreaterThanPi=function(e,a,r,n){n=new y.EllipsoidTangentPlane(r,n),e=n.projectPointOntoPlane(R.Cartesian3.add(r,e,h),h),n=n.projectPointOntoPlane(R.Cartesian3.add(r,a,p),p);return 0<=n.x*e.y-n.y*e.x};var ae=new R.Cartesian3,re=new R.Cartesian3;G.computePositions=function(c,u,d,g,e){var y,a=g._ellipsoid,h=function(e,a){for(var r=new Array(e.length),n=0;n<e.length;n++){var t=e[n];J=a.cartesianToCartographic(t,J),r[n]=J.height,e[n]=a.scaleToGeodeticSurface(t,t)}return r}(c,a),m=g._granularity,f=g._cornerType,p=(e?function(e,a){var r=e.length,n=new Array(6*r),t=0,i=a.x+a.width/2,s=a.y+a.height/2,o=e[0];n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s;for(var l=1;l<r;l++){var C=(o=e[l]).x-i,c=o.y-s;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return o=e[0],n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s,n}:$)(u,d),g=e?$(u,d):void 0,r=d.height/2,w=d.width/2,x=c.length,n=[],u=e?[]:void 0,t=Q,v=q,i=F,s=U,E=_,P=Z,b=k,o=W,M=Y,l=c[0],T=c[1],B=(s=a.geodeticSurfaceNormal(l,s),t=R.Cartesian3.subtract(T,l,t),t=R.Cartesian3.normalize(t,t),o=R.Cartesian3.cross(s,t,o),o=R.Cartesian3.normalize(o,o),h[0]),z=h[1];e&&(u=H(l,o,g,u,a,B+r,1,1)),M=R.Cartesian3.clone(l,M),l=T,v=R.Cartesian3.negate(t,v);for(var S=1;S<x-1;S++){var C,A,D=e?2:1,T=c[S+1];l.equals(T)?I("Positions are too close and are considered equivalent with rounding error."):(t=R.Cartesian3.subtract(T,l,t),t=R.Cartesian3.normalize(t,t),i=R.Cartesian3.add(t,v,i),i=R.Cartesian3.normalize(i,i),s=a.geodeticSurfaceNormal(l,s),C=R.Cartesian3.multiplyByScalar(s,R.Cartesian3.dot(t,s),ae),A=(R.Cartesian3.subtract(t,C,C),R.Cartesian3.normalize(C,C),R.Cartesian3.multiplyByScalar(s,R.Cartesian3.dot(v,s),re)),R.Cartesian3.subtract(v,A,A),R.Cartesian3.normalize(A,A),!L.CesiumMath.equalsEpsilon(Math.abs(R.Cartesian3.dot(C,A)),1,L.CesiumMath.EPSILON7)?(i=R.Cartesian3.cross(i,s,i),i=R.Cartesian3.cross(s,i,i),i=R.Cartesian3.normalize(i,i),C=1/Math.max(.25,R.Cartesian3.magnitude(R.Cartesian3.cross(i,v,N))),(A=G.angleIsGreaterThanPi(t,v,l,a))?(E=R.Cartesian3.add(l,R.Cartesian3.multiplyByScalar(i,C*w,i),E),P=R.Cartesian3.add(E,R.Cartesian3.multiplyByScalar(o,w,P),P),V[0]=R.Cartesian3.clone(M,V[0]),V[1]=R.Cartesian3.clone(P,V[1]),y=K(V,B+r,z+r,m),n=X(j.PolylinePipeline.generateArc({positions:V,granularity:m,ellipsoid:a}),o,p,n,a,y,1),o=R.Cartesian3.cross(s,t,o),o=R.Cartesian3.normalize(o,o),b=R.Cartesian3.add(E,R.Cartesian3.multiplyByScalar(o,w,b),b),f===O.ROUNDED||f===O.BEVELED?ee(E,P,b,f,A,a,n,p,z+r,e):n=H(l,i=R.Cartesian3.negate(i,i),p,n,a,z+r,C,D)):(E=R.Cartesian3.add(l,R.Cartesian3.multiplyByScalar(i,C*w,i),E),P=R.Cartesian3.add(E,R.Cartesian3.multiplyByScalar(o,-w,P),P),V[0]=R.Cartesian3.clone(M,V[0]),V[1]=R.Cartesian3.clone(P,V[1]),y=K(V,B+r,z+r,m),n=X(j.PolylinePipeline.generateArc({positions:V,granularity:m,ellipsoid:a}),o,p,n,a,y,1),o=R.Cartesian3.cross(s,t,o),o=R.Cartesian3.normalize(o,o),b=R.Cartesian3.add(E,R.Cartesian3.multiplyByScalar(o,-w,b),b),f===O.ROUNDED||f===O.BEVELED?ee(E,P,b,f,A,a,n,p,z+r,e):n=H(l,i,p,n,a,z+r,C,D)),M=R.Cartesian3.clone(b,M),v=R.Cartesian3.negate(t,v)):(n=H(M,o,p,n,a,B+r,1,1),M=l),B=z,z=h[S+1],l=T)}V[0]=R.Cartesian3.clone(M,V[0]),V[1]=R.Cartesian3.clone(l,V[1]),y=K(V,B+r,z+r,m),n=X(j.PolylinePipeline.generateArc({positions:V,granularity:m,ellipsoid:a}),o,p,n,a,y,1),e&&(u=H(l,o,g,u,a,z+r,1,1));x=n.length,d=e?x+u.length:x,g=new Float64Array(d);return g.set(n),e&&g.set(u,x),g},e.CornerType=O,e.PolylineVolumeGeometryLibrary=G,e.oneTimeWarning=I});
