let t=new Uint8Array([0]),e=[171,75,84,88,32,50,48,187,13,10,26,10];var n,i,s,a,r,o,l,f;!function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"}(n=n||{}),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(i=i||{}),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(s=s||{}),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(a=a||{}),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(r=r||{}),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(o=o||{}),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(l=l||{}),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(f=f||{});class U{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=n.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:i.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:s.UNSPECIFIED,colorPrimaries:a.SRGB,transferFunction:a.SRGB,flags:o.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null}}class c{constructor(t,e,n,i){this._dataView=new DataView(t.buffer,t.byteOffset+e,n),this._littleEndian=i,this._offset=0}_nextUint8(){var t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){var t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){var t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){var t=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_skip(t){return this._offset+=t,this}_scan(t,e=0){var n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==e&&i<t;)i++,this._offset++;return i<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}function h(t){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(t):Buffer.from(t)}function _(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):Buffer.from(t).toString("utf8")}function g(e){let n=0;for(let t of e)n+=t.byteLength;let i=new Uint8Array(n),s=0;for(let t of e)i.set(new Uint8Array(t),s),s+=t.byteLength;return i}function p(n){let t=new Uint8Array(n.buffer,n.byteOffset,e.length);if(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||t[4]!==e[4]||t[5]!==e[5]||t[6]!==e[6]||t[7]!==e[7]||t[8]!==e[8]||t[9]!==e[9]||t[10]!==e[10]||t[11]!==e[11])throw new Error("Missing KTX 2.0 identifier.");let s=new U,i=17*Uint32Array.BYTES_PER_ELEMENT,a=new c(n,e.length,i,!0);s.vkFormat=a._nextUint32(),s.typeSize=a._nextUint32(),s.pixelWidth=a._nextUint32(),s.pixelHeight=a._nextUint32(),s.pixelDepth=a._nextUint32(),s.layerCount=a._nextUint32(),s.faceCount=a._nextUint32();var r=a._nextUint32(),l=(s.supercompressionScheme=a._nextUint32(),a._nextUint32()),o=a._nextUint32(),f=a._nextUint32(),h=a._nextUint32(),g=a._nextUint64(),p=a._nextUint64(),x=new c(n,e.length+i,3*r*8,!0);for(let t=0;t<r;t++)s.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+x._nextUint64(),x._nextUint64()),uncompressedByteLength:x._nextUint64()});var u=new c(n,l,o,!0),y={vendorId:u._skip(4)._nextUint16(),descriptorType:u._nextUint16(),versionNumber:u._nextUint16(),descriptorBlockSize:u._nextUint16(),colorModel:u._nextUint8(),colorPrimaries:u._nextUint8(),transferFunction:u._nextUint8(),flags:u._nextUint8(),texelBlockDimension:{x:u._nextUint8()+1,y:u._nextUint8()+1,z:u._nextUint8()+1,w:u._nextUint8()+1},bytesPlane:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],samples:[]},D=(y.descriptorBlockSize/4-6)/4;for(let t=0;t<D;t++)y.samples[t]={bitOffset:u._nextUint16(),bitLength:u._nextUint8(),channelID:u._nextUint8(),samplePosition:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],sampleLower:u._nextUint32(),sampleUpper:u._nextUint32()};s.dataFormatDescriptor.length=0,s.dataFormatDescriptor.push(y);for(var b=new c(n,f,h,!0);b._offset<h;){let t=b._nextUint32(),e=b._scan(t),n=_(e),i=b._scan(t-e.byteLength);s.keyValue[n]=n.match(/^ktx/i)?_(i):i,b._offset%4&&b._skip(4-b._offset%4)}if(!(p<=0)){var d=new c(n,g,p,!0),l=d._nextUint16(),o=d._nextUint16(),f=d._nextUint32(),p=d._nextUint32(),S=d._nextUint32(),B=d._nextUint32(),w=[];for(let t=0;t<r;t++)w.push({imageFlags:d._nextUint32(),rgbSliceByteOffset:d._nextUint32(),rgbSliceByteLength:d._nextUint32(),alphaSliceByteOffset:d._nextUint32(),alphaSliceByteLength:d._nextUint32()});var g=g+d._offset,A=g+f,m=A+p,T=m+S,g=new Uint8Array(n.buffer,n.byteOffset+g,f),f=new Uint8Array(n.buffer,n.byteOffset+A,p),A=new Uint8Array(n.buffer,n.byteOffset+m,S),p=new Uint8Array(n.buffer,n.byteOffset+T,B);s.globalData={endpointCount:l,selectorCount:o,imageDescs:w,endpointsData:g,selectorsData:f,tablesData:A,extendedData:p}}return s}function x(){return(x=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n,i=arguments[e];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}let u={keepWriter:!1};function y(s,n={}){n=x({},u,n);let a=new ArrayBuffer(0);if(s.globalData){let t=new ArrayBuffer(20+5*s.globalData.imageDescs.length*4),n=new DataView(t);n.setUint16(0,s.globalData.endpointCount,!0),n.setUint16(2,s.globalData.selectorCount,!0),n.setUint32(4,s.globalData.endpointsData.byteLength,!0),n.setUint32(8,s.globalData.selectorsData.byteLength,!0),n.setUint32(12,s.globalData.tablesData.byteLength,!0),n.setUint32(16,s.globalData.extendedData.byteLength,!0);for(let e=0;e<s.globalData.imageDescs.length;e++){let t=s.globalData.imageDescs[e];n.setUint32(20+5*e*4,t.imageFlags,!0),n.setUint32(20+5*e*4+4,t.rgbSliceByteOffset,!0),n.setUint32(20+5*e*4+8,t.rgbSliceByteLength,!0),n.setUint32(20+5*e*4+12,t.alphaSliceByteOffset,!0),n.setUint32(20+5*e*4+16,t.alphaSliceByteLength,!0)}a=g([t,s.globalData.endpointsData,s.globalData.selectorsData,s.globalData.tablesData,s.globalData.extendedData])}var l=[];let o=s.keyValue;for(let r in o=n.keepWriter?o:x({},s.keyValue,{KTXwriter:"KTX-Parse v0.2.1"})){let e=o[r],n=h(r),i="string"==typeof e?h(e):e,s=n.byteLength+1+i.byteLength+1,a=s%4?4-s%4:0;l.push(g([new Uint32Array([s]),n,t,i,t,new Uint8Array(a).fill(0)]))}let r=g(l),f=new ArrayBuffer(44),U=new DataView(f);if(1!==s.dataFormatDescriptor.length||s.dataFormatDescriptor[0].descriptorType!==i.BASICFORMAT)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");var _=s.dataFormatDescriptor[0];U.setUint32(0,44,!0),U.setUint16(4,_.vendorId,!0),U.setUint16(6,_.descriptorType,!0),U.setUint16(8,_.versionNumber,!0),U.setUint16(10,_.descriptorBlockSize,!0),U.setUint8(12,_.colorModel),U.setUint8(13,_.colorPrimaries),U.setUint8(14,_.transferFunction),U.setUint8(15,_.flags),U.setUint8(16,_.texelBlockDimension.x-1),U.setUint8(17,_.texelBlockDimension.y-1),U.setUint8(18,_.texelBlockDimension.z-1),U.setUint8(19,_.texelBlockDimension.w-1);for(let t=0;t<8;t++)U.setUint8(20+t,_.bytesPlane[t]);for(let n=0;n<_.samples.length;n++){let t=_.samples[n],e=28+16*n;U.setUint16(e,t.bitOffset,!0),U.setUint8(2+e,t.bitLength),U.setUint8(3+e,t.channelID),U.setUint8(4+e,t.samplePosition[0]),U.setUint8(5+e,t.samplePosition[1]),U.setUint8(6+e,t.samplePosition[2]),U.setUint8(7+e,t.samplePosition[3]),U.setUint32(8+e,t.sampleLower,!0),U.setUint32(12+e,t.sampleUpper,!0)}var n=e.length+68+3*s.levels.length*8,c=n+f.byteLength;let p=c+r.byteLength;p%8&&(p+=8-p%8);var y=[],D=new DataView(new ArrayBuffer(3*s.levels.length*8));let b=p+a.byteLength;for(let e=0;e<s.levels.length;e++){let t=s.levels[e];y.push(t.levelData),D.setBigUint64(24*e+0,BigInt(b),!0),D.setBigUint64(24*e+8,BigInt(t.levelData.byteLength),!0),D.setBigUint64(24*e+16,BigInt(t.uncompressedByteLength),!0),b+=t.levelData.byteLength}var d=new ArrayBuffer(68),S=new DataView(d);return S.setUint32(0,s.vkFormat,!0),S.setUint32(4,s.typeSize,!0),S.setUint32(8,s.pixelWidth,!0),S.setUint32(12,s.pixelHeight,!0),S.setUint32(16,s.pixelDepth,!0),S.setUint32(20,s.layerCount,!0),S.setUint32(24,s.faceCount,!0),S.setUint32(28,s.levels.length,!0),S.setUint32(32,s.supercompressionScheme,!0),S.setUint32(36,n,!0),S.setUint32(40,f.byteLength,!0),S.setUint32(44,c,!0),S.setUint32(48,r.byteLength,!0),S.setBigUint64(52,BigInt(p),!0),S.setBigUint64(60,BigInt(a.byteLength),!0),new Uint8Array(g([new Uint8Array(e).buffer,d,D.buffer,f,r,new ArrayBuffer(p-(c+r.byteLength)),a,...y]))}export{l as KTX2ChannelETC1S,f as KTX2ChannelUASTC,U as KTX2Container,i as KTX2DescriptorType,o as KTX2Flags,s as KTX2Model,a as KTX2Primaries,n as KTX2SupercompressionScheme,r as KTX2Transfer,p as read,y as write};