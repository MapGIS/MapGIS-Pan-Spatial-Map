define(["./when-ae2e0b60","./Matrix2-59fd2efe","./GeometryOffsetAttribute-8c0bd3ce","./Transforms-3bc98d07","./RuntimeError-24b14c10","./ComponentDatatype-b7b5db18","./GeometryAttribute-dff85b2b","./GeometryAttributes-5ce4955a","./GeometryInstance-e2137e03","./GeometryPipeline-74305cde","./IndexDatatype-6902a37d","./PolygonPipeline-ea1c8d04","./RectangleGeometryLibrary-c2148ae2","./VertexFormat-1fc9746e","./combine-276652d0","./WebGLConstants-35626ea2","./AttributeCompression-2f7b45b7","./EncodedCartesian3-3b6655b5","./IntersectionTests-d0a84f0f","./Plane-43337cee","./EllipsoidRhumbLine-535d21cd"],function(X,Q,W,c,t,J,j,r,Z,K,$,tt,S,et,e,a,n,o,i,s,l){var at=new Q.Cartesian3,rt=new Q.Cartesian3,nt=new Q.Cartesian3,ot=new Q.Cartesian3,m=new Q.Rectangle,I=new Q.Cartesian2,d=new c.BoundingSphere,p=new c.BoundingSphere;function it(t,e){var a=new j.Geometry({attributes:new r.GeometryAttributes,primitiveType:j.PrimitiveType.TRIANGLES});return a.attributes.position=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var st=new Q.Cartesian3,lt=new Q.Cartesian3;function ut(t,e){for(var a=t._vertexFormat,r=t._ellipsoid,t=e.height,n=e.width,o=e.northCap,i=e.southCap,s=0,l=t,u=t,c=0,m=(o&&(--u,c+=s=1),i&&(--l,--u,c+=1),c+=n*u,a.position?new Float64Array(3*c):void 0),d=a.st?new Float32Array(2*c):void 0,p=0,g=0,y=at,f=I,h=Number.MAX_VALUE,b=Number.MAX_VALUE,_=-Number.MAX_VALUE,v=-Number.MAX_VALUE,A=s;A<l;++A)for(var x=0;x<n;++x)S.RectangleGeometryLibrary.computePosition(e,r,a.st,A,x,y,f),m[p++]=y.x,m[p++]=y.y,m[p++]=y.z,a.st&&(d[g++]=f.x,d[g++]=f.y,h=Math.min(h,f.x),b=Math.min(b,f.y),_=Math.max(_,f.x),v=Math.max(v,f.y));if(o&&(S.RectangleGeometryLibrary.computePosition(e,r,a.st,0,0,y,f),m[p++]=y.x,m[p++]=y.y,m[p++]=y.z,a.st)&&(d[g++]=f.x,d[g++]=f.y,h=f.x,b=f.y,_=f.x,v=f.y),i&&(S.RectangleGeometryLibrary.computePosition(e,r,a.st,t-1,0,y,f),m[p++]=y.x,m[p++]=y.y,m[p]=y.z,a.st)&&(d[g++]=f.x,d[g]=f.y,h=Math.min(h,f.x),b=Math.min(b,f.y),_=Math.max(_,f.x),v=Math.max(v,f.y)),a.st&&(h<0||b<0||1<_||1<v))for(var w=0;w<d.length;w+=2)d[w]=(d[w]-h)/(_-h),d[w+1]=(d[w+1]-b)/(v-b);for(var s=function(t,e,a,r){var n=t.length,o=e.normal?new Float32Array(n):void 0,i=e.tangent?new Float32Array(n):void 0,s=e.bitangent?new Float32Array(n):void 0,l=0,u=ot,c=nt,m=rt;if(e.normal||e.tangent||e.bitangent)for(var d=0;d<n;d+=3){var p=Q.Cartesian3.fromArray(t,d,at),g=l+1,y=l+2,m=a.geodeticSurfaceNormal(p,m);(e.tangent||e.bitangent)&&(Q.Cartesian3.cross(Q.Cartesian3.UNIT_Z,m,c),Q.Matrix3.multiplyByVector(r,c,c),Q.Cartesian3.normalize(c,c),e.bitangent)&&Q.Cartesian3.normalize(Q.Cartesian3.cross(m,c,u),u),e.normal&&(o[l]=m.x,o[g]=m.y,o[y]=m.z),e.tangent&&(i[l]=c.x,i[g]=c.y,i[y]=c.z),e.bitangent&&(s[l]=u.x,s[g]=u.y,s[y]=u.z),l+=3}return it(e,{positions:t,normals:o,tangents:i,bitangents:s})}(m,a,r,e.tangentRotationMatrix),t=6*(n-1)*(u-1),C=(o&&(t+=3*(n-1)),i&&(t+=3*(n-1)),$.IndexDatatype.createTypedArray(c,t)),R=0,E=0,F=0;F<u-1;++F){for(var G=0;G<n-1;++G){var P=R,V=P+n,L=V+1,D=P+1;C[E++]=P,C[E++]=V,C[E++]=D,C[E++]=D,C[E++]=V,C[E++]=L,++R}++R}if(o||i){var M,T,O=c-1,N=c-1;if(o&&i&&(O=c-2),R=0,o)for(F=0;F<n-1;F++)T=(M=R)+1,C[E++]=O,C[E++]=M,C[E++]=T,++R;if(i)for(R=(u-1)*n,F=0;F<n-1;F++)T=(M=R)+1,C[E++]=M,C[E++]=N,C[E++]=T,++R}return s.indices=C,a.st&&(s.attributes.st=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:d})),s}function ct(t,e,a,r,n){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function mt(t,e,a,r){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a],t[e]=r[a+1],t}var dt=new et.VertexFormat;function x(t,e){var a,r,N,n=t._shadowVolume,o=t._offsetAttribute,i=t._vertexFormat,s=t._extrudedHeight,l=t._surfaceHeight,S=t._ellipsoid,u=e.height,c=e.width,m=(n&&((m=et.VertexFormat.clone(i,dt)).normal=!0,t._vertexFormat=m),ut(t,e)),d=(n&&(t._vertexFormat=i),tt.PolygonPipeline.scaleToGeodeticHeight(m.attributes.position.values,l,S,!1)),t=2*(T=(d=new Float64Array(d)).length),l=new Float64Array(t),p=(l.set(d),tt.PolygonPipeline.scaleToGeodeticHeight(m.attributes.position.values,s,S)),s=(l.set(p,T),m.attributes.position.values=l,i.normal?new Float32Array(t):void 0),l=i.tangent?new Float32Array(t):void 0,g=i.bitangent?new Float32Array(t):void 0,y=i.st?new Float32Array(t/3*2):void 0;if(i.normal){for(r=m.attributes.normal.values,s.set(r),f=0;f<T;f++)r[f]=-r[f];s.set(r,T),m.attributes.normal.values=s}if(n){r=m.attributes.normal.values,i.normal||(m.attributes.normal=void 0);for(var s=new Float32Array(t),f=0;f<T;f++)r[f]=-r[f];s.set(r,T),m.attributes.extrudeDirection=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:s})}s=X.defined(o);if(s&&(A=T/3*2,v=new Uint8Array(A),v=o===W.GeometryOffsetAttribute.TOP?W.arrayFill(v,1,0,A/2):(N=o===W.GeometryOffsetAttribute.NONE?0:1,W.arrayFill(v,N)),m.attributes.applyOffset=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:v})),i.tangent){var I=m.attributes.tangent.values;for(l.set(I),f=0;f<T;f++)I[f]=-I[f];l.set(I,T),m.attributes.tangent.values=l}i.bitangent&&(A=m.attributes.bitangent.values,g.set(A),g.set(A,T),m.attributes.bitangent.values=g),i.st&&(a=m.attributes.st.values,y.set(a),y.set(a,T/3*2),m.attributes.st.values=y);var h=m.indices,b=h.length,k=T/3,_=$.IndexDatatype.createTypedArray(t/3,2*b);for(_.set(h),f=0;f<b;f+=3)_[f+b]=h[f+2]+k,_[f+1+b]=h[f+1]+k,_[f+2+b]=h[f]+k;m.indices=_;var v=e.northCap,l=e.southCap,A=u,g=2,y=0,t=4,e=4,u=(v&&(--g,--A,y+=1,t-=2,--e),l&&(--g,--A,y+=1,t-=2,--e),2*((y+=g*c+2*A-t)+e)),x=new Float64Array(3*u),w=n?new Float32Array(3*u):void 0,C=s?new Uint8Array(u):void 0,R=i.st?new Float32Array(2*u):void 0,E=o===W.GeometryOffsetAttribute.TOP,F=(s&&!E&&(N=o===W.GeometryOffsetAttribute.ALL?1:0,C=W.arrayFill(C,N)),0),G=0,P=0,V=0,L=c*A;for(f=0;f<L;f+=c)x=ct(x,F,D=3*f,d,p),F+=6,i.st&&(R=mt(R,G,2*f,a),G+=4),n&&(P+=3,w[P++]=r[D],w[P++]=r[D+1],w[P++]=r[D+2]),E&&(C[V++]=1,V+=1);if(l){var H=v?1+L:L,D=3*H;for(f=0;f<2;f++)x=ct(x,F,D,d,p),F+=6,i.st&&(R=mt(R,G,2*H,a),G+=4),n&&(P+=3,w[P++]=r[D],w[P++]=r[D+1],w[P++]=r[D+2]),E&&(C[V++]=1,V+=1)}else for(f=L-c;f<L;f++)x=ct(x,F,D=3*f,d,p),F+=6,i.st&&(R=mt(R,G,2*f,a),G+=4),n&&(P+=3,w[P++]=r[D],w[P++]=r[D+1],w[P++]=r[D+2]),E&&(C[V++]=1,V+=1);for(f=L-1;0<f;f-=c)x=ct(x,F,D=3*f,d,p),F+=6,i.st&&(R=mt(R,G,2*f,a),G+=4),n&&(P+=3,w[P++]=r[D],w[P++]=r[D+1],w[P++]=r[D+2]),E&&(C[V++]=1,V+=1);if(v){var z=L;for(D=3*z,f=0;f<2;f++)x=ct(x,F,D,d,p),F+=6,i.st&&(R=mt(R,G,2*z,a),G+=4),n&&(P+=3,w[P++]=r[D],w[P++]=r[D+1],w[P++]=r[D+2]),E&&(C[V++]=1,V+=1)}else for(f=c-1;0<=f;f--)x=ct(x,F,D=3*f,d,p),F+=6,i.st&&(R=mt(R,G,2*f,a),G+=4),n&&(P+=3,w[P++]=r[D],w[P++]=r[D+1],w[P++]=r[D+2]),E&&(C[V++]=1,V+=1);var g=function(t,e,a){var r=t.length,n=e.normal?new Float32Array(r):void 0,o=e.tangent?new Float32Array(r):void 0,i=e.bitangent?new Float32Array(r):void 0,s=0,l=0,u=0,c=!0,m=ot,d=nt,p=rt;if(e.normal||e.tangent||e.bitangent)for(var g=0;g<r;g+=6){var y,f=Q.Cartesian3.fromArray(t,g,at),h=Q.Cartesian3.fromArray(t,(g+6)%r,st);c&&(y=Q.Cartesian3.fromArray(t,(g+3)%r,lt),Q.Cartesian3.subtract(h,f,h),Q.Cartesian3.subtract(y,f,y),p=Q.Cartesian3.normalize(Q.Cartesian3.cross(y,h,p),p),c=!1),Q.Cartesian3.equalsEpsilon(h,f,J.CesiumMath.EPSILON10)&&(c=!0),(e.tangent||e.bitangent)&&(m=a.geodeticSurfaceNormal(f,m),e.tangent)&&(d=Q.Cartesian3.normalize(Q.Cartesian3.cross(m,p,d),d)),e.normal&&(n[s++]=p.x,n[s++]=p.y,n[s++]=p.z,n[s++]=p.x,n[s++]=p.y,n[s++]=p.z),e.tangent&&(o[l++]=d.x,o[l++]=d.y,o[l++]=d.z,o[l++]=d.x,o[l++]=d.y,o[l++]=d.z),e.bitangent&&(i[u++]=m.x,i[u++]=m.y,i[u++]=m.z,i[u++]=m.x,i[u++]=m.y,i[u++]=m.z)}return it(e,{positions:t,normals:n,tangents:o,bitangents:i})}(x,i,S),M=(i.st&&(g.attributes.st=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:R})),n&&(g.attributes.extrudeDirection=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),s&&(g.attributes.applyOffset=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:C})),$.IndexDatatype.createTypedArray(u,6*y)),T=x.length/3,O=0;for(f=0;f<T-1;f+=2){var B,U=((B=f)+2)%T,Y=Q.Cartesian3.fromArray(x,3*B,st),q=Q.Cartesian3.fromArray(x,3*U,lt);Q.Cartesian3.equalsEpsilon(Y,q,J.CesiumMath.EPSILON10)||(q=(2+(Y=(B+1)%T))%T,M[O++]=B,M[O++]=Y,M[O++]=U,M[O++]=U,M[O++]=Y,M[O++]=q)}return g.indices=M,(g=K.GeometryPipeline.combineInstances([new Z.GeometryInstance({geometry:m}),new Z.GeometryInstance({geometry:g})]))[0]}var u=[new Q.Cartesian3,new Q.Cartesian3,new Q.Cartesian3,new Q.Cartesian3],g=new Q.Cartographic,w=new Q.Cartographic;function y(t,e,a,r,n){var o;return 0===a?Q.Rectangle.clone(t,n):(e=(t=S.RectangleGeometryLibrary.computeOptions(t,e,a,0,m,g)).height,a=t.width,S.RectangleGeometryLibrary.computePosition(t,r,!1,0,0,(o=u)[0]),S.RectangleGeometryLibrary.computePosition(t,r,!1,0,a-1,o[1]),S.RectangleGeometryLibrary.computePosition(t,r,!1,e-1,0,o[2]),S.RectangleGeometryLibrary.computePosition(t,r,!1,e-1,a-1,o[3]),Q.Rectangle.fromCartesianArray(o,r,n))}function f(t){var e=(t=X.defaultValue(t,X.defaultValue.EMPTY_OBJECT)).rectangle,a=X.defaultValue(t.height,0),r=X.defaultValue(t.extrudedHeight,a);this._rectangle=Q.Rectangle.clone(e),this._granularity=X.defaultValue(t.granularity,J.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=Q.Ellipsoid.clone(X.defaultValue(t.ellipsoid,Q.Ellipsoid.WGS84)),this._surfaceHeight=Math.max(a,r),this._rotation=X.defaultValue(t.rotation,0),this._stRotation=X.defaultValue(t.stRotation,0),this._vertexFormat=et.VertexFormat.clone(X.defaultValue(t.vertexFormat,et.VertexFormat.DEFAULT)),this._extrudedHeight=Math.min(a,r),this._shadowVolume=X.defaultValue(t.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=t.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}f.packedLength=Q.Rectangle.packedLength+Q.Ellipsoid.packedLength+et.VertexFormat.packedLength+7,f.pack=function(t,e,a){return a=X.defaultValue(a,0),Q.Rectangle.pack(t._rectangle,e,a),a+=Q.Rectangle.packedLength,Q.Ellipsoid.pack(t._ellipsoid,e,a),a+=Q.Ellipsoid.packedLength,et.VertexFormat.pack(t._vertexFormat,e,a),a+=et.VertexFormat.packedLength,e[a++]=t._granularity,e[a++]=t._surfaceHeight,e[a++]=t._rotation,e[a++]=t._stRotation,e[a++]=t._extrudedHeight,e[a++]=t._shadowVolume?1:0,e[a]=X.defaultValue(t._offsetAttribute,-1),e};var h=new Q.Rectangle,b=Q.Ellipsoid.clone(Q.Ellipsoid.UNIT_SPHERE),_={rectangle:h,ellipsoid:b,vertexFormat:dt,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0},C=(f.unpack=function(t,e,a){e=X.defaultValue(e,0);var r=Q.Rectangle.unpack(t,e,h),n=(e+=Q.Rectangle.packedLength,Q.Ellipsoid.unpack(t,e,b)),o=(e+=Q.Ellipsoid.packedLength,et.VertexFormat.unpack(t,e,dt)),i=(e+=et.VertexFormat.packedLength,t[e++]),s=t[e++],l=t[e++],u=t[e++],c=t[e++],m=1===t[e++],t=t[e];return X.defined(a)?(a._rectangle=Q.Rectangle.clone(r,a._rectangle),a._ellipsoid=Q.Ellipsoid.clone(n,a._ellipsoid),a._vertexFormat=et.VertexFormat.clone(o,a._vertexFormat),a._granularity=i,a._surfaceHeight=s,a._rotation=l,a._stRotation=u,a._extrudedHeight=c,a._shadowVolume=m,a._offsetAttribute=-1===t?void 0:t,a):(_.granularity=i,_.height=s,_.rotation=l,_.stRotation=u,_.extrudedHeight=c,_.shadowVolume=m,_.offsetAttribute=-1===t?void 0:t,new f(_))},f.computeRectangle=function(t,e){var a=(t=X.defaultValue(t,X.defaultValue.EMPTY_OBJECT)).rectangle,r=X.defaultValue(t.granularity,J.CesiumMath.RADIANS_PER_DEGREE),n=X.defaultValue(t.ellipsoid,Q.Ellipsoid.WGS84);return y(a,r,X.defaultValue(t.rotation,0),n,e)},new Q.Matrix3),v=new c.Quaternion,R=new Q.Cartographic,A=(f.createGeometry=function(t){var e,a,r,n,o,i,s,l,u;if(!J.CesiumMath.equalsEpsilon(t._rectangle.north,t._rectangle.south,J.CesiumMath.EPSILON10)&&!J.CesiumMath.equalsEpsilon(t._rectangle.east,t._rectangle.west,J.CesiumMath.EPSILON10))return e=t._rectangle,a=t._ellipsoid,n=t._rotation,s=t._stRotation,r=t._vertexFormat,i=S.RectangleGeometryLibrary.computeOptions(e,t._granularity,n,s,m,g,w),l=C,0!==s||0!==n?(n=Q.Rectangle.center(e,R),n=a.geodeticSurfaceNormalCartographic(n,st),c.Quaternion.fromAxisAngle(n,-s,v),Q.Matrix3.fromQuaternion(v,l)):Q.Matrix3.clone(Q.Matrix3.IDENTITY,l),n=t._surfaceHeight,s=t._extrudedHeight,u=!J.CesiumMath.equalsEpsilon(n,s,0,J.CesiumMath.EPSILON2),i.lonScalar=1/t._rectangle.width,i.latScalar=1/t._rectangle.height,i.tangentRotationMatrix=l,e=t._rectangle,i=u?(o=x(t,i),l=c.BoundingSphere.fromRectangle3D(e,a,n,p),u=c.BoundingSphere.fromRectangle3D(e,a,s,d),c.BoundingSphere.union(l,u)):((o=ut(t,i)).attributes.position.values=tt.PolygonPipeline.scaleToGeodeticHeight(o.attributes.position.values,n,a,!1),X.defined(t._offsetAttribute)&&(s=o.attributes.position.values.length,l=new Uint8Array(s/3),u=t._offsetAttribute===W.GeometryOffsetAttribute.NONE?0:1,W.arrayFill(l,u),o.attributes.applyOffset=new j.GeometryAttribute({componentDatatype:J.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:l})),c.BoundingSphere.fromRectangle3D(e,a,n)),r.position||delete o.attributes.position,new j.Geometry({attributes:o.attributes,indices:o.indices,primitiveType:o.primitiveType,boundingSphere:i,offsetAttribute:t._offsetAttribute})},f.createShadowVolume=function(t,e,a){var r=t._granularity,n=t._ellipsoid,e=e(r,n),a=a(r,n);return new f({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:r,extrudedHeight:a,height:e,vertexFormat:et.VertexFormat.POSITION_ONLY,shadowVolume:!0})},new Q.Rectangle),E=[new Q.Cartesian2,new Q.Cartesian2,new Q.Cartesian2],F=new Q.Matrix2,G=new Q.Cartographic;return Object.defineProperties(f.prototype,{rectangle:{get:function(){return X.defined(this._rotatedRectangle)||(this._rotatedRectangle=y(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return X.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];for(var e=Q.Rectangle.clone(t._rectangle,A),a=t._granularity,r=t._ellipsoid,e=y(e,a,t._rotation-t._stRotation,r,A),n=E,o=(n[0].x=e.west,n[0].y=e.south,n[1].x=e.west,n[1].y=e.north,n[2].x=e.east,n[2].y=e.south,t.rectangle),i=Q.Matrix2.fromRotation(t._stRotation,F),s=Q.Rectangle.center(o,G),l=0;l<3;++l){var u=n[l];u.x-=s.longitude,u.y-=s.latitude,Q.Matrix2.multiplyByVector(i,u,u),u.x+=s.longitude,u.y+=s.latitude,u.x=(u.x-o.west)/o.width,u.y=(u.y-o.south)/o.height}return a=n[0],r=n[1],e=n[2],t=new Array(6),Q.Cartesian2.pack(a,t),Q.Cartesian2.pack(r,t,2),Q.Cartesian2.pack(e,t,4),t}(this)),this._textureCoordinateRotationPoints}}}),function(t,e){return(t=X.defined(e)?f.unpack(t,e):t)._ellipsoid=Q.Ellipsoid.clone(t._ellipsoid),t._rectangle=Q.Rectangle.clone(t._rectangle),f.createGeometry(t)}});
