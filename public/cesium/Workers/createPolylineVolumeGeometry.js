define(["./when-ae2e0b60","./Matrix2-59fd2efe","./arrayRemoveDuplicates-bce1b0dc","./BoundingRectangle-2fee92a2","./Transforms-3bc98d07","./ComponentDatatype-b7b5db18","./PolylineVolumeGeometryLibrary-aaaa4829","./RuntimeError-24b14c10","./GeometryAttribute-dff85b2b","./GeometryAttributes-5ce4955a","./GeometryPipeline-74305cde","./IndexDatatype-6902a37d","./PolygonPipeline-ea1c8d04","./VertexFormat-1fc9746e","./combine-276652d0","./WebGLConstants-35626ea2","./EllipsoidTangentPlane-0cf355bc","./AxisAlignedBoundingBox-9ec4e335","./IntersectionTests-d0a84f0f","./Plane-43337cee","./PolylinePipeline-5ce4be00","./EllipsoidGeodesic-640f147e","./EllipsoidRhumbLine-535d21cd","./AttributeCompression-2f7b45b7","./EncodedCartesian3-3b6655b5"],function(c,T,G,D,w,R,B,e,S,I,O,N,W,u,t,n,i,a,o,r,l,s,p,d,m){function y(e){var t=(e=c.defaultValue(e,c.defaultValue.EMPTY_OBJECT)).polylinePositions,n=e.shapePositions,e=(this._positions=t,this._shape=n,this._ellipsoid=T.Ellipsoid.clone(c.defaultValue(e.ellipsoid,T.Ellipsoid.WGS84)),this._cornerType=c.defaultValue(e.cornerType,B.CornerType.ROUNDED),this._vertexFormat=u.VertexFormat.clone(c.defaultValue(e.vertexFormat,u.VertexFormat.DEFAULT)),this._granularity=c.defaultValue(e.granularity,R.CesiumMath.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry",1+t.length*T.Cartesian3.packedLength);e+=1+n.length*T.Cartesian2.packedLength,this.packedLength=e+T.Ellipsoid.packedLength+u.VertexFormat.packedLength+2}y.pack=function(e,t,n){n=c.defaultValue(n,0);var i,a=e._positions,o=a.length;for(t[n++]=o,i=0;i<o;++i,n+=T.Cartesian3.packedLength)T.Cartesian3.pack(a[i],t,n);var r=e._shape,o=r.length;for(t[n++]=o,i=0;i<o;++i,n+=T.Cartesian2.packedLength)T.Cartesian2.pack(r[i],t,n);return T.Ellipsoid.pack(e._ellipsoid,t,n),n+=T.Ellipsoid.packedLength,u.VertexFormat.pack(e._vertexFormat,t,n),n+=u.VertexFormat.packedLength,t[n++]=e._cornerType,t[n]=e._granularity,t};var g=T.Ellipsoid.clone(T.Ellipsoid.UNIT_SPHERE),h=new u.VertexFormat,f={polylinePositions:void 0,shapePositions:void 0,ellipsoid:g,vertexFormat:h,cornerType:void 0,granularity:void 0},U=(y.unpack=function(e,t,n){t=c.defaultValue(t,0);for(var i=e[t++],a=new Array(i),o=0;o<i;++o,t+=T.Cartesian3.packedLength)a[o]=T.Cartesian3.unpack(e,t);var i=e[t++],r=new Array(i);for(o=0;o<i;++o,t+=T.Cartesian2.packedLength)r[o]=T.Cartesian2.unpack(e,t);var l=T.Ellipsoid.unpack(e,t,g),s=(t+=T.Ellipsoid.packedLength,u.VertexFormat.unpack(e,t,h)),p=(t+=u.VertexFormat.packedLength,e[t++]),d=e[t];return c.defined(n)?(n._positions=a,n._shape=r,n._ellipsoid=T.Ellipsoid.clone(l,n._ellipsoid),n._vertexFormat=u.VertexFormat.clone(s,n._vertexFormat),n._cornerType=p,n._granularity=d,n):(f.polylinePositions=a,f.shapePositions=r,f.cornerType=p,f.granularity=d,new y(f))},new D.BoundingRectangle);return y.createGeometry=function(e){var t=e._positions,t=G.arrayRemoveDuplicates(t,T.Cartesian3.equalsEpsilon),n=e._shape,n=B.PolylineVolumeGeometryLibrary.removeDuplicatesFromShape(n);if(!(t.length<2||n.length<3)){W.PolygonPipeline.computeWindingOrder2D(n)===W.WindingOrder.CLOCKWISE&&n.reverse();var i,a,o,r,l,s=D.BoundingRectangle.fromPoints(n,U),t=B.PolylineVolumeGeometryLibrary.computePositions(t,n,s,e,!0),p=n,n=s,s=e._vertexFormat,e=new I.GeometryAttributes,d=(s.position&&(e.position=new S.GeometryAttribute({componentDatatype:R.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:t})),p.length),c=t.length/3,u=(c-2*d)/(2*d),m=W.PolygonPipeline.triangulate(p),y=(u-1)*d*6+2*m.length,g=N.IndexDatatype.createTypedArray(c,y),h=2*d,f=0;for(V=0;V<u-1;V++){for(i=0;i<d-1;i++)l=(a=2*i+V*d*2)+h,r=(o=a+1)+h,g[f++]=o,g[f++]=a,g[f++]=r,g[f++]=r,g[f++]=a,g[f++]=l;r=(o=(a=2*d-2+V*d*2)+1)+h,l=a+h,g[f++]=o,g[f++]=a,g[f++]=r,g[f++]=r,g[f++]=a,g[f++]=l}if(s.st||s.tangent||s.bitangent){for(var b,v,P=new Float32Array(2*c),E=1/(u-1),_=1/n.height,k=n.height/2,L=0,V=0;V<u;V++){for(v=_*(p[0].y+k),P[L++]=b=V*E,P[L++]=v,i=1;i<d;i++)v=_*(p[i].y+k),P[L++]=b,P[L++]=v,P[L++]=b,P[L++]=v;v=_*(p[0].y+k),P[L++]=b,P[L++]=v}for(i=0;i<d;i++)v=_*(p[i].y+k),P[L++]=b=0,P[L++]=v;for(i=0;i<d;i++)v=_*(p[i].y+k),P[L++]=b=(u-1)*E,P[L++]=v;e.st=new S.GeometryAttribute({componentDatatype:R.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(P)})}var x=c-2*d;for(V=0;V<m.length;V+=3){var C=m[V]+x,F=m[V+1]+x,A=m[V+2]+x;g[f++]=C,g[f++]=F,g[f++]=A,g[f++]=A+d,g[f++]=F+d,g[f++]=C+d}if(y=new S.Geometry({attributes:e,indices:g,boundingSphere:w.BoundingSphere.fromVertices(t),primitiveType:S.PrimitiveType.TRIANGLES}),s.normal&&(y=O.GeometryPipeline.computeNormal(y)),s.tangent||s.bitangent){try{y=O.GeometryPipeline.computeTangentAndBitangent(y)}catch(e){B.oneTimeWarning("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}s.tangent||(y.attributes.tangent=void 0),s.bitangent||(y.attributes.bitangent=void 0),s.st||(y.attributes.st=void 0)}return y}},function(e,t){return(e=c.defined(t)?y.unpack(e,t):e)._ellipsoid=T.Ellipsoid.clone(e._ellipsoid),y.createGeometry(e)}});
