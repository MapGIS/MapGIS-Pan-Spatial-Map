define(["exports","./Cartesian2-38b35910","./when-ae2e0b60","./Check-f996273c","./Transforms-ce97037a","./Math-5bbcea10"],function(a,w,f,t,R,v){"use strict";var S={};function s(a,t,e){var n=a+t;return v.CesiumMath.sign(a)!==v.CesiumMath.sign(t)&&Math.abs(n/Math.max(Math.abs(a),Math.abs(t)))<e?0:n}S.computeDiscriminant=function(a,t,e){return t*t-4*a*e},S.computeRealRoots=function(a,t,e){var n,r,i;return 0===a?0===t?[]:[-e/t]:0===t?0===e||(r=Math.abs(e))<(i=Math.abs(a))&&r/i<v.CesiumMath.EPSILON14?[0,0]:i<r&&i/r<v.CesiumMath.EPSILON14||(n=-e/a)<0?[]:[-(i=Math.sqrt(n)),i]:0===e?(n=-t/a)<0?[n,0]:[0,n]:(r=s(t*t,-(4*a*e),v.CesiumMath.EPSILON14))<0?[]:(i=-.5*s(t,v.CesiumMath.sign(t)*Math.sqrt(r),v.CesiumMath.EPSILON14),0<t?[i/a,e/i]:[e/i,i/a])};var d={};function o(a,t,e,n){var r,i,s,o,u,t=t/3,e=e/3,C=a*e,c=t*n,l=t*t,h=e*e,M=a*e-l,m=a*n-t*e,d=t*n-h,f=4*M*d-m*m;return f<0?(u=(u=(r=(o=-((i=C*h<=l*c?-2*t*(s=M)+(o=a)*m:-(o=n)*m+2*e*(s=d))<0?-1:1)*Math.abs(o)*Math.sqrt(-f))-i)/2)<0?-Math.pow(-u,1/3):Math.pow(u,1/3),o=r===o?-u:-s/u,i=s<=0?u+o:-i/(u*u+o*o+s),C*h<=l*c?[(i-t)/a]:[-n/(i+e)]):(o=-2*t*(u=M)+a*m,C=-n*m+2*e*(s=d),h=Math.sqrt(f),l=Math.sqrt(3)/2,c=Math.abs(Math.atan2(a*h,-o)/3),o=(d=2*t<(r=(i=2*Math.sqrt(-u))*(M=Math.cos(c)))+(m=i*(-M/2-l*Math.sin(c)))?r-t:m-t)/(f=a),c=Math.abs(Math.atan2(n*h,-C)/3),h=(u=-n)/(a=(r=(i=2*Math.sqrt(-s))*(M=Math.cos(c)))+(m=i*(-M/2-l*Math.sin(c)))<2*e?r+e:m+e),o<=(n=(e*(C=-d*a-f*u)-t*(d*u))/(-t*C+e*(f*a)))?o<=h?n<=h?[o,n,h]:[o,h,n]:[h,o,n]:o<=h?[n,o,h]:n<=h?[n,h,o]:[h,n,o])}d.computeDiscriminant=function(a,t,e,n){var r=t*t,i=e*e;return 18*a*t*e*n+r*i-27*(a*a)*(n*n)-4*(a*i*e+r*t*n)},d.computeRealRoots=function(a,t,e,n){var r,i,s;return 0===a?S.computeRealRoots(t,e,n):0===t?0===e?0===n?[0,0,0]:[s=(i=-n/a)<0?-Math.pow(-i,1/3):Math.pow(i,1/3),s,s]:0===n?0===(r=S.computeRealRoots(a,0,e)).Length?[0]:[r[0],0,r[1]]:o(a,0,e,n):0===e?0===n?(i=-t/a)<0?[i,0,0]:[0,0,i]:o(a,t,0,n):0===n?0===(r=S.computeRealRoots(a,t,e)).length?[0]:r[1]<=0?[r[0],r[1],0]:0<=r[0]?[0,r[0],r[1]]:[r[0],0,r[1]]:o(a,t,e,n)};var O={};function C(a,t,e,n){var r=a*a,i=t-3*r/8,s=e-t*a/2+r*a/8,n=n-e*a/4+t*r/16-3*r*r/256,e=d.computeRealRoots(1,2*i,i*i-4*n,-s*s);if(0<e.length){t=-a/4,r=e[e.length-1];if(Math.abs(r)<v.CesiumMath.EPSILON14){var a=S.computeRealRoots(1,i,n);if(2===a.length){var o,u,e=a[0],n=a[1];if(0<=e&&0<=n)return a=Math.sqrt(e),[t-(u=Math.sqrt(n)),t-a,t+a,t+u];if(0<=e&&n<0)return[t-(o=Math.sqrt(e)),t+o];if(e<0&&0<=n)return[t-(o=Math.sqrt(n)),t+o]}return[]}if(0<r)return u=(i+r+s/(a=Math.sqrt(r)))/2,e=S.computeRealRoots(1,a,(i+r-s/a)/2),n=S.computeRealRoots(1,-a,u),0!==e.length?(e[0]+=t,e[1]+=t,0!==n.length?(n[0]+=t,n[1]+=t,e[1]<=n[0]?[e[0],e[1],n[0],n[1]]:n[1]<=e[0]?[n[0],n[1],e[0],e[1]]:e[0]>=n[0]&&e[1]<=n[1]?[n[0],e[0],e[1],n[1]]:n[0]>=e[0]&&n[1]<=e[1]?[e[0],n[0],n[1],e[1]]:e[0]>n[0]&&e[0]<n[1]?[n[0],e[0],n[1],e[1]]:[e[0],n[0],e[1],n[1]]):e):0!==n.length?(n[0]+=t,n[1]+=t,n):[]}return[]}function c(a,t,e,n){var r=a*a,i=d.computeRealRoots(1,-2*t,e*a+t*t-4*n,r*n-e*t*a+e*e);if(0<i.length){var s,o,u,C,c,i=i[0],t=t-i,l=t*t,h=a/2,t=t/2,M=l-4*n,l=l+4*Math.abs(n),m=r-4*i,r=r+4*Math.abs(i),r=(m=i<0||M*r<m*l?(s=(r=Math.sqrt(m))/2,0===r?0:(a*t-e)/r):(s=0===(l=Math.sqrt(M))?0:(a*t-e)/l,l/2),0==h&&0===s?u=o=0:v.CesiumMath.sign(h)===v.CesiumMath.sign(s)?u=i/(o=h+s):o=i/(u=h-s),0==t&&0===m?c=C=0:v.CesiumMath.sign(t)===v.CesiumMath.sign(m)?c=n/(C=t+m):C=n/(c=t-m),S.computeRealRoots(1,o,C)),M=S.computeRealRoots(1,u,c);if(0!==r.length)return 0!==M.length?r[1]<=M[0]?[r[0],r[1],M[0],M[1]]:M[1]<=r[0]?[M[0],M[1],r[0],r[1]]:r[0]>=M[0]&&r[1]<=M[1]?[M[0],r[0],r[1],M[1]]:M[0]>=r[0]&&M[1]<=r[1]?[r[0],M[0],M[1],r[1]]:r[0]>M[0]&&r[0]<M[1]?[M[0],r[0],M[1],r[1]]:[r[0],M[0],r[1],M[1]]:r;if(0!==M.length)return M}return[]}function e(a,t){t=w.Cartesian3.clone(f.defaultValue(t,w.Cartesian3.ZERO)),w.Cartesian3.equals(t,w.Cartesian3.ZERO)||w.Cartesian3.normalize(t,t),this.origin=w.Cartesian3.clone(f.defaultValue(a,w.Cartesian3.ZERO)),this.direction=t}O.computeDiscriminant=function(a,t,e,n,r){var i=a*a,s=t*t,o=s*t,u=e*e,C=u*e,c=n*n,l=c*n,h=r*r;return s*u*c-4*o*l-4*a*C*c+18*a*t*e*l-27*i*c*c+256*(i*a)*(h*r)+r*(18*o*e*n-4*s*C+16*a*u*u-80*a*t*u*n-6*a*s*c+144*i*e*c)+h*(144*a*s*e-27*s*s-128*i*u-192*i*t*n)},O.computeRealRoots=function(a,t,e,n,r){if(Math.abs(a)<v.CesiumMath.EPSILON15)return d.computeRealRoots(t,e,n,r);var i=t/a,s=e/a,o=n/a,u=r/a,t=i<0?1:0;switch(t=(t=(t+=s<0?1+t:t)+(o<0?1+t:t))+(u<0?1+t:t)){case 0:return C(i,s,o,u);case 1:case 2:return c(i,s,o,u);case 3:case 4:return C(i,s,o,u);case 5:return c(i,s,o,u);case 6:case 7:return C(i,s,o,u);case 8:return c(i,s,o,u);case 9:case 10:return C(i,s,o,u);case 11:return c(i,s,o,u);case 12:case 13:case 14:case 15:return C(i,s,o,u);default:return}},e.clone=function(a,t){if(f.defined(a))return f.defined(t)?(t.origin=w.Cartesian3.clone(a.origin),t.direction=w.Cartesian3.clone(a.direction),t):new e(a.origin,a.direction)},e.getPoint=function(a,t,e){return f.defined(e)||(e=new w.Cartesian3),e=w.Cartesian3.multiplyByScalar(a.direction,t,e),w.Cartesian3.add(a.origin,e,e)};var l={rayPlane:function(a,t,e){f.defined(e)||(e=new w.Cartesian3);var n=a.origin,a=a.direction,r=t.normal,i=w.Cartesian3.dot(r,a);if(!(Math.abs(i)<v.CesiumMath.EPSILON15)){t=(-t.distance-w.Cartesian3.dot(r,n))/i;if(!(t<0))return e=w.Cartesian3.multiplyByScalar(a,t,e),w.Cartesian3.add(n,e,e)}}},M=new w.Cartesian3,m=new w.Cartesian3,g=new w.Cartesian3,p=new w.Cartesian3,x=new w.Cartesian3,u=(l.rayTriangleParametric=function(a,t,e,n,r){r=f.defaultValue(r,!1);var i,s,o,u=a.origin,a=a.direction,e=w.Cartesian3.subtract(e,t,M),n=w.Cartesian3.subtract(n,t,m),C=w.Cartesian3.cross(a,n,g),c=w.Cartesian3.dot(e,C);if(r){if(c<v.CesiumMath.EPSILON6)return;if(h=w.Cartesian3.subtract(u,t,p),(l=w.Cartesian3.dot(h,C))<0||c<l)return;if(i=w.Cartesian3.cross(h,e,x),(s=w.Cartesian3.dot(a,i))<0||c<l+s)return;o=w.Cartesian3.dot(n,i)/c}else{if(Math.abs(c)<v.CesiumMath.EPSILON6)return;var l,r=1/c,h=w.Cartesian3.subtract(u,t,p);if((l=w.Cartesian3.dot(h,C)*r)<0||1<l)return;if(i=w.Cartesian3.cross(h,e,x),(s=w.Cartesian3.dot(a,i)*r)<0||1<l+s)return;o=w.Cartesian3.dot(n,i)*r}return o},l.rayTriangle=function(a,t,e,n,r,i){t=l.rayTriangleParametric(a,t,e,n,r);if(f.defined(t)&&!(t<0))return f.defined(i)||(i=new w.Cartesian3),w.Cartesian3.multiplyByScalar(a.direction,t,i),w.Cartesian3.add(a.origin,i,i)},new e);l.lineSegmentTriangle=function(a,t,e,n,r,i,s){var o=u,e=(w.Cartesian3.clone(a,o.origin),w.Cartesian3.subtract(t,a,o.direction),w.Cartesian3.normalize(o.direction,o.direction),l.rayTriangleParametric(o,e,n,r,i));if(!(!f.defined(e)||e<0||e>w.Cartesian3.distance(a,t)))return f.defined(s)||(s=new w.Cartesian3),w.Cartesian3.multiplyByScalar(o.direction,e,s),w.Cartesian3.add(o.origin,s,s)};var i={root0:0,root1:0};function h(a,t,e){f.defined(e)||(e=new R.Interval);var n=a.origin,a=a.direction,r=t.center,t=t.radius*t.radius,n=w.Cartesian3.subtract(n,r,g),r=function(a,t,e,n){var r,i,e=t*t-4*a*e;if(!(e<0))return 0<e?(i=1/(2*a),(r=(-t+(e=Math.sqrt(e)))*i)<(e=(-t-e)*i)?(n.root0=r,n.root1=e):(n.root0=e,n.root1=r),n):0!=(i=-t/(2*a))?(n.root0=n.root1=i,n):void 0}(w.Cartesian3.dot(a,a),2*w.Cartesian3.dot(a,n),w.Cartesian3.magnitudeSquared(n)-t,i);if(f.defined(r))return e.start=r.root0,e.stop=r.root1,e}l.raySphere=function(a,t,e){if(e=h(a,t,e),f.defined(e)&&!(e.stop<0))return e.start=Math.max(e.start,0),e};var y=new e,P=(l.lineSegmentSphere=function(a,t,e,n){var r=y,t=(w.Cartesian3.clone(a,r.origin),w.Cartesian3.subtract(t,a,r.direction)),a=w.Cartesian3.magnitude(t);if(w.Cartesian3.normalize(t,t),n=h(r,e,n),!(!f.defined(n)||n.stop<0||n.start>a))return n.start=Math.max(n.start,0),n.stop=Math.min(n.stop,a),n},new w.Cartesian3),b=new w.Cartesian3;function N(a,t,e){var n=a+t;return v.CesiumMath.sign(a)!==v.CesiumMath.sign(t)&&Math.abs(n/Math.max(Math.abs(a),Math.abs(t)))<e?0:n}l.rayEllipsoid=function(a,t){var e,n,r,i,s,o,u,t=t.oneOverRadii,C=w.Cartesian3.multiplyComponents(t,a.origin,P),t=w.Cartesian3.multiplyComponents(t,a.direction,b),a=w.Cartesian3.magnitudeSquared(C),C=w.Cartesian3.dot(C,t);return 1<a?0<=C||(e=a-1,(o=C*C)<(r=(n=w.Cartesian3.magnitudeSquared(t))*e))?void 0:r<o?(i=C*C-r,(o=(s=-C+Math.sqrt(i))/n)<(u=e/s)?new R.Interval(o,u):{start:u,stop:o}):(u=Math.sqrt(e/n),new R.Interval(u,u)):a<1?(e=a-1,i=C*C-(r=(n=w.Cartesian3.magnitudeSquared(t))*e),s=-C+Math.sqrt(i),new R.Interval(0,s/n)):C<0?(n=w.Cartesian3.magnitudeSquared(t),new R.Interval(0,-C/n)):void 0};var q=new w.Cartesian3,L=new w.Cartesian3,I=new w.Cartesian3,E=new w.Cartesian3,z=new w.Cartesian3,T=new R.Matrix3,U=new R.Matrix3,Z=new R.Matrix3,A=new R.Matrix3,D=new R.Matrix3,W=new R.Matrix3,B=new R.Matrix3,V=new w.Cartesian3,k=new w.Cartesian3,F=new w.Cartographic,G=(l.grazingAltitudeLocation=function(a,t){var e=a.origin,n=a.direction;if(!w.Cartesian3.equals(e,w.Cartesian3.ZERO)){var r=t.geodeticSurfaceNormal(e,q);if(0<=w.Cartesian3.dot(n,r))return e}var r=f.defined(this.rayEllipsoid(a,t)),a=t.transformPositionToScaledSpace(n,q),i=w.Cartesian3.normalize(a,a),a=w.Cartesian3.mostOrthogonalAxis(a,E),a=w.Cartesian3.normalize(w.Cartesian3.cross(a,i,L),L),s=w.Cartesian3.normalize(w.Cartesian3.cross(i,a,I),I),o=T,i=(o[0]=i.x,o[1]=i.y,o[2]=i.z,o[3]=a.x,o[4]=a.y,o[5]=a.z,o[6]=s.x,o[7]=s.y,o[8]=s.z,R.Matrix3.transpose(o,U)),u=R.Matrix3.fromScale(t.radii,Z),a=R.Matrix3.fromScale(t.oneOverRadii,A),s=D,i=(s[0]=0,s[1]=-n.z,s[2]=n.y,s[3]=n.z,s[4]=0,s[5]=-n.x,s[6]=-n.y,s[7]=n.x,s[8]=0,R.Matrix3.multiply(R.Matrix3.multiply(i,a,W),s,W)),a=R.Matrix3.multiply(R.Matrix3.multiply(i,u,B),o,B),s=R.Matrix3.multiplyByVector(i,e,z),C=function(a,t,e,n,r){var i,s=n*n,o=r*r,u=(a[R.Matrix3.COLUMN1ROW1]-a[R.Matrix3.COLUMN2ROW2])*o,C=r*(n*N(a[R.Matrix3.COLUMN1ROW0],a[R.Matrix3.COLUMN0ROW1],v.CesiumMath.EPSILON15)+t.y),c=a[R.Matrix3.COLUMN0ROW0]*s+a[R.Matrix3.COLUMN2ROW2]*o+n*t.x+e,l=o*N(a[R.Matrix3.COLUMN2ROW1],a[R.Matrix3.COLUMN1ROW2],v.CesiumMath.EPSILON15),h=r*(n*N(a[R.Matrix3.COLUMN2ROW0],a[R.Matrix3.COLUMN0ROW2])+t.z),M=[];if(0==h&&0==l)0!==(i=S.computeRealRoots(u,C,c)).length&&(s=i[0],e=Math.sqrt(Math.max(1-s*s,0)),M.push(new w.Cartesian3(n,r*s,r*-e)),M.push(new w.Cartesian3(n,r*s,r*e)),2===i.length)&&(o=i[1],a=Math.sqrt(Math.max(1-o*o,0)),M.push(new w.Cartesian3(n,r*o,r*-a)),M.push(new w.Cartesian3(n,r*o,r*a)));else{t=h*h,s=l*l,e=h*l,o=u*u+s,a=2*(C*u+e),s=2*c*u+C*C-s+t,e=2*(c*C-e),t=c*c-t;if(0!=o||0!=a||0!=s||0!=e){var m=(i=O.computeRealRoots(o,a,s,e,t)).length;if(0!==m)for(var d=0;d<m;++d){var f=i[d],g=f*f,p=Math.max(1-g,0),p=Math.sqrt(p),g=v.CesiumMath.sign(u)===v.CesiumMath.sign(c)?N(u*g+c,C*f,v.CesiumMath.EPSILON12):v.CesiumMath.sign(c)===v.CesiumMath.sign(C*f)?N(u*g,C*f+c,v.CesiumMath.EPSILON12):N(u*g+C*f,c,v.CesiumMath.EPSILON12),g=g*N(l*f,h,v.CesiumMath.EPSILON15);g<0?M.push(new w.Cartesian3(n,r*f,r*p)):0<g?M.push(new w.Cartesian3(n,r*f,r*-p)):0!==p?(M.push(new w.Cartesian3(n,r*f,r*-p)),M.push(new w.Cartesian3(n,r*f,r*p)),++d):M.push(new w.Cartesian3(n,r*f,r*p))}}}return M}(a,w.Cartesian3.negate(s,q),0,0,1),c=C.length;if(0<c){for(var l=w.Cartesian3.clone(w.Cartesian3.ZERO,k),h=Number.NEGATIVE_INFINITY,M=0;M<c;++M){var m=R.Matrix3.multiplyByVector(u,R.Matrix3.multiplyByVector(o,C[M],V),V),d=w.Cartesian3.normalize(w.Cartesian3.subtract(m,e,E),E),d=w.Cartesian3.dot(d,n);h<d&&(h=d,l=w.Cartesian3.clone(m,l))}i=t.cartesianToCartographic(l,F),h=v.CesiumMath.clamp(h,0,1),a=w.Cartesian3.magnitude(w.Cartesian3.subtract(l,e,E))*Math.sqrt(1-h*h);return i.height=r?-a:a,t.cartographicToCartesian(i,new w.Cartesian3)}},new w.Cartesian3);l.lineSegmentPlane=function(a,t,e,n){f.defined(n)||(n=new w.Cartesian3);var t=w.Cartesian3.subtract(t,a,G),r=e.normal,i=w.Cartesian3.dot(r,t);if(!(Math.abs(i)<v.CesiumMath.EPSILON6)){r=w.Cartesian3.dot(r,a),e=-(e.distance+r)/i;if(!(e<0||1<e))return w.Cartesian3.multiplyByScalar(t,e,n),w.Cartesian3.add(a,n,n),n}},l.trianglePlaneIntersection=function(a,t,e,n){var r,i,s=n.normal,o=n.distance,u=w.Cartesian3.dot(s,a)+o<0,C=w.Cartesian3.dot(s,t)+o<0,s=w.Cartesian3.dot(s,e)+o<0,o=0;if(1!=(o=(o+=u?1:0)+(C?1:0)+(s?1:0))&&2!=o||(r=new w.Cartesian3,i=new w.Cartesian3),1==o){if(u)return l.lineSegmentPlane(a,t,n,r),l.lineSegmentPlane(a,e,n,i),{positions:[a,t,e,r,i],indices:[0,3,4,1,2,4,1,4,3]};if(C)return l.lineSegmentPlane(t,e,n,r),l.lineSegmentPlane(t,a,n,i),{positions:[a,t,e,r,i],indices:[1,3,4,2,0,4,2,4,3]};if(s)return l.lineSegmentPlane(e,a,n,r),l.lineSegmentPlane(e,t,n,i),{positions:[a,t,e,r,i],indices:[2,3,4,0,1,4,0,4,3]}}else if(2==o){if(!u)return l.lineSegmentPlane(t,a,n,r),l.lineSegmentPlane(e,a,n,i),{positions:[a,t,e,r,i],indices:[1,2,4,1,4,3,0,3,4]};if(!C)return l.lineSegmentPlane(e,t,n,r),l.lineSegmentPlane(a,t,n,i),{positions:[a,t,e,r,i],indices:[2,0,4,2,4,3,1,3,4]};if(!s)return l.lineSegmentPlane(a,e,n,r),l.lineSegmentPlane(t,e,n,i),{positions:[a,t,e,r,i],indices:[0,1,4,0,4,3,2,3,4]}}},a.IntersectionTests=l,a.Ray=e});
