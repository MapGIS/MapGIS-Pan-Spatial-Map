define(["exports","./Matrix2-59fd2efe","./EllipsoidTangentPlane-0cf355bc","./ComponentDatatype-b7b5db18","./PolylinePipeline-5ce4be00","./Transforms-3bc98d07","./when-ae2e0b60","./RuntimeError-24b14c10"],function(e,R,g,O,I,h,r,a){var V=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),n={};function N(e,a){r.defined(n[e])||(n[e]=!0,console.warn(r.defaultValue(a,e)))}N.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",N.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",N.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",N.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var G=[new R.Cartesian3,new R.Cartesian3],H=new R.Cartesian3,L=new R.Cartesian3,j=new R.Cartesian3,Q=new R.Cartesian3,q=new R.Cartesian3,F=new R.Cartesian3,U=new R.Cartesian3,_=new R.Cartesian3,ee=new R.Cartesian3,Z=new R.Cartesian3,f=new R.Cartesian3,W={},Y=new R.Cartographic;function k(e,a,r,n){var t=e[0],e=e[1],t=R.Cartesian3.angleBetween(t,e),i=Math.ceil(t/n),o=new Array(i);if(a===r)for(l=0;l<i;l++)o[l]=a;else{for(var s=(r-a)/i,l=1;l<i;l++)o[l]=a+l*s;o[0]=a}return o.push(r),o}var y=new R.Cartesian3,m=new R.Cartesian3;var P=new R.Cartesian3(-1,0,0),p=new R.Matrix4,M=new R.Matrix4,w=new R.Matrix3,T=R.Matrix3.IDENTITY.clone(),B=new R.Cartesian3,z=new R.Cartesian4,x=new R.Cartesian3;function J(e,a,r,n,t,i,o,s){var l=B,C=z,a=(p=h.Transforms.eastNorthUpToFixedFrame(e,t,p),l=R.Matrix4.multiplyByPointAsVector(p,P,l),l=R.Cartesian3.normalize(l,l),l=l,a=a,e=e,t=t,t=new g.EllipsoidTangentPlane(e,t),l=t.projectPointOntoPlane(R.Cartesian3.add(e,l,y),y),t=t.projectPointOntoPlane(R.Cartesian3.add(e,a,m),m),e=R.Cartesian2.angleBetween(l,t),0<=t.x*l.y-t.y*l.x?-e:e),c=(w=R.Matrix3.fromRotationZ(a,w),x.z=i,p=R.Matrix4.multiplyTransformation(p,R.Matrix4.fromRotationTranslation(w,x,M),p),T);c[0]=o;for(var u=0;u<s;u++)for(var d=0;d<r.length;d+=3)C=R.Cartesian3.fromArray(r,d,C),C=R.Matrix3.multiplyByVector(c,C,C),C=R.Matrix4.multiplyByPoint(p,C,C),n.push(C.x,C.y,C.z);return n}var l=new R.Cartesian3;function K(e,a,r,n,t,i,o){for(var s=0;s<e.length;s+=3)n=J(R.Cartesian3.fromArray(e,s,l),a,r,n,t,i[s/3],o,1);return n}function X(e,a){for(var r=e.length,n=new Array(3*r),t=0,i=a.x+a.width/2,o=a.y+a.height/2,s=0;s<r;s++)n[t++]=e[s].x-i,n[t++]=0,n[t++]=e[s].y-o;return n}var v=new h.Quaternion,E=new R.Cartesian3,b=new R.Matrix3;function $(e,a,r,n,t,i,o,s,l,C){var c,u=R.Cartesian3.angleBetween(R.Cartesian3.subtract(a,e,Z),R.Cartesian3.subtract(r,e,f)),d=n===V.BEVELED?0:Math.ceil(u/O.CesiumMath.toRadians(5)),g=t?R.Matrix3.fromQuaternion(h.Quaternion.fromAxisAngle(R.Cartesian3.negate(e,Z),u/(d+1),v),b):R.Matrix3.fromQuaternion(h.Quaternion.fromAxisAngle(e,u/(d+1),v),b);if(a=R.Cartesian3.clone(a,E),0<d)for(var y=C?2:1,m=0;m<d;m++)a=R.Matrix3.multiplyByVector(g,a,a),c=R.Cartesian3.subtract(a,e,Z),c=R.Cartesian3.normalize(c,c),t||(c=R.Cartesian3.negate(c,c)),o=J(i.scaleToGeodeticSurface(a,f),c,s,o,i,l,1,y);else c=R.Cartesian3.subtract(a,e,Z),c=R.Cartesian3.normalize(c,c),t||(c=R.Cartesian3.negate(c,c)),o=J(i.scaleToGeodeticSurface(a,f),c,s,o,i,l,1,1),r=R.Cartesian3.clone(r,E),c=R.Cartesian3.subtract(r,e,Z),c=R.Cartesian3.normalize(c,c),t||(c=R.Cartesian3.negate(c,c)),o=J(i.scaleToGeodeticSurface(r,f),c,s,o,i,l,1,1)}W.removeDuplicatesFromShape=function(e){for(var a=e.length,r=[],n=a-1,t=0;t<a;n=t++){var i=e[n],o=e[t];R.Cartesian2.equals(i,o)||r.push(o)}return r},W.angleIsGreaterThanPi=function(e,a,r,n){n=new g.EllipsoidTangentPlane(r,n),e=n.projectPointOntoPlane(R.Cartesian3.add(r,e,y),y),n=n.projectPointOntoPlane(R.Cartesian3.add(r,a,m),m);return 0<=n.x*e.y-n.y*e.x};var ae=new R.Cartesian3,re=new R.Cartesian3;W.computePositions=function(e,a,r,n,t){var i,o=n._ellipsoid,s=function(e,a){for(var r=new Array(e.length),n=0;n<e.length;n++){var t=e[n];Y=a.cartesianToCartographic(t,Y),r[n]=Y.height,e[n]=a.scaleToGeodeticSurface(t,t)}return r}(e,o),l=n._granularity,C=n._cornerType,c=(t?function(e,a){var r=e.length,n=new Array(6*r),t=0,i=a.x+a.width/2,o=a.y+a.height/2,s=e[0];n[t++]=s.x-i,n[t++]=0,n[t++]=s.y-o;for(var l=1;l<r;l++){var C=(s=e[l]).x-i,c=s.y-o;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return s=e[0],n[t++]=s.x-i,n[t++]=0,n[t++]=s.y-o,n}:X)(a,r),n=t?X(a,r):void 0,u=r.height/2,d=r.width/2,g=e.length,y=[],a=t?[]:void 0,m=H,h=L,f=j,p=Q,w=q,x=F,v=U,E=_,b=ee,P=e[0],M=e[1],T=(p=o.geodeticSurfaceNormal(P,p),m=R.Cartesian3.subtract(M,P,m),m=R.Cartesian3.normalize(m,m),E=R.Cartesian3.cross(p,m,E),E=R.Cartesian3.normalize(E,E),s[0]),B=s[1];t&&(a=J(P,E,n,a,o,T+u,1,1)),b=R.Cartesian3.clone(P,b),P=M,h=R.Cartesian3.negate(m,h);for(var z=1;z<g-1;z++){var S,A,D=t?2:1,M=e[z+1];P.equals(M)?N("Positions are too close and are considered equivalent with rounding error."):(m=R.Cartesian3.subtract(M,P,m),m=R.Cartesian3.normalize(m,m),f=R.Cartesian3.add(m,h,f),f=R.Cartesian3.normalize(f,f),p=o.geodeticSurfaceNormal(P,p),S=R.Cartesian3.multiplyByScalar(p,R.Cartesian3.dot(m,p),ae),A=(R.Cartesian3.subtract(m,S,S),R.Cartesian3.normalize(S,S),R.Cartesian3.multiplyByScalar(p,R.Cartesian3.dot(h,p),re)),R.Cartesian3.subtract(h,A,A),R.Cartesian3.normalize(A,A),!O.CesiumMath.equalsEpsilon(Math.abs(R.Cartesian3.dot(S,A)),1,O.CesiumMath.EPSILON7)?(f=R.Cartesian3.cross(f,p,f),f=R.Cartesian3.cross(p,f,f),f=R.Cartesian3.normalize(f,f),S=1/Math.max(.25,R.Cartesian3.magnitude(R.Cartesian3.cross(f,h,Z))),(A=W.angleIsGreaterThanPi(m,h,P,o))?(w=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(f,S*d,f),w),x=R.Cartesian3.add(w,R.Cartesian3.multiplyByScalar(E,d,x),x),G[0]=R.Cartesian3.clone(b,G[0]),G[1]=R.Cartesian3.clone(x,G[1]),i=k(G,T+u,B+u,l),y=K(I.PolylinePipeline.generateArc({positions:G,granularity:l,ellipsoid:o}),E,c,y,o,i,1),E=R.Cartesian3.cross(p,m,E),E=R.Cartesian3.normalize(E,E),v=R.Cartesian3.add(w,R.Cartesian3.multiplyByScalar(E,d,v),v),C===V.ROUNDED||C===V.BEVELED?$(w,x,v,C,A,o,y,c,B+u,t):y=J(P,f=R.Cartesian3.negate(f,f),c,y,o,B+u,S,D)):(w=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(f,S*d,f),w),x=R.Cartesian3.add(w,R.Cartesian3.multiplyByScalar(E,-d,x),x),G[0]=R.Cartesian3.clone(b,G[0]),G[1]=R.Cartesian3.clone(x,G[1]),i=k(G,T+u,B+u,l),y=K(I.PolylinePipeline.generateArc({positions:G,granularity:l,ellipsoid:o}),E,c,y,o,i,1),E=R.Cartesian3.cross(p,m,E),E=R.Cartesian3.normalize(E,E),v=R.Cartesian3.add(w,R.Cartesian3.multiplyByScalar(E,-d,v),v),C===V.ROUNDED||C===V.BEVELED?$(w,x,v,C,A,o,y,c,B+u,t):y=J(P,f,c,y,o,B+u,S,D)),b=R.Cartesian3.clone(v,b),h=R.Cartesian3.negate(m,h)):(y=J(b,E,c,y,o,T+u,1,1),b=P),T=B,B=s[z+1],P=M)}G[0]=R.Cartesian3.clone(b,G[0]),G[1]=R.Cartesian3.clone(P,G[1]),i=k(G,T+u,B+u,l),y=K(I.PolylinePipeline.generateArc({positions:G,granularity:l,ellipsoid:o}),E,c,y,o,i,1),t&&(a=J(P,E,n,a,o,B+u,1,1));g=y.length,r=t?g+a.length:g,n=new Float64Array(r);return n.set(y),t&&n.set(a,g),n},e.CornerType=V,e.PolylineVolumeGeometryLibrary=W,e.oneTimeWarning=N});
